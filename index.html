<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCAL3 Arena | The Creatorverse</title>
  <link rel="icon" type="image/png" href="data:image/png;base64,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
8Dfrn9miZns26p70TPZifx1OP6X5XXi7FN+1Gmqjvj+J5J/IMbTYuzbrnRFXF0UETEx2BVrtwFd0
+0vynQ3JK8yzS7rqmJixYpmOrvV+LT/vPeelmzXeri3bjTM90Pi5cpt0zXXOiIah+lrndmr/AAfR
21XE3aZqxd+I/hif2aP/ACaChlNLM+xukukOLzrMKom/ia9eqNyinvUx+ER2GMXXk+A/sMHRYnvj
v2z75VxmGK/usRVdjunu2ACTaYAAAAAAAAAAAAAAAAAAAAAAouzH3AwvGo5tS9KLsx9wMLxqObUh
8/8Al13Z+YSGVa5RtaqAVE74Xa32tPmUldrfa0+YHpmNC98Fv0dfwYdmNC98Fv0dfwSOT6/Z+6OL
TzDVbmyeC/gLkV4ADIAAAAAAAAAAAAAAAAAAAAiUgNg6D7L+lui9i3g/rreZ4GiNVNjFa5mmPBTX
HZj9WyMH9IvK6rMdd6M423c78WsRRVT+sQ52EJi+j2XYqr267fv/AI0xwSNjNsXYp9mmv3fz728t
IvpD4+9aqtZDkNrCVTGqL2Ku/WTHmpiIj9Zae0kz7N9I8yqzDOcddxeIq7ETXPYpjwUxuRHmY4bW
CynB4H32LcRPj3zvl44nH4jE/Fq0x6IhIJFqAAAAAAAAAAAAAAAAAAAAAAAACi7MfcDC8ajm1L0o
uzH3AwvGo5tSHz/5dd2fmEhlWuUbWqgFRO+F2t9rT5lJXa32tPmB6ZjQvfBb9HX8GHZjQvfBb9HX
8Ejk+v2fuji08w1W5sngv4C5FeAAyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAKLsx9wMLxqObUvSi7MfcDC8ajm1IfP/AJdd2fmEhlWuUbWqgFRO+F2t9rT5lJXa32tPmB6Z
jQvfBb9HX8GHZPRS5FrP8NM7lUzR64lIZVVFOOszP7qeLVx0TVhrkR4TwbDhKISuVXYAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACFG2Y+4GF41HNqXlr7ZmvxTgMvw2v9qu
7XXq1d6mIj/yQvSKqKctu6f44wkcop04yj/30ayAVI70Xa32tPmUldrfa0+YHp7w9yqxiLd6ntqK
oqj8peCdxmmqaZiYYmImNEtpYa7TesW71E66a6Yqj830VjQjMfrLE5ddq/bt66revv09+PyWeFzZ
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
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//2Q==">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Space Grotesk', sans-serif; }
    .shadow-brutal { box-shadow: 4px 4px 0px #232324; }
    .shadow-brutal-sm { box-shadow: 3px 3px 0px #232324; }
    .hover-brutal:hover { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #232324; }
  </style>
</head>
<body class="bg-[#FFF7E9]">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ============================================
    // SUPABASE CONFIGURATION
    // ============================================
    const SUPABASE_URL = 'https://oxococjkuooeosnnijvm.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94b2NvY2prdW9vZW9zbm5panZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0NjE4MjgsImV4cCI6MjA4NTAzNzgyOH0.xC5bJox7ZTk0DEU0p2CbtPl8ECVZ9mR10H1_0kns9OM';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ============================================
    // HELPER: Calculate Campaign Status from Dates
    // Supports both date-only (YYYY-MM-DD) and datetime (YYYY-MM-DDTHH:MM)
    // All times are treated as EST
    // ============================================
    const getCampaignStatus = (campaign) => {
      // If it's a draft, keep it as draft
      if (campaign.status === 'Draft') return 'Draft';
      // Keep special ended statuses
      if (campaign.status === 'Ended - Calculating' || campaign.status === 'Ended - Paid') {
        return campaign.status;
      }
      
      const startDate = campaign.startDate;
      const endDate = campaign.endDate;
      
      if (!startDate || !endDate) {
        return campaign.status || 'Upcoming'; // Fallback if no dates
      }
      
      // Get current time in EST
      const now = new Date();
      const estOffset = -5 * 60; // EST is UTC-5
      const utcOffset = now.getTimezoneOffset();
      const estNow = new Date(now.getTime() + (utcOffset + estOffset) * 60000);
      
      // Parse start and end dates (handle both date-only and datetime formats)
      const parseToEST = (dateStr) => {
        if (!dateStr) return null;
        // If it's just a date (YYYY-MM-DD), treat as midnight EST
        if (dateStr.length === 10) {
          return new Date(dateStr + 'T00:00:00');
        }
        // If it's datetime (YYYY-MM-DDTHH:MM), parse directly
        return new Date(dateStr);
      };
      
      const startEST = parseToEST(startDate);
      const endEST = parseToEST(endDate);
      
      // For end date, if it's date-only, set to end of day (23:59:59)
      if (endDate.length === 10) {
        endEST.setHours(23, 59, 59, 999);
      }
      
      if (estNow < startEST) {
        return 'Upcoming';
      } else if (estNow > endEST) {
        return 'Ended';
      } else {
        return 'Active';
      }
    };

    // ============================================
    // SUPABASE DATA HOOKS
    // ============================================
    const useSupabaseData = () => {
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [creators, setCreators] = useState([]);
      const [campaigns, setCampaigns] = useState([]);
      const [submissions, setSubmissions] = useState([]);
      const [paymentHistory, setPaymentHistory] = useState([]);
      const [teamMembers, setTeamMembers] = useState([]);
      const [landingStats, setLandingStats] = useState({ creators: '250+', paidOut: '$500K+', campaigns: '50+' });
      const [initialLoadDone, setInitialLoadDone] = useState(false);

      // Fetch all data
      const fetchData = useCallback(async () => {
        // Only show loading spinner on initial load, not on refreshes
        if (!initialLoadDone) {
          setLoading(true);
        }
        try {
          // Fetch creators
          const { data: creatorsData, error: creatorsError } = await supabase
            .from('creators')
            .select('*')
            .order('total_earned', { ascending: false });
          if (creatorsError) throw creatorsError;

          // Fetch campaigns
          const { data: campaignsData, error: campaignsError } = await supabase
            .from('campaigns')
            .select('*')
            .order('created_at', { ascending: false });
          if (campaignsError) throw campaignsError;

          // Fetch submissions - use !inner to specify the creator_id relationship
          const { data: subsData, error: subsError } = await supabase
            .from('submissions')
            .select('*, creators!submissions_creator_id_fkey(handle, tier, avatar)')
            .order('submitted_at', { ascending: false });
          if (subsError) throw subsError;

          // Fetch payment history
          const { data: paymentsData, error: paymentsError } = await supabase
            .from('payment_history')
            .select('*, campaigns(name), creators!payment_history_creator_id_fkey(handle)')
            .order('paid_at', { ascending: false });
          if (paymentsError) throw paymentsError;

          // Fetch landing stats
          const { data: statsData, error: statsError } = await supabase
            .from('landing_stats')
            .select('*')
            .single();

          // Fetch team members
          const { data: teamData, error: teamError } = await supabase
            .from('team_members')
            .select('*')
            .order('joined_at', { ascending: true });
          // Don't throw on team error - table might not exist yet
          
          // Transform data to match app's expected format
          const transformedCreators = (creatorsData || []).map(c => ({
            id: c.id,
            name: c.name,
            handle: c.handle,
            email: c.email,
            tier: c.tier,
            wallet: c.wallet,
            solanaWallet: c.solana_wallet,
            totalEarned: parseFloat(c.total_earned) || 0,
            avatar: c.avatar,
            profilePic: c.profile_pic,
            isAdmin: c.is_admin,
            status: c.status,
            password_hash: c.password_hash,
            reset_token: c.reset_token,
            reset_token_expires: c.reset_token_expires,
            createdAt: c.created_at
          }));

          const transformedCampaigns = (campaignsData || []).map(c => {
            const baseCampaign = {
              id: c.id,
              name: c.name,
              brand: c.brand,
              brandLogo: c.brand_logo,
              status: c.status, // Store original status for draft check
              budget: parseFloat(c.budget) || 0,
              startDate: c.start_date,
              endDate: c.end_date,
              description: c.description,
              about: c.about,
              requirements: c.requirements || [],
              basePayout: c.base_payout || {},
              tierChampions: c.tier_champions || {},
              bonusPool: c.bonus_pool || [],
              minPosts: c.min_posts || 3,
              maxPosts: c.max_posts,
              links: c.links || {},
              paidAt: c.paid_at,
              enableBasePayout: c.enable_base_payout !== false,
              enableTierChampions: c.enable_tier_champions !== false,
              enableLeaderboard: c.enable_leaderboard !== false
            };
            // Auto-calculate status based on dates (unless it's a Draft)
            baseCampaign.status = getCampaignStatus(baseCampaign);
            return baseCampaign;
          });

          const transformedSubs = (subsData || []).map(s => ({
            id: s.id,
            campaignId: s.campaign_id,
            creatorId: s.creator_id,
            handle: s.creators?.handle || '',
            tier: s.creators?.tier || 'Bronze',
            avatar: s.creators?.avatar || 'üë§',
            tweetUrl: s.tweet_url,
            submittedAt: s.submitted_at,
            views: s.views || 0,
            likes: s.likes || 0,
            retweets: s.retweets || 0,
            replies: s.replies || 0,
            status: s.status,
            quality: s.quality,
            rejectionReason: s.rejection_reason
          }));

          const transformedPayments = (paymentsData || []).map(p => ({
            id: p.id,
            campaignId: p.campaign_id,
            campaignName: p.campaigns?.name || '',
            creatorId: p.creator_id,
            handle: p.creators?.handle || '',
            amount: parseFloat(p.amount) || 0,
            breakdown: p.breakdown || {},
            paidAt: p.paid_at
          }));

          const transformedTeamMembers = (teamData || []).map(t => ({
            id: t.id,
            email: t.email,
            name: t.name,
            role: t.role,
            status: t.status,
            joinedAt: t.joined_at?.slice(0, 10) || t.created_at?.slice(0, 10),
            permissions: t.permissions || {
              manage_campaigns: false,
              manage_submissions: true,
              manage_creators: false,
              manage_payments: false,
              manage_team: false,
              view_analytics: true
            }
          }));

          setCreators(transformedCreators);
          setCampaigns(transformedCampaigns);
          setSubmissions(transformedSubs);
          setPaymentHistory(transformedPayments);
          if (teamData && teamData.length > 0) {
            setTeamMembers(transformedTeamMembers);
          }
          if (statsData) {
            setLandingStats({
              creators: statsData.creators,
              paidOut: statsData.paid_out,
              campaigns: statsData.campaigns
            });
          }
          setError(null);
        } catch (err) {
          console.error('Error fetching data:', err);
          setError(err.message);
        } finally {
          setLoading(false);
          setInitialLoadDone(true);
        }
      }, [initialLoadDone]);

      // CRUD Operations
      const updateCreator = async (id, updates) => {
        const dbUpdates = {
          name: updates.name,
          handle: updates.handle,
          tier: updates.tier,
          wallet: updates.wallet,
          solana_wallet: updates.solanaWallet,
          total_earned: updates.totalEarned,
          avatar: updates.avatar,
          profile_pic: updates.profilePic,
          is_admin: updates.isAdmin,
          status: updates.status,
          password_hash: updates.password_hash,
          reset_token: updates.reset_token,
          reset_token_expires: updates.reset_token_expires,
          email_notifications: updates.email_notifications,
          notification_preferences: updates.notification_preferences
        };
        // Remove undefined values
        Object.keys(dbUpdates).forEach(key => dbUpdates[key] === undefined && delete dbUpdates[key]);
        
        const { error } = await supabase.from('creators').update(dbUpdates).eq('id', id);
        if (error) throw error;
        // Don't call fetchData() here - let the caller manage local state
        // This prevents race conditions and unnecessary re-renders
      };

      const createCreator = async (creator) => {
        const dbCreator = {
          name: creator.name,
          email: creator.email,
          handle: creator.handle,
          tier: creator.tier || 'Bronze',
          wallet: creator.wallet,
          solana_wallet: creator.solana_wallet,
          avatar: creator.avatar || 'üë§',
          status: creator.status || 'Active',
          total_earned: creator.total_earned || 0,
          is_admin: creator.is_admin || false,
          password_hash: creator.password_hash
        };
        // Remove undefined/null values
        Object.keys(dbCreator).forEach(key => (dbCreator[key] === undefined || dbCreator[key] === null) && delete dbCreator[key]);
        
        const { data, error } = await supabase.from('creators').insert(dbCreator).select().single();
        if (error) throw error;
        await fetchData();
        return data;
      };

      const createCampaign = async (campaign) => {
        const dbCampaign = {
          name: campaign.name,
          brand: campaign.brand,
          brand_logo: campaign.brandLogo,
          status: campaign.status,
          budget: campaign.budget,
          start_date: campaign.startDate,
          end_date: campaign.endDate,
          description: campaign.description,
          about: campaign.about,
          requirements: campaign.requirements,
          base_payout: campaign.basePayout,
          tier_champions: campaign.tierChampions,
          bonus_pool: campaign.bonusPool,
          min_posts: campaign.minPosts,
          max_posts: campaign.maxPosts,
          links: campaign.links
        };
        const { error } = await supabase.from('campaigns').insert(dbCampaign);
        if (error) throw error;
        await fetchData();
      };

      const updateCampaign = async (id, updates) => {
        const dbUpdates = {
          name: updates.name,
          brand: updates.brand,
          brand_logo: updates.brandLogo,
          status: updates.status,
          budget: updates.budget,
          start_date: updates.startDate,
          end_date: updates.endDate,
          description: updates.description,
          about: updates.about,
          requirements: updates.requirements,
          base_payout: updates.basePayout,
          tier_champions: updates.tierChampions,
          bonus_pool: updates.bonusPool,
          min_posts: updates.minPosts,
          max_posts: updates.maxPosts,
          links: updates.links,
          paid_at: updates.paidAt
        };
        Object.keys(dbUpdates).forEach(key => dbUpdates[key] === undefined && delete dbUpdates[key]);
        
        const { error } = await supabase.from('campaigns').update(dbUpdates).eq('id', id);
        if (error) throw error;
        await fetchData();
      };

      const createSubmission = async (submission) => {
        const dbSub = {
          campaign_id: submission.campaignId,
          creator_id: submission.creatorId,
          tweet_url: submission.tweetUrl,
          status: 'Pending',
          quality: 'Good'
        };
        const { error } = await supabase.from('submissions').insert(dbSub);
        if (error) throw error;
        await fetchData();
      };

      const updateSubmission = async (id, updates) => {
        const dbUpdates = {
          views: updates.views,
          likes: updates.likes,
          retweets: updates.retweets,
          replies: updates.replies,
          status: updates.status,
          quality: updates.quality,
          rejection_reason: updates.rejectionReason
        };
        Object.keys(dbUpdates).forEach(key => dbUpdates[key] === undefined && delete dbUpdates[key]);
        
        const { error } = await supabase.from('submissions').update(dbUpdates).eq('id', id);
        if (error) throw error;
        await fetchData();
      };

      const createPayment = async (payment) => {
        const dbPayment = {
          campaign_id: payment.campaignId,
          creator_id: payment.creatorId,
          amount: payment.amount,
          breakdown: payment.breakdown
        };
        const { error } = await supabase.from('payment_history').insert(dbPayment);
        if (error) throw error;
      };

      const updateLandingStats = async (stats) => {
        const { error } = await supabase.from('landing_stats').update({
          creators: stats.creators,
          paid_out: stats.paidOut,
          campaigns: stats.campaigns
        }).eq('id', 1);
        if (error) throw error;
        setLandingStats(stats);
      };

      // Team member functions
      const addTeamMember = async (member) => {
        const dbMember = {
          email: member.email,
          name: member.name || member.email.split('@')[0],
          role: member.role || 'Team Member',
          status: member.status || 'Pending',
          invite_token: member.invite_token,
          invite_token_expires: member.invite_token_expires
        };
        const { data, error } = await supabase.from('team_members').insert(dbMember).select().single();
        if (error) throw error;
        await fetchData();
        return data;
      };
      
      const updateTeamMember = async (id, updates) => {
        const dbUpdates = {
          name: updates.name,
          role: updates.role,
          status: updates.status,
          password_hash: updates.password_hash,
          invite_token: updates.invite_token,
          invite_token_expires: updates.invite_token_expires,
          joined_at: updates.joined_at,
          permissions: updates.permissions
        };
        // Remove undefined values
        Object.keys(dbUpdates).forEach(key => dbUpdates[key] === undefined && delete dbUpdates[key]);
        
        const { error } = await supabase.from('team_members').update(dbUpdates).eq('id', id);
        if (error) throw error;
      };
      
      const getTeamMemberByToken = async (token) => {
        const { data, error } = await supabase
          .from('team_members')
          .select('*')
          .eq('invite_token', token)
          .single();
        
        if (error || !data) return null;
        return data;
      };
      
      const loginTeamMember = async (email, password) => {
        const { data, error } = await supabase
          .from('team_members')
          .select('*')
          .eq('email', email.toLowerCase())
          .single();
        
        if (error || !data) {
          throw new Error('Invalid email or password');
        }
        
        if (!data.password_hash) {
          throw new Error('Please complete your account setup using the invite link.');
        }
        
        // Hash the input password and compare
        let hash = 0;
        for (let i = 0; i < password.length; i++) {
          const char = password.charCodeAt(i);
          hash = ((hash << 5) - hash) + char;
          hash = hash & hash;
        }
        const inputHash = 'hash_' + Math.abs(hash).toString(16);
        
        if (data.password_hash !== inputHash) {
          throw new Error('Invalid email or password');
        }
        
        // Default permissions for team members
        const defaultPermissions = {
          manage_campaigns: false,
          manage_submissions: true,
          manage_creators: false,
          manage_payments: false,
          manage_team: false,
          view_analytics: true
        };
        
        return {
          id: data.id,
          name: data.name,
          email: data.email,
          role: data.role,
          isAdmin: true,
          isTeamMember: true,
          isOwner: data.role === 'Owner',
          permissions: data.permissions || defaultPermissions
        };
      };

      const removeTeamMember = async (id) => {
        const { error } = await supabase.from('team_members').delete().eq('id', id);
        if (error) throw error;
        await fetchData();
      };

      // Auth functions
      const loginUser = async (email, password) => {
        const { data, error } = await supabase
          .from('creators')
          .select('*')
          .eq('email', email.toLowerCase())
          .single();
        
        if (error || !data) {
          throw new Error('Invalid email or password');
        }
        
        if (!data.password_hash) {
          throw new Error('Please complete your account setup using Sign Up first.');
        }
        
        // Hash the input password and compare
        let hash = 0;
        for (let i = 0; i < password.length; i++) {
          const char = password.charCodeAt(i);
          hash = ((hash << 5) - hash) + char;
          hash = hash & hash;
        }
        const inputHash = 'hash_' + Math.abs(hash).toString(16);
        
        if (data.password_hash !== inputHash) {
          throw new Error('Invalid email or password');
        }
        
        return {
          id: data.id,
          name: data.name,
          handle: data.handle,
          email: data.email,
          tier: data.tier,
          wallet: data.wallet,
          solanaWallet: data.solana_wallet,
          totalEarned: parseFloat(data.total_earned) || 0,
          avatar: data.avatar,
          profilePic: data.profile_pic,
          isAdmin: data.is_admin,
          status: data.status,
          password_hash: data.password_hash
        };
      };

      const signupUser = async (userData) => {
        const { data, error } = await supabase.from('creators').insert({
          email: userData.email,
          name: userData.name,
          handle: userData.handle,
          tier: 'Bronze',
          avatar: 'üë§'
        }).select().single();
        
        if (error) {
          if (error.code === '23505') throw new Error('Email or handle already exists');
          throw error;
        }
        return {
          id: data.id,
          name: data.name,
          handle: data.handle,
          email: data.email,
          tier: data.tier,
          totalEarned: 0,
          avatar: data.avatar,
          isAdmin: false
        };
      };

      // Notification functions
      const getNotifications = async (userId) => {
        const { data, error } = await supabase
          .from('notifications')
          .select('*')
          .eq('user_id', userId)
          .order('created_at', { ascending: false })
          .limit(50);
        
        if (error) {
          console.error('Error fetching notifications:', error);
          return [];
        }
        
        return (data || []).map(n => ({
          id: n.id,
          userId: n.user_id,
          type: n.type,
          title: n.title,
          message: n.message,
          data: n.data,
          read: n.read,
          time: formatTimeAgo(n.created_at),
          createdAt: n.created_at
        }));
      };

      const createNotification = async (notification) => {
        const { data, error } = await supabase
          .from('notifications')
          .insert({
            user_id: notification.userId,
            user_type: notification.userType || 'creator',
            type: notification.type,
            title: notification.title,
            message: notification.message,
            data: notification.data || {}
          })
          .select()
          .single();
        
        if (error) {
          console.error('Error creating notification:', error);
          return null;
        }
        return data;
      };

      const markNotificationRead = async (notificationId) => {
        const { error } = await supabase
          .from('notifications')
          .update({ read: true })
          .eq('id', notificationId);
        
        if (error) console.error('Error marking notification read:', error);
      };

      const markAllNotificationsRead = async (userId) => {
        const { error } = await supabase
          .from('notifications')
          .update({ read: true })
          .eq('user_id', userId)
          .eq('read', false);
        
        if (error) console.error('Error marking all notifications read:', error);
      };

      const notifyAllCreators = async (notification) => {
        // Get all active creators
        const { data: activeCreators, error } = await supabase
          .from('creators')
          .select('id, email, email_notifications, notification_preferences')
          .eq('status', 'Active');
        
        if (error || !activeCreators) {
          console.error('Error fetching creators for notification:', error);
          return;
        }

        // Create notifications for each creator
        const notifications = activeCreators.map(creator => ({
          user_id: creator.id,
          user_type: 'creator',
          type: notification.type,
          title: notification.title,
          message: notification.message,
          data: notification.data || {}
        }));

        if (notifications.length > 0) {
          const { error: insertError } = await supabase
            .from('notifications')
            .insert(notifications);
          
          if (insertError) console.error('Error creating bulk notifications:', insertError);
        }

        // Send emails to creators who have email notifications enabled
        // AND check admin global settings
        const adminSettings = await getAdminSettings('notification_email_settings');
        const adminEmailEnabled = adminSettings?.[notification.type] !== false;
        
        if (!adminEmailEnabled) {
          console.log(`Admin has disabled email notifications for: ${notification.type}`);
          return; // Don't send emails if admin disabled this notification type
        }
        
        const creatorsToEmail = activeCreators.filter(c => {
          if (!c.email_notifications) return false;
          const prefs = c.notification_preferences || {};
          return prefs[notification.type] !== false;
        });

        // Send emails (non-blocking)
        for (const creator of creatorsToEmail) {
          try {
            await fetch('/api/send-email', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                type: 'notification',
                to: creator.email,
                data: {
                  title: notification.title,
                  message: notification.message,
                  type: notification.type,
                  ...notification.data
                }
              })
            });
          } catch (err) {
            console.error('Failed to send notification email:', err);
          }
        }
      };

      // Admin settings functions
      const getAdminSettings = async (key) => {
        try {
          const { data, error } = await supabase
            .from('admin_settings')
            .select('value')
            .eq('key', key)
            .single();
          
          if (error) return null;
          return data?.value;
        } catch (err) {
          console.error('Error fetching admin settings:', err);
          return null;
        }
      };

      const updateAdminSettings = async (key, value) => {
        try {
          const { error } = await supabase
            .from('admin_settings')
            .upsert({ 
              key, 
              value,
              updated_at: new Date().toISOString()
            }, { onConflict: 'key' });
          
          if (error) throw error;
          return true;
        } catch (err) {
          console.error('Error updating admin settings:', err);
          return false;
        }
      };

      // Helper function to format time ago
      const formatTimeAgo = (dateString) => {
        const now = new Date();
        const date = new Date(dateString);
        const seconds = Math.floor((now - date) / 1000);
        
        if (seconds < 60) return 'just now';
        if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
        if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
        if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;
        return date.toLocaleDateString();
      };

      useEffect(() => {
        fetchData();
      }, [fetchData]);

      return {
        loading,
        error,
        creators,
        campaigns,
        submissions,
        paymentHistory,
        teamMembers,
        landingStats,
        setCreators,
        setCampaigns,
        setSubmissions,
        setPaymentHistory,
        setTeamMembers,
        setLandingStats,
        fetchData,
        updateCreator,
        createCreator,
        createCampaign,
        updateCampaign,
        createSubmission,
        updateSubmission,
        createPayment,
        updateLandingStats,
        addTeamMember,
        updateTeamMember,
        removeTeamMember,
        getTeamMemberByToken,
        loginUser,
        loginTeamMember,
        signupUser,
        getNotifications,
        createNotification,
        markNotificationRead,
        markAllNotificationsRead,
        notifyAllCreators,
        getAdminSettings,
        updateAdminSettings
      };
    };

    // Fallback mock data for when Supabase is not set up
    const DATA = {
      creators: [
        { id: 1, name: "Demo Creator", handle: "democreator", email: "creator@scal3.xyz", password: "create123", tier: "Gold", wallet: "0x7a3f8B2c9D1e4F5a", totalEarned: 2340, avatar: "ü¶Å", campaigns: [1, 2] },
        { id: 2, name: "Sarah Chen", handle: "sarahweb3", email: "sarah@test.com", password: "pass123", tier: "Platinum", wallet: "0x8b4c9D2e0F1a2B3c", totalEarned: 5120, avatar: "üêâ", campaigns: [1] },
        { id: 3, name: "Mike Rodriguez", handle: "mikerod", email: "mike@test.com", password: "pass123", tier: "Silver", wallet: "0x9c5d0E3f1A2b3C4d", totalEarned: 890, avatar: "ü¶ä", campaigns: [1] },
        { id: 4, name: "Emma Wilson", handle: "emmawilson", email: "emma@test.com", password: "pass123", tier: "Gold", wallet: "0x1a2b3C4d5E6f7A8b", totalEarned: 3200, avatar: "ü¶ã", campaigns: [1] },
        { id: 5, name: "James Park", handle: "jamespark", email: "james@test.com", password: "pass123", tier: "Platinum", wallet: "0x2b3c4D5e6F7a8B9c", totalEarned: 7650, avatar: "üê∫", campaigns: [1, 2] },
        { id: 6, name: "Lisa Wang", handle: "lisawang", email: "lisa@test.com", password: "pass123", tier: "Diamond", wallet: "0x3c4d5E6f7A8b9C0d", totalEarned: 12400, avatar: "üëë", campaigns: [1, 2] },
      ],
      campaigns: [
        { id: 1, name: "Arbitrum Odyssey", brand: "Arbitrum", brandLogo: "https://cryptologos.cc/logos/arbitrum-arb-logo.png", status: "Active", budget: 25000, startDate: "2026-01-05", endDate: "2026-02-05",
          description: "Create engaging content about Arbitrum's L2 ecosystem and DeFi benefits.",
          about: "Arbitrum is the leading Layer 2 scaling solution for Ethereum. This campaign aims to increase awareness and educate users about L2 benefits.",
          requirements: ["Tag @arbitrum in every post", "Use #ArbitrumOdyssey hashtag", "Original content only", "Minimum 3 posts to qualify"],
          basePayout: { Diamond: 100, Platinum: 60, Gold: 35, Silver: 15, Bronze: 10 },
          tierChampions: { Diamond: 1500, Platinum: 1250, Gold: 1000, Silver: 750, Bronze: 500 },
          bonusPool: [{ place: "1st", amount: 2500 }, { place: "2nd", amount: 1500 }, { place: "3rd", amount: 1000 }, { place: "4-10th", amount: 400 }],
          minPosts: 3, links: { website: "https://arbitrum.io", twitter: "https://twitter.com/arbitrum" }
        },
        { id: 2, name: "Uniswap v4 Launch", brand: "Uniswap", brandLogo: "https://cryptologos.cc/logos/uniswap-uni-logo.png", status: "Active", budget: 18000, startDate: "2026-01-10", endDate: "2026-02-10",
          description: "Build excitement for Uniswap v4 and its revolutionary new features.",
          about: "Uniswap v4 represents the next evolution of decentralized exchanges with hooks and improved capital efficiency.",
          requirements: ["Tag @Uniswap", "Use #Uniswapv4", "Educational content required", "Min 3 posts"],
          basePayout: { Diamond: 80, Platinum: 50, Gold: 30, Silver: 12, Bronze: 8 },
          tierChampions: { Diamond: 1200, Platinum: 1000, Gold: 800, Silver: 600, Bronze: 400 },
          bonusPool: [{ place: "1st", amount: 2000 }, { place: "2nd", amount: 1200 }, { place: "3rd", amount: 800 }],
          minPosts: 3, links: { website: "https://uniswap.org", twitter: "https://twitter.com/uniswap" }
        },
        { id: 3, name: "Base Onchain Summer", brand: "Base", brandLogo: "https://avatars.githubusercontent.com/u/108554348", status: "Upcoming", budget: 30000, startDate: "2026-02-15", endDate: "2026-03-15",
          description: "Celebrate building on Base with tutorials and project highlights.",
          about: "Base is Coinbase's L2 bringing millions of users onchain.",
          requirements: ["Tag @base", "Use #OnchainSummer", "Highlight Base projects", "Min 3 posts"],
          basePayout: { Diamond: 120, Platinum: 75, Gold: 45, Silver: 20, Bronze: 12 },
          tierChampions: { Diamond: 1800, Platinum: 1500, Gold: 1200, Silver: 900, Bronze: 600 },
          bonusPool: [{ place: "1st", amount: 3000 }, { place: "2nd", amount: 2000 }, { place: "3rd", amount: 1500 }],
          minPosts: 3, links: { website: "https://base.org", twitter: "https://twitter.com/base" }
        },
      ],
      submissions: [
        { id: 1, campaignId: 1, creatorId: 6, handle: "lisawang", tier: "Diamond", tweetUrl: "https://x.com/lisawang/status/123", submittedAt: "2026-01-15 09:23", views: 8200, likes: 312, retweets: 89, replies: 56, status: "Verified", quality: "Great" },
        { id: 2, campaignId: 1, creatorId: 2, handle: "sarahweb3", tier: "Platinum", tweetUrl: "https://x.com/sarahweb3/status/124", submittedAt: "2026-01-15 10:45", views: 4100, likes: 156, retweets: 45, replies: 28, status: "Verified", quality: "Good" },
        { id: 3, campaignId: 1, creatorId: 5, handle: "jamespark", tier: "Platinum", tweetUrl: "https://x.com/jamespark/status/125", submittedAt: "2026-01-16 08:15", views: 3800, likes: 142, retweets: 38, replies: 22, status: "Verified", quality: "Good" },
        { id: 4, campaignId: 1, creatorId: 1, handle: "cryptoalex", tier: "Gold", tweetUrl: "https://x.com/cryptoalex/status/126", submittedAt: "2026-01-16 11:30", views: 2400, likes: 89, retweets: 23, replies: 12, status: "Verified", quality: "Good" },
        { id: 5, campaignId: 1, creatorId: 4, handle: "emmawilson", tier: "Gold", tweetUrl: "https://x.com/emmawilson/status/127", submittedAt: "2026-01-17 14:20", views: 2100, likes: 78, retweets: 19, replies: 9, status: "Verified", quality: "Okay" },
        { id: 6, campaignId: 1, creatorId: 3, handle: "mikerod", tier: "Silver", tweetUrl: "https://x.com/mikerod/status/128", submittedAt: "2026-01-17 16:45", views: 890, likes: 34, retweets: 8, replies: 5, status: "Verified", quality: "Good" },
        { id: 7, campaignId: 1, creatorId: 6, handle: "lisawang", tier: "Diamond", tweetUrl: "https://x.com/lisawang/status/129", submittedAt: "2026-01-19 10:00", views: 7500, likes: 289, retweets: 78, replies: 45, status: "Verified", quality: "Amazing" },
        { id: 8, campaignId: 1, creatorId: 6, handle: "lisawang", tier: "Diamond", tweetUrl: "https://x.com/lisawang/status/132", submittedAt: "2026-01-20 14:00", views: 6800, likes: 256, retweets: 67, replies: 38, status: "Verified", quality: "Great" },
        { id: 9, campaignId: 1, creatorId: 1, handle: "cryptoalex", tier: "Gold", tweetUrl: "https://x.com/cryptoalex/status/130", submittedAt: "2026-01-20 09:15", views: 0, likes: 0, retweets: 0, replies: 0, status: "Pending", quality: "Good" },
        { id: 10, campaignId: 1, creatorId: 4, handle: "emmawilson", tier: "Gold", tweetUrl: "https://x.com/emmawilson/status/131", submittedAt: "2026-01-20 11:45", views: 0, likes: 0, retweets: 0, replies: 0, status: "Pending", quality: "Good" },
      ],
      paymentHistory: []
    };

    // Utils
    const qualityMult = { Poor: 0.5, Okay: 0.8, Good: 1, Great: 1.25, Amazing: 1.5 };
    const tierMod = { Diamond: 0.9, Platinum: 0.95, Gold: 1, Silver: 1.05, Bronze: 1.1 };
    const calcScore = (v, l, r, p, q = 'Good', t = 'Gold') => Math.round(((v||0) + (l||0)*5 + (r||0)*10 + (p||0)*3) * (qualityMult[q]||1) * (tierMod[t]||1));
    const daysLeft = (d) => Math.max(0, Math.ceil((new Date(d) - new Date()) / 86400000));
    const fmtDate = (d) => {
      if (!d) return '';
      const date = new Date(d);
      // Check if time is included (not midnight)
      const hasTime = d.includes('T') && !d.endsWith('T00:00');
      if (hasTime) {
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' ' + date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
      }
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    };
    const ts = (t) => ({ Diamond: 'bg-cyan-100 text-cyan-700', Platinum: 'bg-slate-200 text-slate-700', Gold: 'bg-yellow-100 text-yellow-700', Silver: 'bg-gray-200 text-gray-600', Bronze: 'bg-amber-100 text-amber-700' }[t] || 'bg-gray-100');
    const tg = (t) => ({ Diamond: 'from-cyan-400 to-blue-500', Platinum: 'from-slate-400 to-slate-600', Gold: 'from-yellow-400 to-amber-500', Silver: 'from-gray-400 to-gray-500', Bronze: 'from-amber-600 to-amber-700' }[t] || 'from-gray-400 to-gray-600');
    const getParticipants = (subs, campId) => new Set(subs.filter(s => s.campaignId === campId).map(s => s.creatorId)).size;

    // SCAL3 Logo PNG base64
    const SCAL3_LOGO = 'data:image/jpeg;base64,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';

    // Components
    // SCAL3 Logo with PNG
    const Logo = ({ size = 'md', light = false }) => (
      <div className="flex items-center gap-2">
        <img src={SCAL3_LOGO} alt="SCAL3" className={size === 'lg' ? 'w-11 h-11' : 'w-9 h-9'} style={{borderRadius: '8px'}} />
        <div className="flex flex-col leading-tight">
          <span className={`font-bold ${light ? 'text-white' : 'text-[#232324]'} ${size === 'lg' ? 'text-2xl' : 'text-xl'}`}>SCAL3</span>
          <span className={`text-[9px] ${light ? 'text-white/60' : 'text-[#232324]/60'} font-semibold tracking-wider`}>CREATORVERSE</span>
        </div>
      </div>
    );

    const Avatar = ({ user, size = 'md' }) => {
      const sizeClasses = size === 'xl' ? 'w-20 h-20 text-3xl' : size === 'lg' ? 'w-14 h-14 text-2xl' : 'w-9 h-9 text-base';
      
      if (user?.profilePic) {
        return (
          <img 
            src={user.profilePic} 
            alt={user.name || ''} 
            className={`${sizeClasses} rounded-full border-3 border-[#232324] object-cover shadow-brutal-sm`}
          />
        );
      }
      
      return (
        <div className={`${sizeClasses} rounded-full bg-gradient-to-br ${tg(user?.tier)} border-3 border-[#232324] flex items-center justify-center shadow-brutal-sm`}>
          {user?.avatar || 'üë§'}
        </div>
      );
    };

    const FAQ = ({ items }) => {
      const [open, setOpen] = useState(null);
      return (
        <div className="space-y-2">
          {items.map((item, i) => (
            <div key={i} className="bg-white rounded-xl border-3 border-[#232324] overflow-hidden">
              <button onClick={() => setOpen(open === i ? null : i)} className="w-full px-4 py-3 flex items-center justify-between font-semibold text-left hover:bg-[#FFF7E9]">
                <span>{item.q}</span><span className="text-xl">{open === i ? '‚àí' : '+'}</span>
              </button>
              {open === i && <div className="px-4 pb-4 text-[#232324]/70 text-sm">{item.a}</div>}
            </div>
          ))}
        </div>
      );
    };

    // Login Page with Simple Sign Up
    const Login = ({ onLogin, creators, setCreators, landingStats, supabaseData }) => {
      const [mode, setMode] = useState('login'); // 'login' or 'signup'
      const [email, setEmail] = useState('');
      const [pass, setPass] = useState('');
      const [err, setErr] = useState('');
      const [loading, setLoading] = useState(false);
      const [showForgot, setShowForgot] = useState(false);
      const [forgotEmail, setForgotEmail] = useState('');
      const [forgotLoading, setForgotLoading] = useState(false);
      const [newPass, setNewPass] = useState('');
      const [resetSuccess, setResetSuccess] = useState(false);
      
      // Password reset via link states
      const [showResetModal, setShowResetModal] = useState(false);
      const [resetToken, setResetToken] = useState('');
      const [resetNewPass, setResetNewPass] = useState('');
      const [resetConfirmPass, setResetConfirmPass] = useState('');
      const [resetLoading, setResetLoading] = useState(false);
      const [resetError, setResetError] = useState('');
      const [resetComplete, setResetComplete] = useState(false);
      
      // Team member invite states
      const [showTeamInviteModal, setShowTeamInviteModal] = useState(false);
      const [teamInviteToken, setTeamInviteToken] = useState('');
      const [teamMemberData, setTeamMemberData] = useState(null);
      const [teamInviteName, setTeamInviteName] = useState('');
      const [teamInvitePass, setTeamInvitePass] = useState('');
      const [teamInviteConfirmPass, setTeamInviteConfirmPass] = useState('');
      const [teamInviteLoading, setTeamInviteLoading] = useState(false);
      const [teamInviteError, setTeamInviteError] = useState('');
      const [teamInviteComplete, setTeamInviteComplete] = useState(false);
      
      // Check URL for reset token or team invite token on mount
      useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        
        // Check for password reset token
        const resetTokenParam = params.get('reset');
        if (resetTokenParam) {
          setResetToken(resetTokenParam);
          setShowResetModal(true);
          window.history.replaceState({}, '', window.location.pathname);
          return;
        }
        
        // Check for team invite token
        const teamInviteTokenParam = params.get('team-invite');
        if (teamInviteTokenParam && supabaseData?.getTeamMemberByToken) {
          setTeamInviteToken(teamInviteTokenParam);
          // Fetch team member data
          supabaseData.getTeamMemberByToken(teamInviteTokenParam).then(member => {
            if (member) {
              setTeamMemberData(member);
              setTeamInviteName(member.name || '');
              setShowTeamInviteModal(true);
            } else {
              setErr('Invalid or expired invite link.');
            }
          });
          window.history.replaceState({}, '', window.location.pathname);
        }
      }, [supabaseData]);

      // Simple hash function for password
      const hashPassword = (password) => {
        let hash = 0;
        for (let i = 0; i < password.length; i++) {
          const char = password.charCodeAt(i);
          hash = ((hash << 5) - hash) + char;
          hash = hash & hash;
        }
        return 'hash_' + Math.abs(hash).toString(16);
      };

      const handleLogin = async (e) => {
        e.preventDefault();
        setErr('');
        setLoading(true);
        
        try {
          // Admin owner login
          if (email.toLowerCase() === 'scal3xyz@gmail.com' && pass === 'Arena123') {
            setLoading(false);
            return onLogin({ isAdmin: true, isOwner: true, name: 'Admin', email: 'scal3xyz@gmail.com' });
          }
          
          // Try creator login first
          if (supabaseData?.loginUser) {
            try {
              const user = await supabaseData.loginUser(email, pass);
              
              if (user.status === 'Paused') {
                setErr('Your account has been paused. Please contact support.');
                setLoading(false);
                return;
              }
              
              setLoading(false);
              onLogin(user, false);
              return;
            } catch (creatorErr) {
              // Creator login failed, try team member login
              if (supabaseData?.loginTeamMember) {
                try {
                  const teamUser = await supabaseData.loginTeamMember(email, pass);
                  setLoading(false);
                  onLogin(teamUser, false);
                  return;
                } catch (teamErr) {
                  // Both failed - show error
                  throw creatorErr; // Show original creator error
                }
              }
              throw creatorErr;
            }
          }
          
          // Fallback if no Supabase
          setErr('Unable to connect to database. Please try again.');
        } catch (error) {
          console.error('Login error:', error);
          setErr(error.message || 'Login failed. Please try again.');
        }
        setLoading(false);
      };

      const handleSignup = async (e) => {
        e.preventDefault();
        setErr('');
        setLoading(true);
        
        try {
          // Check if email exists in database (synced from Notion)
          const creator = creators.find(x => x.email.toLowerCase() === email.toLowerCase());
          
          if (!creator) {
            setErr('This email is not registered as an approved Creatorverse creator. Apply to join at scal3.xyz');
            setLoading(false);
            return;
          }
          
          if (creator.password_hash) {
            setErr('Account already exists. Please use Log In instead.');
            setLoading(false);
            return;
          }
          
          // Let them in, but flag that they need to set password
          onLogin(creator, true); // true = needs to set password
          
        } catch (error) {
          setErr('Signup failed. Please try again.');
        }
        setLoading(false);
      };

      const handleForgotSubmit = async () => {
        if (!forgotEmail || !forgotEmail.includes('@')) {
          setErr('Please enter a valid email address');
          return;
        }
        
        setForgotLoading(true);
        setErr('');
        
        const user = creators.find(c => c.email.toLowerCase() === forgotEmail.toLowerCase());
        
        if (!user) { 
          setErr('No account found with this email');
          setForgotLoading(false);
          return;
        }
        
        if (!user.password_hash) {
          setErr('This account hasn\'t been set up yet. Please sign up first.');
          setForgotLoading(false);
          return;
        }
        
        // Generate a secure reset token
        const resetToken = Math.random().toString(36).slice(2) + Math.random().toString(36).slice(2) + Date.now().toString(36);
        const expiresAt = new Date(Date.now() + 60 * 60 * 1000).toISOString(); // 1 hour from now
        
        try {
          // Save reset token to database
          if (supabaseData?.updateCreator) {
            await supabaseData.updateCreator(user.id, { 
              reset_token: resetToken,
              reset_token_expires: expiresAt
            });
          }
          
          // Send email with reset link
          const emailResponse = await fetch('/api/send-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type: 'password-reset',
              to: forgotEmail,
              data: { resetToken }
            })
          });
          
          const emailResult = await emailResponse.json();
          
          if (emailResponse.ok) {
            setResetSuccess(true);
            setTimeout(() => { 
              setShowForgot(false); 
              setForgotEmail(''); 
              setResetSuccess(false); 
            }, 5000);
          } else {
            console.error('Email API error:', emailResult);
            setErr(emailResult.error || 'Failed to send email. Please try again.');
          }
        } catch (error) {
          console.error('Password reset error:', error);
          setErr('Something went wrong. Please try again.');
        }
        
        setForgotLoading(false);
      };

      // Handle the actual password reset (when user clicks link from email)
      const handleResetPassword = async () => {
        setResetError('');
        
        if (resetNewPass.length < 6) {
          setResetError('Password must be at least 6 characters');
          return;
        }
        
        if (resetNewPass !== resetConfirmPass) {
          setResetError('Passwords do not match');
          return;
        }
        
        setResetLoading(true);
        
        // Find user with this reset token
        const user = creators.find(c => c.reset_token === resetToken);
        
        if (!user) {
          setResetError('Invalid or expired reset link. Please request a new one.');
          setResetLoading(false);
          return;
        }
        
        // Check if token has expired
        if (user.reset_token_expires && new Date(user.reset_token_expires) < new Date()) {
          setResetError('This reset link has expired. Please request a new one.');
          setResetLoading(false);
          return;
        }
        
        try {
          const passwordHash = hashPassword(resetNewPass);
          
          // Update password and clear reset token
          if (supabaseData?.updateCreator) {
            await supabaseData.updateCreator(user.id, { 
              password_hash: passwordHash,
              reset_token: null,
              reset_token_expires: null
            });
            
            // Refresh data to get updated password hash
            if (supabaseData?.fetchData) {
              await supabaseData.fetchData();
            }
          }
          
          // Also update local creators state immediately
          setCreators(creators.map(c => 
            c.id === user.id 
              ? {...c, password_hash: passwordHash, reset_token: null, reset_token_expires: null}
              : c
          ));
          
          setResetComplete(true);
          
          // After 2 seconds, close modal and let user log in
          setTimeout(() => {
            setShowResetModal(false);
            setResetToken('');
            setResetNewPass('');
            setResetConfirmPass('');
            setResetComplete(false);
            // Pre-fill email for convenience
            setEmail(user.email);
            setMode('login');
          }, 2000);
          
        } catch (error) {
          console.error('Password update error:', error);
          setResetError('Something went wrong. Please try again.');
        }
        
        setResetLoading(false);
      };

      // Handle team member invite signup
      const handleTeamInviteSignup = async () => {
        setTeamInviteError('');
        
        if (!teamInviteName.trim()) {
          setTeamInviteError('Please enter your name');
          return;
        }
        
        if (teamInvitePass.length < 6) {
          setTeamInviteError('Password must be at least 6 characters');
          return;
        }
        
        if (teamInvitePass !== teamInviteConfirmPass) {
          setTeamInviteError('Passwords do not match');
          return;
        }
        
        if (!teamMemberData) {
          setTeamInviteError('Invalid invite. Please request a new invite link.');
          return;
        }
        
        // Check if token has expired
        if (teamMemberData.invite_token_expires && new Date(teamMemberData.invite_token_expires) < new Date()) {
          setTeamInviteError('This invite link has expired. Please request a new one.');
          return;
        }
        
        setTeamInviteLoading(true);
        
        try {
          const passwordHash = hashPassword(teamInvitePass);
          
          // Update team member with password and activate
          if (supabaseData?.updateTeamMember) {
            await supabaseData.updateTeamMember(teamMemberData.id, {
              name: teamInviteName.trim(),
              password_hash: passwordHash,
              status: 'Active',
              invite_token: null,
              invite_token_expires: null,
              joined_at: new Date().toISOString()
            });
          }
          
          setTeamInviteComplete(true);
          
          // After 2 seconds, close modal and pre-fill email for login
          setTimeout(() => {
            setShowTeamInviteModal(false);
            setTeamInviteToken('');
            setTeamInviteName('');
            setTeamInvitePass('');
            setTeamInviteConfirmPass('');
            setTeamInviteComplete(false);
            setTeamMemberData(null);
            // Pre-fill email for login
            setEmail(teamMemberData.email);
            setMode('login');
          }, 2500);
          
        } catch (error) {
          console.error('Team invite signup error:', error);
          setTeamInviteError('Something went wrong. Please try again.');
        }
        
        setTeamInviteLoading(false);
      };

      return (
        <div className="min-h-screen bg-[#FFF7E9] flex">
          <div className="hidden lg:flex lg:w-1/2 bg-gradient-to-br from-[#2D7FF9] to-[#1a5fd4] p-12 flex-col justify-between">
            <div className="flex items-center justify-between"><Logo size="lg" light={true} /><div className="flex gap-2"><a href="https://x.com/scal3xyz" target="_blank" className="w-10 h-10 rounded-lg border-2 border-[#FFF7E9]/30 bg-[#FFF7E9]/10 flex items-center justify-center text-[#FFF7E9] hover:bg-[#FFF7E9]/20">ùïè</a><a href="https://www.scal3.xyz/" target="_blank" className="w-10 h-10 rounded-lg border-2 border-[#FFF7E9]/30 bg-[#FFF7E9]/10 flex items-center justify-center text-[#FFF7E9] hover:bg-[#FFF7E9]/20">üåê</a></div></div>
            <div>
              <h1 className="text-5xl font-bold text-[#FFF7E9] mb-4">Creatorverse Arena</h1>
              <p className="text-xl text-[#FFF7E9]/80 mb-8">The premier platform for crypto creator campaigns. Compete, create, and earn.</p>
              <div className="grid grid-cols-3 gap-4">
                {[[landingStats?.creators || '250+', 'Creators'], [landingStats?.paidOut || '$500K+', 'Paid Out'], [landingStats?.campaigns || '50+', 'Campaigns']].map(([n, l], i) => (
                  <div key={i} className="bg-white/10 backdrop-blur rounded-xl p-4 border border-white/20">
                    <p className="text-2xl font-bold text-white">{n}</p>
                    <p className="text-white/70 text-sm">{l}</p>
                  </div>
                ))}
              </div>
            </div>
            <p className="text-white/50 text-sm">¬© 2026 SCAL3. All rights reserved.</p>
          </div>
          <div className="flex-1 flex items-center justify-center p-4 sm:p-8">
            <div className="w-full max-w-md">
              <div className="lg:hidden mb-6 sm:mb-8"><Logo size="lg" /></div>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 sm:p-8">
                {/* Tab Switcher */}
                <div className="flex mb-6 bg-[#FFF7E9] rounded-xl p-1 border-2 border-[#232324]">
                  <button 
                    onClick={() => { setMode('login'); setErr(''); }}
                    className={`flex-1 py-2 rounded-lg font-bold text-sm transition-all ${mode === 'login' ? 'bg-[#2D7FF9] text-white' : 'text-[#232324]/60 hover:text-[#232324]'}`}
                  >
                    Log In
                  </button>
                  <button 
                    onClick={() => { setMode('signup'); setErr(''); }}
                    className={`flex-1 py-2 rounded-lg font-bold text-sm transition-all ${mode === 'signup' ? 'bg-[#2D7FF9] text-white' : 'text-[#232324]/60 hover:text-[#232324]'}`}
                  >
                    Sign Up
                  </button>
                </div>

                {mode === 'login' ? (
                  <>
                    <h2 className="text-xl sm:text-2xl font-bold text-[#232324] mb-2">Welcome back!</h2>
                    <p className="text-[#232324]/60 mb-4 sm:mb-6 text-sm sm:text-base">Sign in to access your dashboard</p>
                    {err && <div className="bg-red-100 border-2 border-red-400 text-red-700 px-3 sm:px-4 py-2 rounded-lg mb-4 text-sm">{err}</div>}
                    <form onSubmit={handleLogin} className="space-y-4">
                      <div><label className="block text-sm font-bold text-[#232324] mb-2">Email</label><input type="email" value={email} onChange={e => setEmail(e.target.value)} required className="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9]" placeholder="you@example.com" /></div>
                      <div><label className="block text-sm font-bold text-[#232324] mb-2">Password</label><input type="password" value={pass} onChange={e => setPass(e.target.value)} required className="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9]" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" /></div>
                      <button type="button" onClick={() => { setShowForgot(true); setErr(''); }} className="text-[#2D7FF9] text-sm font-semibold hover:underline">Forgot password?</button>
                      <button type="submit" disabled={loading} className="w-full bg-[#2D7FF9] text-white py-3 sm:py-4 rounded-xl font-bold text-base sm:text-lg border-3 border-[#232324] shadow-brutal hover-brutal disabled:opacity-50">
                        {loading ? 'Signing in...' : 'Sign In ‚Üí'}
                      </button>
                    </form>
                  </>
                ) : (
                  <>
                    <h2 className="text-xl sm:text-2xl font-bold text-[#232324] mb-2">Join the Arena</h2>
                    <p className="text-[#232324]/60 mb-4 sm:mb-6 text-sm sm:text-base">Enter your email to get started</p>
                    {err && <div className="bg-red-100 border-2 border-red-400 text-red-700 px-3 sm:px-4 py-2 rounded-lg mb-4 text-sm">{err}</div>}
                    <form onSubmit={handleSignup} className="space-y-4">
                      <div><label className="block text-sm font-bold text-[#232324] mb-2">Email</label><input type="email" value={email} onChange={e => setEmail(e.target.value)} required className="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9]" placeholder="you@example.com" /></div>
                      <button type="submit" disabled={loading} className="w-full bg-[#18B369] text-white py-3 sm:py-4 rounded-xl font-bold text-base sm:text-lg border-3 border-[#232324] shadow-brutal hover-brutal disabled:opacity-50">
                        {loading ? 'Checking...' : 'Continue ‚Üí'}
                      </button>
                    </form>
                    <div className="mt-4 p-3 bg-[#FFF7E9] rounded-lg border-2 border-[#232324]/20">
                      <p className="text-xs text-[#232324]/70 text-center">
                        Only approved Creatorverse creators can sign up.
                        <a href="https://www.scal3.xyz/" target="_blank" className="text-[#2D7FF9] font-semibold hover:underline ml-1">Apply to join ‚Üí</a>
                      </p>
                    </div>
                  </>
                )}
              </div>
            </div>
          </div>
          {showForgot && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => !forgotLoading && setShowForgot(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-sm w-full" onClick={e => e.stopPropagation()}>
                {resetSuccess ? (
                  <div className="text-center py-4">
                    <div className="text-5xl mb-4">üìß</div>
                    <h3 className="text-xl font-bold text-[#232324] mb-2">Check Your Email!</h3>
                    <p className="text-[#232324]/70 mb-2">We've sent a password reset link to:</p>
                    <p className="font-semibold text-[#2D7FF9] text-lg mb-4">{forgotEmail}</p>
                    <div className="bg-[#FFF7E9] rounded-lg p-3 border-2 border-[#232324]/20">
                      <p className="text-sm text-[#232324]/70">Click the link in the email to set a new password. The link expires in 1 hour.</p>
                    </div>
                  </div>
                ) : (
                  <div>
                    <div className="flex items-center gap-3 mb-4">
                      <div className="text-3xl">üîê</div>
                      <h3 className="text-xl font-bold text-[#232324]">Forgot Password</h3>
                    </div>
                    <p className="text-sm text-[#232324]/70 mb-4">Enter your email address and we'll send you a temporary password.</p>
                    {err && (
                      <div className="bg-red-50 border-2 border-red-200 text-red-600 px-3 py-2 rounded-lg text-sm mb-4 flex items-center gap-2">
                        <span>‚ö†Ô∏è</span> {err}
                      </div>
                    )}
                    <div className="space-y-4">
                      <input 
                        type="email" 
                        value={forgotEmail} 
                        onChange={e => { setForgotEmail(e.target.value); setErr(''); }}
                        placeholder="Email address" 
                        className="w-full px-4 py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] focus:border-[#2D7FF9] focus:outline-none transition-colors" 
                        disabled={forgotLoading}
                        onKeyDown={e => e.key === 'Enter' && !forgotLoading && forgotEmail && handleForgotSubmit()}
                      />
                      <div className="flex gap-3">
                        <button 
                          onClick={() => { setShowForgot(false); setErr(''); setForgotEmail(''); }} 
                          disabled={forgotLoading} 
                          className="flex-1 py-3 rounded-xl font-semibold border-3 border-[#232324] hover:bg-[#FFF7E9] disabled:opacity-50 transition-colors"
                        >
                          Cancel
                        </button>
                        <button 
                          onClick={handleForgotSubmit} 
                          disabled={forgotLoading || !forgotEmail} 
                          className="flex-1 py-3 rounded-xl font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324] disabled:opacity-50 hover:bg-[#1a5fd4] transition-colors flex items-center justify-center gap-2"
                        >
                          {forgotLoading ? (
                            <>
                              <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                              </svg>
                              Sending...
                            </>
                          ) : (
                            <>Send Reset Email</>
                          )}
                        </button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}
          
          {/* Password Reset Modal (when user clicks link from email) */}
          {showResetModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-sm w-full" onClick={e => e.stopPropagation()}>
                {resetComplete ? (
                  <div className="text-center py-4">
                    <div className="text-5xl mb-4">‚úÖ</div>
                    <h3 className="text-xl font-bold text-[#232324] mb-2">Password Updated!</h3>
                    <p className="text-[#232324]/70">Your password has been changed successfully. You can now log in with your new password.</p>
                  </div>
                ) : (
                  <div>
                    <div className="flex items-center gap-3 mb-4">
                      <div className="text-3xl">üîê</div>
                      <h3 className="text-xl font-bold text-[#232324]">Set New Password</h3>
                    </div>
                    <p className="text-sm text-[#232324]/70 mb-4">Enter your new password below.</p>
                    {resetError && (
                      <div className="bg-red-50 border-2 border-red-200 text-red-600 px-3 py-2 rounded-lg text-sm mb-4 flex items-center gap-2">
                        <span>‚ö†Ô∏è</span> {resetError}
                      </div>
                    )}
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-[#232324] mb-1">New Password</label>
                        <input 
                          type="password" 
                          value={resetNewPass} 
                          onChange={e => { setResetNewPass(e.target.value); setResetError(''); }}
                          placeholder="At least 6 characters" 
                          className="w-full px-4 py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] focus:border-[#2D7FF9] focus:outline-none transition-colors" 
                          disabled={resetLoading}
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-[#232324] mb-1">Confirm Password</label>
                        <input 
                          type="password" 
                          value={resetConfirmPass} 
                          onChange={e => { setResetConfirmPass(e.target.value); setResetError(''); }}
                          placeholder="Re-enter your password" 
                          className="w-full px-4 py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] focus:border-[#2D7FF9] focus:outline-none transition-colors" 
                          disabled={resetLoading}
                          onKeyDown={e => e.key === 'Enter' && !resetLoading && resetNewPass && resetConfirmPass && handleResetPassword()}
                        />
                      </div>
                      <button 
                        onClick={handleResetPassword} 
                        disabled={resetLoading || !resetNewPass || !resetConfirmPass} 
                        className="w-full py-3 rounded-xl font-semibold bg-[#18B369] text-white border-3 border-[#232324] disabled:opacity-50 hover:bg-[#14994d] transition-colors flex items-center justify-center gap-2"
                      >
                        {resetLoading ? (
                          <>
                            <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Updating...
                          </>
                        ) : (
                          <>Set New Password</>
                        )}
                      </button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}
          
          {/* Team Member Invite Signup Modal */}
          {showTeamInviteModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-md w-full" onClick={e => e.stopPropagation()}>
                {teamInviteComplete ? (
                  <div className="text-center py-4">
                    <div className="text-5xl mb-4">üéâ</div>
                    <h3 className="text-xl font-bold text-[#232324] mb-2">Welcome to the Team!</h3>
                    <p className="text-[#232324]/70">Your account has been created. You can now log in with your email and password.</p>
                  </div>
                ) : (
                  <div>
                    <div className="flex items-center gap-3 mb-4">
                      <div className="text-3xl">üëã</div>
                      <div>
                        <h3 className="text-xl font-bold text-[#232324]">Welcome to SCAL3 Arena</h3>
                        <p className="text-sm text-[#232324]/60">Complete your admin team account</p>
                      </div>
                    </div>
                    
                    {teamMemberData && (
                      <div className="bg-[#2D7FF9]/10 rounded-lg p-3 mb-4 border-2 border-[#2D7FF9]/30">
                        <p className="text-sm text-[#2D7FF9]">
                          <strong>Email:</strong> {teamMemberData.email}
                        </p>
                      </div>
                    )}
                    
                    {teamInviteError && (
                      <div className="bg-red-50 border-2 border-red-200 text-red-600 px-3 py-2 rounded-lg text-sm mb-4 flex items-center gap-2">
                        <span>‚ö†Ô∏è</span> {teamInviteError}
                      </div>
                    )}
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-bold text-[#232324] mb-1">Your Name</label>
                        <input 
                          type="text" 
                          value={teamInviteName} 
                          onChange={e => { setTeamInviteName(e.target.value); setTeamInviteError(''); }}
                          placeholder="Enter your full name" 
                          className="w-full px-4 py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] focus:border-[#2D7FF9] focus:outline-none transition-colors" 
                          disabled={teamInviteLoading}
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-[#232324] mb-1">Password</label>
                        <input 
                          type="password" 
                          value={teamInvitePass} 
                          onChange={e => { setTeamInvitePass(e.target.value); setTeamInviteError(''); }}
                          placeholder="At least 6 characters" 
                          className="w-full px-4 py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] focus:border-[#2D7FF9] focus:outline-none transition-colors" 
                          disabled={teamInviteLoading}
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-bold text-[#232324] mb-1">Confirm Password</label>
                        <input 
                          type="password" 
                          value={teamInviteConfirmPass} 
                          onChange={e => { setTeamInviteConfirmPass(e.target.value); setTeamInviteError(''); }}
                          placeholder="Re-enter your password" 
                          className="w-full px-4 py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] focus:border-[#2D7FF9] focus:outline-none transition-colors" 
                          disabled={teamInviteLoading}
                          onKeyDown={e => e.key === 'Enter' && !teamInviteLoading && teamInviteName && teamInvitePass && teamInviteConfirmPass && handleTeamInviteSignup()}
                        />
                      </div>
                      <button 
                        onClick={handleTeamInviteSignup} 
                        disabled={teamInviteLoading || !teamInviteName || !teamInvitePass || !teamInviteConfirmPass} 
                        className="w-full py-3 rounded-xl font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324] disabled:opacity-50 hover:bg-[#1a5fd4] transition-colors flex items-center justify-center gap-2"
                      >
                        {teamInviteLoading ? (
                          <>
                            <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Creating Account...
                          </>
                        ) : (
                          <>Complete Setup ‚Üí</>
                        )}
                      </button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}
        </div>
      );
    };

    // Navigation
    const Nav = ({ view, setView, user, onLogout, notifications, setNotifications, supabaseData }) => {
      const [showNotifs, setShowNotifs] = useState(false);
      const unread = notifications?.filter(n => !n.read).length || 0;
      const items = user?.isAdmin 
        ? [['admin-dashboard','üìä','Dashboard'],['admin-campaigns','üèÜ','Campaigns'],['admin-submissions','üìù','Submissions'],['admin-creators','üë•','Creators'],['admin-team','üë§','Team']]
        : [['dashboard','üè†','Home'],['campaigns','üèÜ','Campaigns'],['how-it-works','üìñ','How It Works']];
      
      const markRead = async (id) => {
        setNotifications(notifications.map(n => n.id === id ? {...n, read: true} : n));
        if (supabaseData?.markNotificationRead) {
          await supabaseData.markNotificationRead(id);
        }
      };
      
      const clearAll = async () => {
        setNotifications(notifications.map(n => ({...n, read: true})));
        if (supabaseData?.markAllNotificationsRead && user?.id) {
          await supabaseData.markAllNotificationsRead(user.id);
        }
      };
      
      const goHome = () => setView(user?.isAdmin ? 'admin-dashboard' : 'dashboard');
      return (
        <nav className="bg-white border-b-4 border-[#232324] sticky top-0 z-50">
          <div className="max-w-7xl mx-auto px-2 sm:px-4 flex items-center justify-between h-14 sm:h-16">
            <div className="flex items-center gap-2 sm:gap-3 cursor-pointer" onClick={goHome}>
              <div className="hidden sm:block"><Logo /></div>
              <div className="sm:hidden w-8 h-8 bg-[#2D7FF9] rounded-lg border-2 border-[#232324] flex items-center justify-center"><span className="text-white font-bold text-sm">S3</span></div>
              <span className="bg-[#2D7FF9] text-white text-[10px] sm:text-xs font-bold px-2 sm:px-3 py-1 rounded-full border-2 border-[#232324]">ARENA</span>
              {user?.isAdmin && <span className="bg-red-500 text-white text-[10px] sm:text-xs font-bold px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full">ADMIN</span>}
            </div>
            <div className="flex gap-0.5 sm:gap-1">
              {items.map(([id, icon, label]) => (
                <button key={id} onClick={() => setView(id)} className={`px-2 sm:px-4 py-1.5 sm:py-2 rounded-lg font-semibold text-xs sm:text-sm flex items-center gap-1 sm:gap-1.5 ${view.startsWith(id) || (id === 'campaigns' && view === 'campaign') || (id === 'admin-campaigns' && view === 'admin-campaign-detail') ? 'bg-[#2D7FF9] text-white' : 'text-[#232324] hover:bg-[#FFF7E9]'}`}>
                  <span className="text-sm sm:text-base">{icon}</span><span className="hidden sm:inline">{label}</span>
                </button>
              ))}
            </div>
            <div className="flex items-center gap-1.5 sm:gap-3">
              {!user?.isAdmin && (
                <div className="relative">
                  <button onClick={() => setShowNotifs(!showNotifs)} className="relative w-9 h-9 sm:w-10 sm:h-10 rounded-lg border-2 border-[#232324] bg-[#FFF7E9] flex items-center justify-center hover:bg-[#2D7FF9] hover:text-white transition-all">
                    <span className="text-lg">üîî</span>
                    {unread > 0 && <span className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center border-2 border-white">{unread}</span>}
                  </button>
                  {showNotifs && (
                    <div className="absolute right-0 top-12 w-72 sm:w-80 bg-white rounded-xl border-3 border-[#232324] shadow-brutal z-50">
                      <div className="flex items-center justify-between p-3 border-b-2 border-[#232324]/20"><h4 className="font-bold text-sm">Notifications</h4>{unread > 0 && <button onClick={clearAll} className="text-xs text-[#2D7FF9] font-semibold">Mark all read</button>}</div>
                      <div className="max-h-64 overflow-y-auto">
                        {notifications?.length === 0 ? <p className="p-4 text-center text-sm text-[#232324]/60">No notifications</p> : notifications?.slice(0, 10).map(n => (
                          <div key={n.id} onClick={() => markRead(n.id)} className={`p-3 border-b border-[#232324]/10 cursor-pointer hover:bg-[#FFF7E9] ${!n.read ? 'bg-blue-50' : ''}`}>
                            <p className="text-sm font-semibold">{n.title}</p>
                            <p className="text-xs text-[#232324]/60">{n.message}</p>
                            <p className="text-xs text-[#232324]/40 mt-1">{n.time}</p>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              )}
              {!user?.isAdmin ? (
                <button onClick={() => setView('profile')} className="flex items-center gap-1.5 sm:gap-2 bg-[#FFF7E9] px-2 sm:px-3 py-1 sm:py-1.5 rounded-lg border-2 border-[#232324] hover:bg-[#2D7FF9] hover:text-white transition-all">
                  <Avatar user={user} />
                  <div className="text-left hidden sm:block">
                    <p className="text-sm font-bold">@{user?.handle}</p>
                    <p className="text-xs font-semibold opacity-70">View Profile</p>
                  </div>
                </button>
              ) : (
                <button onClick={onLogout} className="text-[#232324]/60 hover:text-[#232324] font-semibold text-xs sm:text-sm">Logout</button>
              )}
            </div>
          </div>
        </nav>
      );
    };

    // Dashboard
    const Dashboard = ({ user, campaigns, subs, setView, setCamp, onUpdateWallet, onUpdateSolanaWallet }) => {
      const [showWalletPrompt, setShowWalletPrompt] = useState(!user.wallet);
      const [walletInput, setWalletInput] = useState('');
      const [solanaWalletInput, setSolanaWalletInput] = useState('');
      const [walletError, setWalletError] = useState('');
      const active = campaigns.filter(c => c.status === 'Active');
      const upcoming = campaigns.filter(c => c.status === 'Upcoming');
      const mySubs = subs.filter(s => s.creatorId === user.id);
      
      const handleSaveWallet = () => {
        // EVM wallet validation
        // Must start with 0x and be exactly 42 characters (0x + 40 hex characters)
        if (!walletInput.trim()) {
          setWalletError('Please enter your EVM wallet address');
          return;
        }
        const evmTrimmed = walletInput.trim();
        if (!evmTrimmed.startsWith('0x')) {
          setWalletError('EVM wallet must start with 0x');
          return;
        }
        if (evmTrimmed.length !== 42) {
          setWalletError(`EVM wallet must be exactly 42 characters (yours is ${evmTrimmed.length})`);
          return;
        }
        // Check if remaining characters are valid hex
        const hexPart = evmTrimmed.slice(2);
        if (!/^[0-9a-fA-F]+$/.test(hexPart)) {
          setWalletError('EVM wallet contains invalid characters (must be 0-9, a-f)');
          return;
        }
        
        // Solana wallet validation
        // Base58 encoded, typically 32-44 characters
        if (!solanaWalletInput.trim()) {
          setWalletError('Please enter your Solana wallet address');
          return;
        }
        const solanaTrimmed = solanaWalletInput.trim();
        if (solanaTrimmed.length < 32 || solanaTrimmed.length > 44) {
          setWalletError(`Solana wallet must be 32-44 characters (yours is ${solanaTrimmed.length})`);
          return;
        }
        // Solana uses Base58 encoding (no 0, O, I, l characters)
        if (!/^[1-9A-HJ-NP-Za-km-z]+$/.test(solanaTrimmed)) {
          setWalletError('Solana wallet contains invalid characters');
          return;
        }
        
        onUpdateWallet(evmTrimmed, solanaTrimmed);
        setShowWalletPrompt(false);
      };
      
      return (
        <div className="space-y-6 sm:space-y-8">
          {/* Wallet Prompt Modal */}
          {showWalletPrompt && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-md w-full">
                <div className="text-center mb-6">
                  <span className="text-5xl mb-4 block">üí≥</span>
                  <h2 className="text-2xl font-bold text-[#232324] mb-2">Add Your Wallets</h2>
                  <p className="text-[#232324]/60">Add your wallet addresses to receive campaign payouts.</p>
                </div>
                {walletError && <div className="bg-red-100 border-2 border-red-400 text-red-700 px-4 py-2 rounded-lg mb-4 text-sm">{walletError}</div>}
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-bold text-[#232324] mb-1">EVM Wallet Address *</label>
                    <input 
                      type="text" 
                      value={walletInput} 
                      onChange={e => { setWalletInput(e.target.value); setWalletError(''); }}
                      placeholder="0x..." 
                      className="w-full px-4 py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] font-mono text-sm"
                    />
                    <p className="text-xs text-[#232324]/50 mt-1">üí∞ Most payouts sent as USDC on Arbitrum</p>
                  </div>
                  <div>
                    <label className="block text-sm font-bold text-[#232324] mb-1">Solana Wallet Address *</label>
                    <input 
                      type="text" 
                      value={solanaWalletInput} 
                      onChange={e => { setSolanaWalletInput(e.target.value); setWalletError(''); }}
                      placeholder="Your Solana address..." 
                      className="w-full px-4 py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] font-mono text-sm"
                    />
                    <p className="text-xs text-[#232324]/50 mt-1">üü£ For Solana-based campaign payouts</p>
                  </div>
                  <button 
                    onClick={handleSaveWallet}
                    className="w-full bg-[#2D7FF9] text-white py-3 rounded-xl font-bold text-lg border-3 border-[#232324] shadow-brutal hover-brutal"
                  >
                    Save Wallets ‚Üí
                  </button>
                  <div className="text-center">
                    <button 
                      onClick={() => setShowWalletPrompt(false)}
                      className="text-[#232324]/60 text-sm hover:text-[#232324]"
                    >
                      Skip for now
                    </button>
                    <p className="text-xs text-red-500 mt-1">‚ö†Ô∏è You won't be able to receive payouts without wallets</p>
                  </div>
                </div>
              </div>
            </div>
          )}
          
          {/* Wallet warning banner if still not set */}
          {!user.wallet && !showWalletPrompt && (
            <div 
              onClick={() => setShowWalletPrompt(true)}
              className="bg-amber-50 border-3 border-amber-400 rounded-xl p-4 flex items-center justify-between cursor-pointer hover:bg-amber-100 transition-all"
            >
              <div className="flex items-center gap-3">
                <span className="text-2xl">‚ö†Ô∏è</span>
                <div>
                  <p className="font-bold text-amber-800">Wallet not connected</p>
                  <p className="text-sm text-amber-700">Add your wallet to receive campaign payouts</p>
                </div>
              </div>
              <span className="text-amber-600 font-semibold">Add Wallet ‚Üí</span>
            </div>
          )}
        
          <div className="bg-gradient-to-br from-[#2D7FF9] to-[#1a5fd4] rounded-2xl border-4 border-[#232324] shadow-brutal p-4 sm:p-8">
            <div className="flex flex-col sm:flex-row sm:items-center gap-4 sm:gap-6">
              <div className="flex items-center gap-3 sm:gap-4">
                <Avatar user={user} size="xl" />
                <div>
                  <p className="text-white/70 text-xs sm:text-sm font-semibold uppercase">Welcome back</p>
                  <h1 className="text-xl sm:text-3xl font-bold text-white">@{user.handle}</h1>
                  <span className={`inline-block mt-1 sm:mt-2 px-2 sm:px-3 py-0.5 sm:py-1 rounded-full text-xs sm:text-sm font-bold border-2 border-white/30 ${ts(user.tier)}`}>Rank: {user.tier}</span>
                </div>
              </div>
              <div className="sm:ml-auto grid grid-cols-3 gap-2 sm:gap-4">
                {[['$' + (user.totalEarned || 0).toLocaleString(), 'Earned'], [active.length, 'Active'], [mySubs.filter(s => s.status === 'Verified').length, 'Posts']].map(([v, l], i) => (
                  <div key={i} className="bg-white/15 backdrop-blur rounded-xl p-2 sm:p-4 text-center border border-white/20">
                    <p className="text-lg sm:text-2xl font-bold text-white">{v}</p>
                    <p className="text-white/70 text-[10px] sm:text-xs uppercase">{l}</p>
                  </div>
                ))}
              </div>
            </div>
          </div>

          <div>
            <div className="flex items-center justify-between mb-3 sm:mb-4">
              <h2 className="text-lg sm:text-xl font-bold text-[#232324]">üî• Active Campaigns</h2>
              <button onClick={() => setView('campaigns')} className="text-[#2D7FF9] font-semibold text-xs sm:text-sm hover:underline">View All ‚Üí</button>
            </div>
            <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
              {active.map(c => (
                <div key={c.id} onClick={() => { setCamp(c); setView('campaign'); }} className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-5 cursor-pointer hover:border-[#2D7FF9] transition-all">
                  <div className="flex items-center gap-2 sm:gap-3 mb-2 sm:mb-3">
                    <img src={c.brandLogo} alt="" className="w-8 h-8 sm:w-10 sm:h-10 rounded-lg border-2 border-[#232324] bg-white object-contain p-1" onError={e => e.target.style.display='none'} />
                    <div>
                      <span className="text-xs font-bold text-[#2D7FF9] uppercase">{c.brand}</span>
                      <span className="ml-1 sm:ml-2 text-[10px] sm:text-xs bg-green-100 text-green-700 px-1.5 sm:px-2 py-0.5 rounded-full font-semibold">‚óè Live</span>
                    </div>
                  </div>
                  <h3 className="font-bold text-[#232324] text-base sm:text-lg mb-2">{c.name}</h3>
                  <p className="text-xs sm:text-sm text-[#232324]/60 line-clamp-2 mb-2 sm:mb-3">{c.description}</p>
                  <div className="bg-red-50 border border-red-200 rounded-lg px-2 sm:px-3 py-1.5 sm:py-2 mb-2 sm:mb-3">
                    <p className="text-[10px] sm:text-xs font-semibold text-red-600">‚è∞ {daysLeft(c.endDate)} days left ‚Ä¢ Ends {fmtDate(c.endDate)}</p>
                  </div>
                  <div className="flex justify-between items-center">
                    <div><p className="text-[10px] sm:text-xs text-[#232324]/50">Reward Pool</p><p className="text-lg sm:text-xl font-bold text-[#2D7FF9]">${c.budget.toLocaleString()}</p></div>
                    <p className="text-xs sm:text-sm font-semibold text-[#232324]/60">{getParticipants(subs, c.id)} participants</p>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {upcoming.length > 0 && (
            <div>
              <h2 className="text-lg sm:text-xl font-bold text-[#232324] mb-3 sm:mb-4">üóìÔ∏è Coming Soon</h2>
              <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                {upcoming.map(c => (
                  <div key={c.id} className="bg-white/60 rounded-xl border-3 border-[#232324]/30 p-4 sm:p-5">
                    <div className="flex items-center gap-2 sm:gap-3 mb-2 sm:mb-3">
                      <img src={c.brandLogo} alt="" className="w-8 h-8 sm:w-10 sm:h-10 rounded-lg border-2 border-[#232324]/30 bg-white object-contain p-1" onError={e => e.target.style.display='none'} />
                      <span className="text-xs font-bold text-[#232324]/60 uppercase">{c.brand}</span>
                    </div>
                    <h3 className="font-bold text-[#232324]/70 text-base sm:text-lg">{c.name}</h3>
                    <p className="text-xs sm:text-sm text-[#232324]/50 mt-1 sm:mt-2">Starts {fmtDate(c.startDate)}</p>
                    <p className="font-bold text-[#2D7FF9] mt-1">${c.budget.toLocaleString()}</p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    };

    // Campaigns List
    const Campaigns = ({ campaigns, subs, user, setView, setCamp }) => {
      const [search, setSearch] = useState('');
      const [statusFilter, setStatusFilter] = useState('All');
      const statusOrder = { Active: 0, Upcoming: 1, Ended: 2 };
      // Filter out Draft campaigns - creators shouldn't see them
      let filtered = [...campaigns].filter(c => c.status !== 'Draft').sort((a, b) => statusOrder[a.status] - statusOrder[b.status]);
      if (statusFilter !== 'All') filtered = filtered.filter(c => c.status === statusFilter);
      if (search) filtered = filtered.filter(c => c.name.toLowerCase().includes(search.toLowerCase()) || c.brand.toLowerCase().includes(search.toLowerCase()));
      return (
        <div className="space-y-6">
          <h1 className="text-2xl font-bold text-[#232324]">Arena Campaigns</h1>
          <div className="flex flex-col sm:flex-row gap-3">
            <input type="text" value={search} onChange={e => setSearch(e.target.value)} placeholder="Search campaigns..." className="flex-1 px-4 py-3 rounded-xl border-3 border-[#232324] bg-white" />
            <div className="flex gap-2">
              {['All', 'Active', 'Upcoming', 'Ended'].map(s => (
                <button key={s} onClick={() => setStatusFilter(s)} className={`px-4 py-2 rounded-lg font-semibold text-sm border-2 border-[#232324] whitespace-nowrap ${statusFilter === s ? 'bg-[#2D7FF9] text-white' : 'bg-white hover:bg-[#FFF7E9]'}`}>{s}</button>
              ))}
            </div>
          </div>
          <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {filtered.map(c => {
              const isActive = c.status === 'Active';
              const isEnded = c.status === 'Ended';
              return (
              <div key={c.id} onClick={() => { setCamp(c); setView('campaign'); }} className={`bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-5 cursor-pointer hover:border-[#2D7FF9] transition-all ${!isActive ? 'opacity-50 grayscale-[30%]' : ''}`}>
                <div className="flex items-center gap-3 mb-3">
                  <img src={c.brandLogo} alt="" className="w-10 h-10 sm:w-12 sm:h-12 rounded-lg border-2 border-[#232324] bg-white object-contain p-1" onError={e => e.target.style.display='none'} />
                  <div>
                    <span className="text-xs sm:text-sm font-bold text-[#2D7FF9] uppercase block">{c.brand}</span>
                    {isActive && <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-semibold">‚óè Live</span>}
                    {c.status === 'Upcoming' && <span className="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full font-semibold">Upcoming</span>}
                    {isEnded && <span className="text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full font-semibold">Ended</span>}
                  </div>
                </div>
                <h3 className="font-bold text-[#232324] text-base sm:text-lg mb-2">{c.name}</h3>
                <p className="text-sm text-[#232324]/60 line-clamp-2 mb-3">{c.description}</p>
                <div className="bg-[#FFF7E9] rounded-lg px-3 py-2 mb-3 border border-[#232324]/10">
                  <p className="text-xs font-semibold text-[#232324]/60">üìÖ {fmtDate(c.startDate)} - {fmtDate(c.endDate)}</p>
                  {isActive && <p className="text-xs font-bold text-red-500 mt-1">‚è∞ {daysLeft(c.endDate)} days left</p>}
                </div>
                <div className="flex justify-between items-center">
                  <div><p className="text-xs text-[#232324]/50">Reward Pool</p><p className="text-lg sm:text-xl font-bold text-[#2D7FF9]">${c.budget.toLocaleString()}</p></div>
                  <p className="text-xs sm:text-sm font-semibold text-[#232324]/60">{getParticipants(subs, c.id)} participants</p>
                </div>
              </div>
            );})}
          </div>
        </div>
      );
    };

    // Campaign Detail
    const CampaignDetail = ({ camp, user, subs, setSubs, setView, creators, supabaseData }) => {
      const [url, setUrl] = useState('');
      const [done, setDone] = useState(false);
      const [submitError, setSubmitError] = useState('');
      const [submitting, setSubmitting] = useState(false);
      const verified = subs.filter(s => s.campaignId === camp?.id && s.status === 'Verified');
      const mySubs = subs.filter(s => s.campaignId === camp?.id && s.creatorId === user?.id);
      const participants = camp ? getParticipants(subs, camp.id) : 0;
      
      // Normalize tweet URL to extract just the tweet ID
      const normalizeTweetUrl = (tweetUrl) => {
        if (!tweetUrl) return '';
        let normalized = tweetUrl.trim().toLowerCase();
        // Remove protocol
        normalized = normalized.replace(/^https?:\/\//, '');
        // Remove www.
        normalized = normalized.replace(/^www\./, '');
        // Normalize x.com and twitter.com to same format
        normalized = normalized.replace(/^(x\.com|twitter\.com)\//, 'x.com/');
        // Remove query parameters (?s=20, etc.)
        normalized = normalized.split('?')[0];
        // Remove trailing slash
        normalized = normalized.replace(/\/$/, '');
        // Extract tweet ID if possible (the numeric part after /status/)
        const match = normalized.match(/\/status\/(\d+)/);
        if (match) {
          return match[1]; // Return just the tweet ID for comparison
        }
        return normalized;
      };
      
      // Check if URL is duplicate
      const isDuplicateUrl = (newUrl) => {
        const normalizedNew = normalizeTweetUrl(newUrl);
        if (!normalizedNew) return false;
        
        // Check against ALL submissions for this campaign (not just user's)
        return subs.some(s => {
          if (s.campaignId !== camp?.id) return false;
          const normalizedExisting = normalizeTweetUrl(s.tweetUrl);
          return normalizedExisting === normalizedNew;
        });
      };
      
      const lb = Object.values(verified.reduce((a, s) => {
        if (!a[s.creatorId]) { const cr = creators.find(c => c.id === s.creatorId); a[s.creatorId] = { id: s.creatorId, handle: s.handle, tier: s.tier, avatar: cr?.avatar, score: 0, posts: 0 }; }
        a[s.creatorId].score += calcScore(s.views, s.likes, s.retweets, s.replies, s.quality, s.tier);
        a[s.creatorId].posts++;
        return a;
      }, {})).sort((a, b) => b.score - a.score);
      
      const myRank = lb.findIndex(l => l.id === user?.id) + 1;
      const myStats = lb.find(l => l.id === user?.id) || { score: 0, posts: 0 };
      const basePay = camp?.basePayout?.[user?.tier] || 0;
      const maxPotential = basePay + (camp?.tierChampions?.[user?.tier] || 0) + (camp?.bonusPool?.[0]?.amount || 0);

      const submit = async (e) => { 
        e.preventDefault();
        setSubmitError('');
        
        // Validate URL format
        if (!url.trim()) {
          setSubmitError('Please enter a tweet URL');
          return;
        }
        
        // Check if it's a valid Twitter/X URL
        const urlLower = url.toLowerCase();
        if (!urlLower.includes('twitter.com/') && !urlLower.includes('x.com/')) {
          setSubmitError('Please enter a valid Twitter/X URL');
          return;
        }
        
        // Check for duplicate
        if (isDuplicateUrl(url)) {
          setSubmitError('This tweet has already been submitted to this campaign');
          return;
        }
        
        setSubmitting(true);
        
        const newSub = { 
          campaignId: camp.id, 
          creatorId: user.id, 
          handle: user.handle, 
          tier: user.tier, 
          tweetUrl: url.trim(), 
          submittedAt: new Date().toISOString().slice(0,16).replace('T',' '), 
          views: 0, 
          likes: 0, 
          retweets: 0, 
          replies: 0, 
          status: 'Pending', 
          quality: 'Good' 
        };
        
        // Save to Supabase if available
        if (supabaseData?.createSubmission) {
          try {
            await supabaseData.createSubmission(newSub);
            if (supabaseData.fetchData) {
              await supabaseData.fetchData();
            }
          } catch (err) {
            console.error('Failed to save submission:', err);
            setSubmitError('Failed to submit. Please try again.');
            setSubmitting(false);
            return;
          }
        } else {
          // Fallback to local state
          newSub.id = subs.length + 1;
          setSubs([...subs, newSub]);
        }
        
        setUrl(''); 
        setSubmitting(false);
        setDone(true); 
        setTimeout(() => setDone(false), 3000); 
      };
      
      // Guard against missing camp data
      if (!camp) {
        return (
          <div className="space-y-6">
            <button onClick={() => setView('campaigns')} className="text-[#232324] font-semibold hover:text-[#2D7FF9]">‚Üê Back to Campaigns</button>
            <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 text-center">
              <p className="text-[#232324]/60">Campaign not found. Please go back and select a campaign.</p>
            </div>
          </div>
        );
      }

      const faqItems = [
        { q: "How are points calculated?", a: "Points are based on impressions, engagement, content quality, and other proprietary factors. Our algorithm rewards genuine, high-quality content while preventing artificial inflation." },
        { q: "How do I qualify for base payout?", a: "Submit and have verified at least the minimum required number of posts for this campaign (shown in requirements). All posts must meet quality standards and campaign guidelines." },
        { q: "Can I win multiple prizes?", a: "Yes! You can earn base payout + tier championship + leaderboard bonus." },
        { q: "When do I get paid?", a: "Payouts are typically processed within 30 days after the campaign ends." },
      ];

      return (
        <div className="space-y-6">
          <button onClick={() => setView('campaigns')} className="text-[#232324] font-semibold hover:text-[#2D7FF9]">‚Üê Back to Campaigns</button>
          
          <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6">
            <div className="flex flex-col lg:flex-row items-start gap-4 sm:gap-6">
              <div className="flex items-start gap-4 flex-1 min-w-0">
                <img src={camp.brandLogo} alt="" className="w-14 h-14 sm:w-20 sm:h-20 rounded-xl border-3 border-[#232324] bg-white object-contain p-2 flex-shrink-0" onError={e => e.target.style.display='none'} />
                <div className="flex-1 min-w-0">
                  <div className="flex flex-wrap items-center gap-2 mb-1">
                    <span className="text-sm sm:text-lg font-bold text-[#2D7FF9] uppercase">{camp.brand}</span>
                    <span className="text-xs sm:text-sm bg-green-100 text-green-700 px-2 sm:px-3 py-0.5 sm:py-1 rounded-full font-semibold">‚óè Live</span>
                    <span className="text-xs sm:text-sm bg-[#FFF7E9] text-[#232324] px-2 sm:px-3 py-0.5 sm:py-1 rounded-full font-semibold border border-[#232324]/20">üë• {participants} Participants</span>
                  </div>
                  <h1 className="text-xl sm:text-2xl lg:text-3xl font-bold text-[#232324] mb-2">{camp.name}</h1>
                  <div className="flex flex-wrap items-center gap-2 sm:gap-3 text-xs sm:text-sm">
                    <span className="text-red-600 font-semibold">‚è∞ {daysLeft(camp.endDate)} days left</span>
                    <span className="text-[#232324]/60">{fmtDate(camp.startDate)} - {fmtDate(camp.endDate)}</span>
                  </div>
                </div>
              </div>
              <div className="grid grid-cols-2 gap-3 w-full lg:w-auto">
                <div className="bg-[#2D7FF9] rounded-xl border-3 border-[#232324] shadow-brutal p-4 sm:p-5 text-white text-center min-w-[140px]">
                  <p className="text-[10px] sm:text-xs opacity-80 uppercase font-semibold mb-1">Total Reward Pool</p>
                  <p className="text-2xl sm:text-3xl font-bold">${camp.budget.toLocaleString()}</p>
                </div>
                <div className="bg-[#232324] rounded-xl border-3 border-[#232324] p-4 sm:p-5 text-white text-center min-w-[140px]">
                  <p className="text-[10px] sm:text-xs opacity-70 uppercase font-semibold mb-1">Your Potential</p>
                  <p className="text-2xl sm:text-3xl font-bold text-[#FFF7E9]">${maxPotential.toLocaleString()}</p>
                </div>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6">
            <div className="flex flex-col lg:flex-row gap-4 sm:gap-6">
              <div className="flex-1">
                <div className="flex items-center justify-between mb-3 sm:mb-4">
                  <h2 className="text-lg sm:text-xl font-bold text-[#232324]">üìä Live Leaderboard</h2>
                  <span className="text-xs sm:text-sm text-[#232324]/60 font-semibold">{lb.length} creators ranked</span>
                </div>
                {lb.length === 0 ? <p className="text-center py-6 sm:py-8 text-[#232324]/60">No verified submissions yet</p> : (
                  <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead><tr className="border-b-2 border-[#232324]/20"><th className="text-left py-2 px-1 sm:px-2 text-xs sm:text-sm font-bold text-[#232324]/60">#</th><th className="text-left py-2 px-1 sm:px-2 text-xs sm:text-sm font-bold text-[#232324]/60">Creator</th><th className="text-center py-2 px-1 sm:px-2 text-xs sm:text-sm font-bold text-[#232324]/60 hidden sm:table-cell">Tier</th><th className="text-center py-2 px-1 sm:px-2 text-xs sm:text-sm font-bold text-[#232324]/60">Posts</th><th className="text-right py-2 px-1 sm:px-2 text-xs sm:text-sm font-bold text-[#232324]/60">Score</th></tr></thead>
                    <tbody>{lb.slice(0, 15).map((e, i) => (
                      <tr key={e.id} className={`border-b border-[#232324]/10 ${e.id === user.id ? 'bg-[#2D7FF9]/10 ring-2 ring-[#2D7FF9] ring-inset' : ''}`}>
                        <td className="py-2 px-1 sm:px-2"><span className={`w-6 h-6 sm:w-7 sm:h-7 rounded-lg flex items-center justify-center font-bold text-xs sm:text-sm ${i===0?'bg-yellow-400 text-yellow-900':i===1?'bg-gray-300':i===2?'bg-amber-500 text-white':'bg-[#FFF7E9] border border-[#232324]'}`}>{i+1}</span></td>
                        <td className="py-2 px-1 sm:px-2"><div className="flex items-center gap-1.5 sm:gap-2"><div className={`w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-gradient-to-br ${tg(e.tier)} border-2 border-[#232324] flex items-center justify-center text-xs sm:text-sm flex-shrink-0`}>{e.avatar}</div><span className="font-semibold text-sm truncate max-w-[80px] sm:max-w-none">@{e.handle}</span>{e.id === user.id && <span className="text-[10px] sm:text-xs bg-[#2D7FF9] text-white px-1.5 sm:px-2 py-0.5 rounded-full font-bold flex-shrink-0">YOU</span>}</div></td>
                        <td className="py-2 px-1 sm:px-2 text-center hidden sm:table-cell"><span className={`text-xs font-bold px-2 py-1 rounded-full ${ts(e.tier)}`}>{e.tier}</span></td>
                        <td className="py-2 px-1 sm:px-2 text-center font-semibold text-sm">{e.posts}</td>
                        <td className="py-2 px-1 sm:px-2 text-right font-bold text-[#2D7FF9] text-sm">{e.score.toLocaleString()}</td>
                      </tr>
                    ))}</tbody>
                  </table>
                  </div>
                )}
              </div>
              <div className="lg:w-64">
                <div className="bg-[#2D7FF9] rounded-xl border-3 border-[#232324] shadow-brutal p-4 sm:p-5 text-white h-full">
                  <h3 className="text-xs sm:text-sm uppercase opacity-80 font-semibold mb-3 sm:mb-4">Your Performance</h3>
                  <div className="text-center mb-3 sm:mb-4"><p className="text-4xl sm:text-5xl font-bold">{myRank > 0 ? '#'+myRank : '‚Äî'}</p><p className="opacity-80 text-sm">Rank</p></div>
                  <div className="grid grid-cols-2 gap-2 sm:gap-3 mb-3 sm:mb-4">
                    <div className="bg-white/20 rounded-lg p-2 sm:p-3 text-center"><p className="text-xl sm:text-2xl font-bold">{myStats.posts}</p><p className="text-[10px] sm:text-xs opacity-80">Posts</p></div>
                    <div className="bg-white/20 rounded-lg p-2 sm:p-3 text-center"><p className="text-xl sm:text-2xl font-bold">{myStats.score.toLocaleString()}</p><p className="text-[10px] sm:text-xs opacity-80">Score</p></div>
                  </div>
                  <div className="space-y-2 pt-3 sm:pt-4 border-t border-white/20 text-xs sm:text-sm">
                    <div className="flex justify-between"><span className="opacity-80">Base Pay:</span><span className="font-bold">${basePay}</span></div>
                    <div className="flex justify-between"><span className="opacity-80">Max Potential:</span><span className="font-bold text-yellow-300">${maxPotential.toLocaleString()}</span></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div className="grid lg:grid-cols-3 gap-6">
            <div className="lg:col-span-2 space-y-6">
              <div className="grid md:grid-cols-2 gap-4">
                <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-5">
                  <h2 className="text-lg font-bold text-[#232324] mb-3">üì§ Submit Tweet</h2>
                  {done ? <div className="bg-green-100 border-2 border-green-500 rounded-xl p-4 text-center"><p className="text-green-700 font-bold">‚úì Submitted!</p></div> : (
                    <form onSubmit={submit} className="space-y-3">
                      {submitError && <div className="bg-red-100 border-2 border-red-400 text-red-700 px-3 py-2 rounded-lg text-sm">{submitError}</div>}
                      <input type="url" value={url} onChange={e => { setUrl(e.target.value); setSubmitError(''); }} placeholder="https://x.com/..." required className={`w-full px-4 py-3 rounded-xl border-3 ${submitError ? 'border-red-400 bg-red-50' : 'border-[#232324] bg-[#FFF7E9]'} text-sm`} />
                      <button type="submit" disabled={submitting} className="w-full bg-[#2D7FF9] text-white py-3 rounded-xl font-bold border-3 border-[#232324] shadow-brutal-sm hover-brutal disabled:opacity-50 disabled:cursor-not-allowed">{submitting ? 'Submitting...' : 'Submit'}</button>
                    </form>
                  )}
                </div>
                <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-5">
                  <h2 className="text-lg font-bold text-[#232324] mb-3">üìã Your Submissions</h2>
                  {mySubs.length === 0 ? <p className="text-[#232324]/60 text-sm text-center py-4">No submissions yet</p> : (
                    <div className="space-y-2 max-h-40 overflow-y-auto">
                      {mySubs.map((s, i) => (
                        <div key={s.id} className="flex items-center justify-between p-2 bg-[#FFF7E9] rounded-lg">
                          <div className="flex items-center gap-2">
                            <span className="text-xs font-bold text-[#232324]/50">Post {mySubs.length - i}</span>
                            <a href={s.tweetUrl} target="_blank" className="text-sm text-[#2D7FF9] hover:underline">View ‚Üí</a>
                          </div>
                          <span className={`text-xs font-semibold px-2 py-0.5 rounded-full ${s.status === 'Verified' ? 'bg-green-100 text-green-700' : s.status === 'Rejected' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'}`}>{s.status}</span>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>

              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-6">
                <div className="flex items-center justify-between mb-4">
                  <h2 className="text-xl font-bold text-[#232324]">üìñ About This Campaign</h2>
                  <div className="flex gap-2">
                    {camp.links?.website && <a href={camp.links.website} target="_blank" className="w-9 h-9 rounded-lg border-2 border-[#232324] bg-[#FFF7E9] flex items-center justify-center hover:bg-[#2D7FF9] hover:text-white transition-all" title="Website">üåê</a>}
                    {camp.links?.twitter && <a href={camp.links.twitter} target="_blank" className="w-9 h-9 rounded-lg border-2 border-[#232324] bg-[#FFF7E9] flex items-center justify-center hover:bg-[#2D7FF9] hover:text-white transition-all" title="Twitter/X">ùïè</a>}
                    {camp.links?.docs && <a href={camp.links.docs} target="_blank" className="w-9 h-9 rounded-lg border-2 border-[#232324] bg-[#FFF7E9] flex items-center justify-center hover:bg-[#2D7FF9] hover:text-white transition-all" title="Documentation">üìÑ</a>}
                  </div>
                </div>
                <p className="text-[#232324]/80 mb-6">{camp.about}</p>
                <h3 className="font-bold text-[#232324] mb-3">Requirements</h3>
                <ul className="space-y-2">{camp.requirements.map((r, i) => <li key={i} className="flex items-start gap-2"><span className="w-5 h-5 bg-[#2D7FF9] rounded-full flex items-center justify-center text-white text-xs flex-shrink-0 mt-0.5">‚úì</span><span className="text-[#232324]/80">{r}</span></li>)}</ul>
              </div>

              <div className="bg-[#FFF7E9] rounded-xl border-4 border-[#232324] shadow-brutal p-6">
                <h2 className="text-xl font-bold text-[#232324] mb-4">üéØ How It Works</h2>
                <div className="grid grid-cols-4 gap-4">
                  {[['1', 'Create', 'Post content following requirements'], ['2', 'Submit', 'Paste tweet URL here'], ['3', 'Review', 'Scored 48h after posting'], ['4', 'Get Paid', 'Rewards based on ranking']].map(([n, t, d], i) => (
                    <div key={i} className="text-center">
                      <div className="w-10 h-10 bg-[#2D7FF9] text-white rounded-full flex items-center justify-center font-bold mx-auto mb-2">{n}</div>
                      <h4 className="font-bold text-[#232324]">{t}</h4>
                      <p className="text-xs text-[#232324]/60">{d}</p>
                    </div>
                  ))}
                </div>
                <div className="mt-4 bg-blue-50 border-2 border-blue-200 rounded-lg p-3">
                  <p className="text-xs text-blue-700"><strong>‚è≥ Review Process:</strong> Posts are reviewed 48 hours after submission to capture full reach. You'll be notified once your post is approved or if changes are needed.</p>
                </div>
              </div>

              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-6">
                <h2 className="text-xl font-bold text-[#232324] mb-4">‚ùì FAQ</h2>
                <FAQ items={faqItems} />
              </div>
            </div>

            <div className="space-y-4">
              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-5">
                <h2 className="text-lg font-bold text-[#232324] mb-4">üèÜ How Rewards Work</h2>
                
                <div className="mb-5">
                  <div className="flex items-center gap-2 mb-3">
                    <span className="text-lg">ü•á</span>
                    <h3 className="font-bold text-[#232324]">Leaderboard Rewards</h3>
                  </div>
                  <p className="text-xs text-[#232324]/60 mb-3">Top performers on the overall leaderboard win bonus rewards based on final ranking!</p>
                  <div className="space-y-1">
                    {camp.bonusPool.map((p, i) => (
                      <div key={i} className={`flex justify-between items-center p-2 rounded-lg ${i === 0 ? 'bg-yellow-100 border-2 border-yellow-300' : i === 1 ? 'bg-gray-100' : i === 2 ? 'bg-amber-50' : 'bg-[#FFF7E9]'}`}>
                        <span className="text-sm font-semibold text-[#232324]">{p.place}</span>
                        <span className="font-bold text-[#2D7FF9]">${p.amount}</span>
                      </div>
                    ))}
                  </div>
                </div>

                <div className="mb-5">
                  <div className="flex items-center gap-2 mb-3">
                    <span className="text-lg">‚≠ê</span>
                    <h3 className="font-bold text-[#232324]">Tier Bonus</h3>
                  </div>
                  <p className="text-xs text-[#232324]/60 mb-3">The #1 performer in your rank tier wins an extra bonus reward!</p>
                  <div className={`rounded-lg border-2 border-[#232324]/30 p-3 text-center ${ts(user.tier)}`}>
                    <p className="text-xs text-[#232324]/60 mb-1">Your Tier ({user.tier}) Bonus</p>
                    <p className="text-2xl font-bold text-[#232324]">${camp.tierChampions[user.tier] || 0}</p>
                  </div>
                </div>

                <div className="mb-4">
                  <div className="flex items-center gap-2 mb-3">
                    <span className="text-lg">üí∞</span>
                    <h3 className="font-bold text-[#232324]">Base Payout</h3>
                  </div>
                  <p className="text-xs text-[#232324]/60 mb-3">Submit {camp.minPosts || 3}+ qualifying posts to earn your guaranteed base payout.</p>
                  <div className={`rounded-lg border-3 border-[#232324] p-4 text-center ${ts(user.tier)}`}>
                    <p className="text-xs text-[#232324]/60 mb-1">Your Base Payout ({user.tier})</p>
                    <p className="text-3xl font-bold text-[#232324]">${basePay}</p>
                  </div>
                </div>

                <div className="bg-[#232324] rounded-lg p-4 text-white">
                  <p className="text-xs opacity-70 mb-2">Your Maximum Potential</p>
                  <p className="text-2xl font-bold text-yellow-400">${maxPotential.toLocaleString()}</p>
                  <p className="text-xs opacity-60 mt-1">Base + Tier Bonus + 1st Place</p>
                </div>
              </div>

              <div className="bg-[#232324] rounded-xl p-5 text-white">
                <h3 className="font-bold mb-2">üìê Scoring</h3>
                <p className="text-sm text-white/70 mb-3">Points are based on impressions, engagement, content quality, and other factors. Focus on genuine, valuable content!</p>
                <button onClick={() => setView('how-it-works')} className="text-[#2D7FF9] bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg text-sm font-semibold transition-all">Learn how scoring works ‚Üí</button>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // Profile
    const Profile = ({ user, setUser, subs, campaigns, setView, setCamp, onLogout, setCreators, creators, supabaseData }) => {
      const [wallet, setWallet] = useState(user.wallet || '');
      const [solanaWallet, setSolanaWallet] = useState(user.solanaWallet || '');
      const [editing, setEditing] = useState(false);
      const [saved, setSaved] = useState(false);
      const [walletError, setWalletError] = useState('');
      const [showRankInfo, setShowRankInfo] = useState(false);
      const [showChangePass, setShowChangePass] = useState(false);
      const [showSharecard, setShowSharecard] = useState(false);
      const [currentPass, setCurrentPass] = useState('');
      const [newPass, setNewPass] = useState('');
      const [passErr, setPassErr] = useState('');
      const [passSuccess, setPassSuccess] = useState(false);
      const [emailNotifications, setEmailNotifications] = useState(user.email_notifications !== false);
      const [showHelpModal, setShowHelpModal] = useState(false);
      const [showTicketForm, setShowTicketForm] = useState(false);
      const mySubs = subs.filter(s => s.creatorId === user.id);
      const activeCamps = campaigns.filter(c => user.campaigns?.includes(c.id) && c.status === 'Active');
      const pastCamps = campaigns.filter(c => user.campaigns?.includes(c.id) && c.status === 'Ended');
      
      // Wallet validation function
      const validateAndSaveWallets = () => {
        setWalletError('');
        
        // EVM validation - must be exactly 42 chars (0x + 40 hex)
        if (!wallet.trim()) {
          setWalletError('Please enter a valid EVM wallet address');
          return;
        }
        const evmTrimmed = wallet.trim();
        if (!evmTrimmed.startsWith('0x')) {
          setWalletError('EVM wallet must start with 0x');
          return;
        }
        if (evmTrimmed.length !== 42) {
          setWalletError(`EVM wallet must be exactly 42 characters (yours is ${evmTrimmed.length})`);
          return;
        }
        if (!/^[0-9a-fA-F]+$/.test(evmTrimmed.slice(2))) {
          setWalletError('EVM wallet contains invalid characters (must be 0-9, a-f)');
          return;
        }
        
        // Solana validation - 32-44 chars, Base58
        if (!solanaWallet.trim()) {
          setWalletError('Please enter a valid Solana wallet address');
          return;
        }
        const solanaTrimmed = solanaWallet.trim();
        if (solanaTrimmed.length < 32 || solanaTrimmed.length > 44) {
          setWalletError(`Solana wallet must be 32-44 characters (yours is ${solanaTrimmed.length})`);
          return;
        }
        if (!/^[1-9A-HJ-NP-Za-km-z]+$/.test(solanaTrimmed)) {
          setWalletError('Solana wallet contains invalid characters');
          return;
        }
        
        // All valid - save
        const updated = {...user, wallet: evmTrimmed, solanaWallet: solanaTrimmed}; 
        setUser(updated); 
        setCreators(creators.map(c => c.id === user.id ? {...c, wallet: evmTrimmed, solanaWallet: solanaTrimmed} : c)); 
        setEditing(false); 
        setSaved(true); 
        setTimeout(() => setSaved(false), 2000);
      };
      
      // Notification preferences
      const [showNotifSettings, setShowNotifSettings] = useState(false);
      const defaultPrefs = { new_campaign: true, submission_approved: true, submission_rejected: true, payment_sent: true, campaign_ending: true, campaign_ended: true };
      const [notifPrefs, setNotifPrefs] = useState(user.notification_preferences || defaultPrefs);
      
      const notifTypes = [
        { key: 'new_campaign', label: 'New Campaigns', desc: 'When a new campaign launches', icon: 'üéâ' },
        { key: 'submission_approved', label: 'Post Approved', desc: 'When your submission is verified', icon: '‚úÖ' },
        { key: 'submission_rejected', label: 'Post Rejected', desc: 'When your submission needs changes', icon: '‚ùå' },
        { key: 'payment_sent', label: 'Payments', desc: 'When you receive a payment', icon: 'üí∞' },
        { key: 'campaign_ending', label: 'Campaign Ending', desc: '24 hour reminders', icon: '‚è∞' },
        { key: 'campaign_ended', label: 'Campaign Ended', desc: 'When campaigns close', icon: 'üèÅ' },
      ];
      
      const toggleNotifPref = (key) => {
        setNotifPrefs(prev => ({ ...prev, [key]: !prev[key] }));
      };
      
      const saveNotifPrefs = async () => {
        if (supabaseData?.updateCreator) {
          try {
            await supabaseData.updateCreator(user.id, { notification_preferences: notifPrefs });
            const updated = {...user, notification_preferences: notifPrefs};
            setUser(updated);
            setCreators(creators.map(c => c.id === user.id ? updated : c));
            setShowNotifSettings(false);
          } catch (err) {
            console.error('Failed to save notification preferences:', err);
          }
        } else {
          setShowNotifSettings(false);
        }
      };
      
      const toggleEmailNotifications = async () => {
        const newValue = !emailNotifications;
        setEmailNotifications(newValue);
        
        // Update in database
        if (supabaseData?.updateCreator) {
          try {
            await supabaseData.updateCreator(user.id, { email_notifications: newValue });
            const updated = {...user, email_notifications: newValue};
            setUser(updated);
            setCreators(creators.map(c => c.id === user.id ? updated : c));
          } catch (err) {
            console.error('Failed to update email preferences:', err);
            setEmailNotifications(!newValue); // Revert on error
          }
        }
      };
      
      // Earnings history (simulated monthly data)
      const [earningsPeriod, setEarningsPeriod] = useState('6M');
      const allEarningsData = {
        '7D': [{ label: 'Mon', amount: Math.floor((user.totalEarned || 0) * 0.02) }, { label: 'Tue', amount: Math.floor((user.totalEarned || 0) * 0.03) }, { label: 'Wed', amount: Math.floor((user.totalEarned || 0) * 0.01) }, { label: 'Thu', amount: Math.floor((user.totalEarned || 0) * 0.04) }, { label: 'Fri', amount: Math.floor((user.totalEarned || 0) * 0.02) }, { label: 'Sat', amount: Math.floor((user.totalEarned || 0) * 0.03) }, { label: 'Sun', amount: Math.floor((user.totalEarned || 0) * 0.01) }],
        '30D': [{ label: 'W1', amount: Math.floor((user.totalEarned || 0) * 0.05) }, { label: 'W2', amount: Math.floor((user.totalEarned || 0) * 0.08) }, { label: 'W3', amount: Math.floor((user.totalEarned || 0) * 0.04) }, { label: 'W4', amount: Math.floor((user.totalEarned || 0) * 0.06) }],
        '90D': [{ label: 'Nov', amount: Math.floor((user.totalEarned || 0) * 0.25) }, { label: 'Dec', amount: Math.floor((user.totalEarned || 0) * 0.15) }, { label: 'Jan', amount: Math.floor((user.totalEarned || 0) * 0.15) }],
        '6M': [{ label: 'Aug', amount: Math.floor((user.totalEarned || 0) * 0.1) }, { label: 'Sep', amount: Math.floor((user.totalEarned || 0) * 0.15) }, { label: 'Oct', amount: Math.floor((user.totalEarned || 0) * 0.2) }, { label: 'Nov', amount: Math.floor((user.totalEarned || 0) * 0.25) }, { label: 'Dec', amount: Math.floor((user.totalEarned || 0) * 0.15) }, { label: 'Jan', amount: Math.floor((user.totalEarned || 0) * 0.15) }],
        '1Y': [{ label: 'Feb', amount: Math.floor((user.totalEarned || 0) * 0.05) }, { label: 'Apr', amount: Math.floor((user.totalEarned || 0) * 0.08) }, { label: 'Jun', amount: Math.floor((user.totalEarned || 0) * 0.12) }, { label: 'Aug', amount: Math.floor((user.totalEarned || 0) * 0.1) }, { label: 'Oct', amount: Math.floor((user.totalEarned || 0) * 0.2) }, { label: 'Dec', amount: Math.floor((user.totalEarned || 0) * 0.15) }, { label: 'Jan', amount: Math.floor((user.totalEarned || 0) * 0.15) }],
        'All': [{ label: '2024', amount: Math.floor((user.totalEarned || 0) * 0.35) }, { label: '2025', amount: Math.floor((user.totalEarned || 0) * 0.5) }, { label: '2026', amount: Math.floor((user.totalEarned || 0) * 0.15) }],
      };
      const earningsHistory = allEarningsData[earningsPeriod];
      const maxEarning = Math.max(...earningsHistory.map(e => e.amount), 1);

      const handleProfilePicUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (ev) => {
            const updated = {...user, profilePic: ev.target.result};
            setUser(updated);
            setCreators(creators.map(c => c.id === user.id ? updated : c));
          };
          reader.readAsDataURL(file);
        }
      };

      const changePassword = () => {
        if (currentPass !== user.password) { setPassErr('Current password is incorrect'); return; }
        if (newPass.length < 6) { setPassErr('New password must be at least 6 characters'); return; }
        const updated = {...user, password: newPass};
        setUser(updated);
        setCreators(creators.map(c => c.id === user.id ? updated : c));
        setPassSuccess(true);
        setPassErr('');
        setTimeout(() => { setShowChangePass(false); setPassSuccess(false); setCurrentPass(''); setNewPass(''); }, 1500);
      };

      return (
        <div className="space-y-4 sm:space-y-6">
          <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-4 sm:p-8">
            <div className="flex flex-col sm:flex-row gap-4 sm:gap-6 items-start">
              <div className="relative group">
                {user.profilePic ? (
                  <img src={user.profilePic} alt="" className="w-20 h-20 sm:w-24 sm:h-24 rounded-2xl border-4 border-[#232324] object-cover" />
                ) : (
                  <div className={`w-20 h-20 sm:w-24 sm:h-24 rounded-2xl bg-gradient-to-br ${tg(user.tier)} border-4 border-[#232324] flex items-center justify-center text-3xl sm:text-4xl`}>{user.avatar}</div>
                )}
                <label className="absolute inset-0 bg-black/50 rounded-2xl opacity-0 group-hover:opacity-100 flex items-center justify-center cursor-pointer transition-opacity">
                  <span className="text-white text-xs font-semibold">üì∑ Change</span>
                  <input type="file" accept="image/*" onChange={handleProfilePicUpload} className="hidden" />
                </label>
              </div>
              <div className="flex-1">
                <h1 className="text-2xl sm:text-3xl font-bold text-[#232324]">{user.name}</h1>
                <p className="text-lg sm:text-xl text-[#2D7FF9] font-semibold">@{user.handle}</p>
                <div className="flex flex-wrap items-center gap-2 sm:gap-3 mt-2 sm:mt-3">
                  <span className={`px-3 sm:px-4 py-1.5 sm:py-2 rounded-full font-bold text-sm border-3 ${ts(user.tier)} border-[#232324]`}>Rank: {user.tier}</span>
                  <button onClick={() => setShowRankInfo(true)} className="text-xs sm:text-sm text-[#2D7FF9] font-semibold hover:underline">How are ranks calculated?</button>
                </div>
              </div>
              <div className="text-left sm:text-right">
                <p className="text-sm text-[#232324]/60">Total Earned</p>
                <p className="text-3xl sm:text-4xl font-bold text-[#2D7FF9]">${(user.totalEarned || 0).toLocaleString()}</p>
              </div>
            </div>
          </div>

          {showRankInfo && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setShowRankInfo(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-md w-full" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold text-[#232324] mb-4">How Ranks Are Calculated</h3>
                <p className="text-[#232324]/70 mb-4">Each member of the Creatorverse is manually reviewed by our team and assigned a rank.</p>
                <p className="font-semibold text-[#232324] mb-2">Creators are ranked based on:</p>
                <ul className="space-y-2 mb-4">
                  {['Followers', 'Smart followers', 'Engagement rate', 'Content consistency', 'Quality of content', 'Overall influence on CT'].map((item, i) => (
                    <li key={i} className="flex items-center gap-2 text-[#232324]/80"><span className="w-2 h-2 bg-[#2D7FF9] rounded-full"></span>{item}</li>
                  ))}
                </ul>
                <p className="text-sm text-[#232324]/60 mb-4">This rank determines your payout amounts and priority for exclusive campaigns.</p>
                <button onClick={() => setShowRankInfo(false)} className="w-full bg-[#2D7FF9] text-white py-3 rounded-xl font-bold border-3 border-[#232324]">Got it</button>
              </div>
            </div>
          )}

          <div className="grid lg:grid-cols-3 gap-4 sm:gap-6">
            <div className="lg:col-span-2 space-y-4 sm:space-y-6">
              {/* Earnings Chart */}
              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6">
                <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-4">
                  <h2 className="text-lg sm:text-xl font-bold text-[#232324]">üìà Earnings Over Time</h2>
                  <div className="flex gap-1">
                    {['7D', '30D', '90D', '6M', '1Y', 'All'].map(p => (
                      <button key={p} onClick={() => setEarningsPeriod(p)} className={`px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-semibold border-2 border-[#232324] ${earningsPeriod === p ? 'bg-[#2D7FF9] text-white' : 'bg-white hover:bg-[#FFF7E9]'}`}>{p}</button>
                    ))}
                  </div>
                </div>
                <div className="flex items-end gap-2 sm:gap-3 h-32 sm:h-40">
                  {earningsHistory.map((e, i) => (
                    <div key={i} className="flex-1 flex flex-col items-center gap-1">
                      <div className="w-full bg-[#2D7FF9]/20 rounded-t-lg relative" style={{ height: `${(e.amount / maxEarning) * 100}%`, minHeight: '8px' }}>
                        <div className="absolute -top-6 left-1/2 -translate-x-1/2 text-[10px] sm:text-xs font-bold text-[#2D7FF9] whitespace-nowrap">${e.amount}</div>
                        <div className="absolute inset-0 bg-[#2D7FF9] rounded-t-lg" style={{ height: '100%' }}></div>
                      </div>
                      <span className="text-[10px] sm:text-xs text-[#232324]/60 font-semibold">{e.label}</span>
                    </div>
                  ))}
                </div>
              </div>

              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6">
                <h2 className="text-lg sm:text-xl font-bold text-[#232324] mb-2">üí∞ Payout Wallets</h2>
                <p className="text-[#232324]/60 text-sm mb-4">These are where your Arena earnings will be sent</p>
                {editing ? (
                  <div className="space-y-4">
                    {walletError && <div className="bg-red-100 border-2 border-red-400 text-red-700 px-4 py-2 rounded-lg text-sm">{walletError}</div>}
                    <div>
                      <label className="block text-sm font-bold text-[#232324] mb-1">EVM Wallet (USDC on Arbitrum)</label>
                      <input type="text" value={wallet} onChange={e => { setWallet(e.target.value); setWalletError(''); }} placeholder="0x..." className="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] font-mono text-sm" />
                      <p className="text-xs text-[#232324]/50 mt-1">Must be 42 characters starting with 0x</p>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-[#232324] mb-1">Solana Wallet</label>
                      <input type="text" value={solanaWallet} onChange={e => { setSolanaWallet(e.target.value); setWalletError(''); }} placeholder="Your Solana address..." className="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] font-mono text-sm" />
                      <p className="text-xs text-[#232324]/50 mt-1">Must be 32-44 characters</p>
                    </div>
                    <div className="flex gap-2">
                      <button onClick={validateAndSaveWallets} className="flex-1 bg-green-500 text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-xl font-bold border-3 border-[#232324]">Save Wallets</button>
                      <button onClick={() => { setWallet(user.wallet || ''); setSolanaWallet(user.solanaWallet || ''); setEditing(false); setWalletError(''); }} className="px-4 py-2.5 sm:py-3 rounded-xl font-bold border-3 border-[#232324]">Cancel</button>
                    </div>
                  </div>
                ) : (
                  <div className="space-y-3">
                    <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
                      <span className="text-xs font-semibold text-[#232324]/60 sm:w-20">EVM:</span>
                      <div className="flex-1 px-3 py-2 rounded-lg border-2 border-[#232324]/20 bg-[#FFF7E9] font-mono text-[#232324]/70 text-sm truncate">{user.wallet || 'Not set'}</div>
                    </div>
                    <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
                      <span className="text-xs font-semibold text-[#232324]/60 sm:w-20">Solana:</span>
                      <div className="flex-1 px-3 py-2 rounded-lg border-2 border-[#232324]/20 bg-[#FFF7E9] font-mono text-[#232324]/70 text-sm truncate">{user.solanaWallet || 'Not set'}</div>
                    </div>
                    <button onClick={() => setEditing(true)} className="w-full sm:w-auto bg-[#2D7FF9] text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-xl font-bold border-3 border-[#232324] shadow-brutal-sm hover-brutal">Update Wallets</button>
                  </div>
                )}
                {saved && <p className="text-green-600 font-semibold mt-2 text-sm">‚úì Wallets saved!</p>}
              </div>

              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6">
                <h2 className="text-lg sm:text-xl font-bold text-[#232324] mb-4">üîê Account Security</h2>
                <button onClick={() => setShowChangePass(true)} className="bg-[#FFF7E9] text-[#232324] px-4 py-2.5 rounded-xl font-semibold border-3 border-[#232324] hover:bg-[#2D7FF9] hover:text-white transition-all">Change Password</button>
              </div>

              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6">
                <h2 className="text-lg sm:text-xl font-bold text-[#232324] mb-4">üèÜ Active Campaigns</h2>
                {activeCamps.length === 0 ? <p className="text-[#232324]/60">No active campaigns</p> : (
                  <div className="space-y-3">
                    {activeCamps.map(c => (
                      <div key={c.id} onClick={() => { setCamp(c); setView('campaign'); }} className="flex items-center gap-3 sm:gap-4 p-3 bg-[#FFF7E9] rounded-xl border-2 border-[#232324]/20 cursor-pointer hover:border-[#2D7FF9] hover:bg-blue-50 transition-all">
                        <img src={c.brandLogo} alt="" className="w-8 h-8 sm:w-10 sm:h-10 rounded-lg border-2 border-[#232324] bg-white object-contain p-1" onError={e => e.target.style.display='none'} />
                        <div className="flex-1 min-w-0"><h4 className="font-bold text-[#232324] text-sm sm:text-base truncate">{c.name}</h4><p className="text-xs sm:text-sm text-[#232324]/60">{mySubs.filter(s => s.campaignId === c.id).length} submissions</p></div>
                        <span className="text-xs sm:text-sm font-semibold text-red-500 whitespace-nowrap">{daysLeft(c.endDate)}d left</span>
                        <span className="text-[#2D7FF9]">‚Üí</span>
                      </div>
                    ))}
                  </div>
                )}
              </div>

              {pastCamps.length > 0 && (
                <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6">
                  <h2 className="text-lg sm:text-xl font-bold text-[#232324] mb-4">üìú Past Campaigns</h2>
                  <div className="space-y-3">
                    {pastCamps.map(c => (
                      <div key={c.id} onClick={() => { setCamp(c); setView('campaign'); }} className="flex items-center gap-3 sm:gap-4 p-3 bg-gray-50 rounded-xl border-2 border-[#232324]/10 cursor-pointer hover:border-[#2D7FF9] transition-all opacity-70">
                        <img src={c.brandLogo} alt="" className="w-8 h-8 sm:w-10 sm:h-10 rounded-lg border-2 border-[#232324]/30 bg-white object-contain p-1 grayscale" onError={e => e.target.style.display='none'} />
                        <div className="flex-1 min-w-0"><h4 className="font-bold text-[#232324]/70 text-sm sm:text-base truncate">{c.name}</h4></div>
                        <span className="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full">Ended</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Email Notifications Settings */}
              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <h4 className="font-bold text-[#232324]">üìß Email Notifications</h4>
                    <p className="text-xs text-[#232324]/60 mt-1">Manage your email preferences</p>
                  </div>
                  <button 
                    onClick={() => setShowNotifSettings(true)}
                    className="bg-[#2D7FF9] text-white px-4 py-2 rounded-lg font-semibold text-sm border-2 border-[#232324]"
                  >
                    Edit
                  </button>
                </div>
              </div>

              {/* Need Help Button */}
              <button 
                onClick={() => setShowHelpModal(true)} 
                className="w-full bg-gradient-to-r from-[#2D7FF9] to-[#1a5fd4] text-white py-3 rounded-xl font-bold border-3 border-[#232324] shadow-brutal hover:opacity-90 transition-opacity flex items-center justify-center gap-2"
              >
                üÜò Need Help?
              </button>

              <button onClick={onLogout} className="w-full bg-red-500 text-white py-3 rounded-xl font-bold border-3 border-[#232324] shadow-brutal hover:bg-red-600 transition-colors">üö™ Log Out</button>
            </div>

            <div className="space-y-4">
              <div className={`rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6 bg-gradient-to-br ${tg(user.tier)}`}>
                <p className="text-white/80 text-sm uppercase font-semibold">Your Rank</p>
                <p className="text-3xl sm:text-4xl font-bold text-white mt-1">{user.tier}</p>
                <p className="text-white/70 text-sm mt-2">Creator</p>
              </div>
              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-5">
                <h3 className="font-bold text-[#232324] mb-3 sm:mb-4">Quick Stats</h3>
                <div className="space-y-2 sm:space-y-3">
                  {[['Total Submissions', mySubs.length], ['Verified Posts', mySubs.filter(s => s.status === 'Verified').length], ['Active Campaigns', activeCamps.length], ['Email', user.email]].map(([l, v], i) => (
                    <div key={i} className="flex justify-between items-center"><span className="text-xs sm:text-sm text-[#232324]/60">{l}</span><span className="font-semibold text-[#232324] text-sm">{v}</span></div>
                  ))}
                </div>
              </div>
              
              {/* Sharecard Generator */}
              <div className="bg-gradient-to-br from-[#2D7FF9] to-[#1a5fd4] rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-5">
                <h3 className="font-bold text-white mb-2">üì∏ Share Your Stats</h3>
                <p className="text-white/70 text-xs mb-3">Generate a scorecard to flex your rank!</p>
                <button onClick={() => setShowSharecard(true)} className="w-full bg-[#FFF7E9] text-[#232324] py-2.5 rounded-lg font-bold border-3 border-[#232324] shadow-brutal-sm hover-brutal">Generate Sharecard</button>
              </div>
            </div>
          </div>

          {showChangePass && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setShowChangePass(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-sm w-full" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold text-[#232324] mb-4">{passSuccess ? '‚úÖ Password Changed!' : 'Change Password'}</h3>
                {passSuccess ? <p className="text-[#232324]/70">Your password has been updated.</p> : (
                  <div className="space-y-4">
                    {passErr && <p className="text-red-500 text-sm">{passErr}</p>}
                    <div><label className="block text-sm font-bold mb-1">Current Password</label><input type="password" value={currentPass} onChange={e => setCurrentPass(e.target.value)} className="w-full px-4 py-2.5 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                    <div><label className="block text-sm font-bold mb-1">New Password</label><input type="password" value={newPass} onChange={e => setNewPass(e.target.value)} className="w-full px-4 py-2.5 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                    <div className="flex gap-3"><button onClick={() => setShowChangePass(false)} className="flex-1 py-2.5 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button><button onClick={changePassword} className="flex-1 py-2.5 rounded-lg font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324]">Update</button></div>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Notification Settings Modal */}
          {showNotifSettings && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setShowNotifSettings(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-md w-full" onClick={e => e.stopPropagation()}>
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-xl font-bold text-[#232324]">üìß Email Preferences</h3>
                  <button onClick={() => setShowNotifSettings(false)} className="text-2xl text-[#232324]/60 hover:text-[#232324]">√ó</button>
                </div>
                
                <p className="text-sm text-[#232324]/60 mb-4">Choose which notifications you want to receive via email.</p>
                
                {/* Toggle All */}
                <div className="flex items-center justify-between p-3 rounded-lg bg-[#FFF7E9] border-2 border-[#232324] mb-4">
                  <div className="flex items-center gap-3">
                    <span className="text-xl">üì¨</span>
                    <div>
                      <p className="font-bold text-[#232324] text-sm">All Notifications</p>
                      <p className="text-xs text-[#232324]/50">Toggle all on or off</p>
                    </div>
                  </div>
                  <button 
                    onClick={() => {
                      const allOn = Object.values(notifPrefs).every(v => v);
                      const newPrefs = {};
                      notifTypes.forEach(t => { newPrefs[t.key] = !allOn; });
                      setNotifPrefs(newPrefs);
                    }}
                    className={`relative w-11 h-6 rounded-full border-2 border-[#232324] transition-colors ${Object.values(notifPrefs).every(v => v) ? 'bg-[#18B369]' : Object.values(notifPrefs).some(v => v) ? 'bg-yellow-400' : 'bg-gray-300'}`}
                  >
                    <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full border border-[#232324] transition-transform ${Object.values(notifPrefs).every(v => v) ? 'translate-x-5' : Object.values(notifPrefs).some(v => v) ? 'translate-x-2.5' : 'translate-x-0.5'}`} />
                  </button>
                </div>
                
                <div className="space-y-3 mb-6 max-h-64 overflow-y-auto">
                  {notifTypes.map(({ key, label, desc, icon }) => (
                    <label key={key} className="flex items-center justify-between p-3 rounded-lg border-2 border-[#232324]/20 hover:border-[#2D7FF9]/50 cursor-pointer transition-colors">
                      <div className="flex items-center gap-3">
                        <span className="text-xl">{icon}</span>
                        <div>
                          <p className="font-semibold text-[#232324] text-sm">{label}</p>
                          <p className="text-xs text-[#232324]/50">{desc}</p>
                        </div>
                      </div>
                      <button 
                        onClick={() => toggleNotifPref(key)}
                        className={`relative w-11 h-6 rounded-full border-2 border-[#232324] transition-colors ${notifPrefs[key] ? 'bg-[#18B369]' : 'bg-gray-300'}`}
                      >
                        <div className={`absolute top-0.5 w-4 h-4 bg-white rounded-full border border-[#232324] transition-transform ${notifPrefs[key] ? 'translate-x-5' : 'translate-x-0.5'}`} />
                      </button>
                    </label>
                  ))}
                </div>
                
                <div className="flex gap-3">
                  <button onClick={() => setShowNotifSettings(false)} className="flex-1 py-2.5 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button>
                  <button onClick={saveNotifPrefs} className="flex-1 py-2.5 rounded-lg font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324]">Save Preferences</button>
                </div>
              </div>
            </div>
          )}

          {/* Help Modal - Options */}
          {showHelpModal && !showTicketForm && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setShowHelpModal(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-sm w-full" onClick={e => e.stopPropagation()}>
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-xl font-bold text-[#232324]">üÜò Need Help?</h3>
                  <button onClick={() => setShowHelpModal(false)} className="text-2xl text-[#232324]/60 hover:text-[#232324]">√ó</button>
                </div>
                
                <p className="text-sm text-[#232324]/60 mb-5">Choose how you'd like to get support:</p>
                
                <div className="space-y-3">
                  <button 
                    onClick={() => setShowTicketForm(true)}
                    className="w-full flex items-center gap-4 p-4 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] hover:bg-[#2D7FF9] hover:text-white transition-all group"
                  >
                    <span className="text-3xl">üìù</span>
                    <div className="text-left">
                      <p className="font-bold">Submit a Ticket</p>
                      <p className="text-xs opacity-70 group-hover:opacity-90">Fill out a form with your issue</p>
                    </div>
                  </button>
                  
                  <a 
                    href="https://t.me/+LcXeyE0QeLVlMDM5"
                    target="_blank"
                    rel="noopener noreferrer"
                    className="w-full flex items-center gap-4 p-4 rounded-xl border-3 border-[#232324] bg-[#FFF7E9] hover:bg-[#0088cc] hover:text-white transition-all group"
                  >
                    <span className="text-3xl">üí¨</span>
                    <div className="text-left">
                      <p className="font-bold">Join Telegram Group</p>
                      <p className="text-xs opacity-70 group-hover:opacity-90">Join our community support channel</p>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          )}

          {/* Help Modal - Tally Form */}
          {showTicketForm && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => { setShowTicketForm(false); setShowHelpModal(false); }}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal w-full max-w-lg max-h-[90vh] overflow-hidden" onClick={e => e.stopPropagation()}>
                <div className="flex justify-between items-center p-4 border-b-3 border-[#232324]">
                  <div className="flex items-center gap-2">
                    <button onClick={() => setShowTicketForm(false)} className="text-[#232324]/60 hover:text-[#232324] text-lg">‚Üê</button>
                    <h3 className="text-lg font-bold text-[#232324]">üìù Submit a Ticket</h3>
                  </div>
                  <button onClick={() => { setShowTicketForm(false); setShowHelpModal(false); }} className="text-2xl text-[#232324]/60 hover:text-[#232324]">√ó</button>
                </div>
                <div className="h-[70vh]">
                  <iframe 
                    src="https://tally.so/r/vGMJZl?transparentBackground=1"
                    width="100%" 
                    height="100%" 
                    frameBorder="0" 
                    title="Support Ticket Form"
                    style={{ background: 'transparent' }}
                  />
                </div>
              </div>
            </div>
          )}

          {showSharecard && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-auto" onClick={() => setShowSharecard(false)}>
              <div className="bg-[#FFF7E9] rounded-2xl border-4 border-[#232324] shadow-brutal p-5 w-full max-w-xl my-auto" onClick={e => e.stopPropagation()}>
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-xl font-bold text-[#232324]">üì∏ Your Sharecard</h3>
                  <button onClick={() => setShowSharecard(false)} className="text-2xl text-[#232324]/60 hover:text-[#232324]">√ó</button>
                </div>
                
                {/* Sharecard Preview */}
                <div id="sharecard-preview" style={{
                  backgroundColor: '#2D7FF9',
                  border: '4px solid #232324',
                  borderRadius: '16px',
                  padding: '20px',
                  marginBottom: '16px',
                  fontFamily: 'Space Grotesk, sans-serif'
                }}>
                  {/* Header */}
                  <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '16px'}}>
                    <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                      <img src={SCAL3_LOGO} alt="SCAL3" style={{width: '40px', height: '40px', borderRadius: '8px'}} />
                      <div>
                        <div style={{color: 'white', fontWeight: 'bold', fontSize: '18px'}}>SCAL3</div>
                        <div style={{color: '#b3d4fc', fontSize: '9px', fontWeight: '600', letterSpacing: '1px'}}>CREATORVERSE</div>
                      </div>
                    </div>
                    <div style={{display: 'flex', alignItems: 'flex-start'}}>
                      <div style={{textAlign: 'right', marginRight: '8px'}}>
                        <div style={{color: 'white', fontWeight: 'bold', fontSize: '14px'}}>{user.name}</div>
                        <div style={{color: '#FFF7E9', fontSize: '12px'}}>@{user.handle}</div>
                      </div>
                      {user.profilePic ? (
                        <img src={user.profilePic} alt="" style={{
                          width: '44px',
                          height: '44px',
                          borderRadius: '10px',
                          border: '3px solid #232324',
                          objectFit: 'cover'
                        }} />
                      ) : (
                        <div style={{
                          width: '44px',
                          height: '44px',
                          borderRadius: '10px', 
                          border: '3px solid #232324',
                          backgroundColor: user.tier === 'Gold' ? '#facc15' : user.tier === 'Diamond' ? '#22d3ee' : user.tier === 'Platinum' ? '#94a3b8' : '#9ca3af',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center',
                          fontSize: '20px'
                        }}>{user.avatar}</div>
                      )}
                    </div>
                  </div>
                  
                  {/* Earnings Card */}
                  <div style={{
                    backgroundColor: 'white',
                    borderRadius: '12px',
                    border: '3px solid #232324',
                    padding: '20px',
                    textAlign: 'center',
                    marginBottom: '16px'
                  }}>
                    <div style={{color: '#2D7FF9', fontSize: '10px', fontWeight: '700', textTransform: 'uppercase', letterSpacing: '2px', marginBottom: '8px'}}>üí∞ MY TOTAL EARNINGS</div>
                    <div style={{color: '#2D7FF9', fontWeight: 'bold', fontSize: '48px'}}>${(user.totalEarned || 0).toLocaleString()}</div>
                    <div style={{color: '#666666', fontSize: '12px', marginTop: '8px'}}>earned in the Creatorverse Arena</div>
                  </div>
                  
                  {/* Footer */}
                  <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start'}}>
                    <div style={{backgroundColor: 'white', padding: '10px 14px', borderRadius: '10px', border: '3px solid #232324'}}>
                      <div style={{color: '#2D7FF9', fontSize: '8px', fontWeight: '700', textTransform: 'uppercase', letterSpacing: '1px'}}>üèÜ MY RANK</div>
                      <div style={{color: user.tier === 'Gold' ? '#eab308' : user.tier === 'Diamond' ? '#06b6d4' : user.tier === 'Platinum' ? '#64748b' : '#9ca3af', fontWeight: 'bold', fontSize: '18px'}}>{user.tier}</div>
                    </div>
                    
                    <div style={{display: 'flex'}}>
                      <div style={{backgroundColor: '#5a9bfc', padding: '8px 14px', borderRadius: '8px', textAlign: 'center', marginRight: '8px'}}>
                        <div style={{color: '#d4e5fc', fontSize: '8px', fontWeight: '600', textTransform: 'uppercase'}}>POSTS</div>
                        <div style={{color: 'white', fontWeight: 'bold', fontSize: '20px'}}>{mySubs.length}</div>
                      </div>
                      <div style={{backgroundColor: '#5a9bfc', padding: '8px 14px', borderRadius: '8px', textAlign: 'center'}}>
                        <div style={{color: '#d4e5fc', fontSize: '8px', fontWeight: '600', textTransform: 'uppercase'}}>CAMPAIGNS</div>
                        <div style={{color: 'white', fontWeight: 'bold', fontSize: '20px'}}>{activeCamps.length + pastCamps.length}</div>
                      </div>
                    </div>
                    
                    <div style={{backgroundColor: '#FFF7E9', padding: '10px 14px', borderRadius: '10px', border: '3px solid #232324'}}>
                      <div style={{color: '#232324', fontSize: '8px', fontWeight: '700', textTransform: 'uppercase'}}>JOIN US AT</div>
                      <div style={{color: '#2D7FF9', fontWeight: 'bold', fontSize: '13px'}}>scal3.xyz</div>
                    </div>
                  </div>
                </div>
                
                {/* Actions */}
                <div className="flex gap-3">
                  <button onClick={() => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const W = 600, H = 380;
                    canvas.width = W * 2;
                    canvas.height = H * 2;
                    ctx.scale(2, 2);
                    
                    const roundRect = (x, y, w, h, r) => {
                      ctx.beginPath();
                      ctx.moveTo(x + r, y);
                      ctx.lineTo(x + w - r, y);
                      ctx.quadraticCurveTo(x + w, y, x + w, y + r);
                      ctx.lineTo(x + w, y + h - r);
                      ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                      ctx.lineTo(x + r, y + h);
                      ctx.quadraticCurveTo(x, y + h, x, y + h - r);
                      ctx.lineTo(x, y + r);
                      ctx.quadraticCurveTo(x, y, x + r, y);
                      ctx.closePath();
                    };
                    
                    // Load logo first, then draw everything
                    const logoImg = new Image();
                    logoImg.onload = () => {
                    
                    // Main background
                    ctx.fillStyle = '#2D7FF9';
                    roundRect(0, 0, W, H, 16);
                    ctx.fill();
                    
                    // Border
                    ctx.strokeStyle = '#232324';
                    ctx.lineWidth = 4;
                    roundRect(2, 2, W-4, H-4, 14);
                    ctx.stroke();
                    
                    // Draw logo image
                    ctx.drawImage(logoImg, 20, 15, 40, 40);
                    
                    // SCAL3 text next to logo
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 20px Space Grotesk, sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText('SCAL3', 68, 38);
                    ctx.fillStyle = '#b3d4fc';
                    ctx.font = '600 9px Space Grotesk, sans-serif';
                    ctx.fillText('CREATORVERSE', 68, 52);
                    
                    // User info
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 16px Space Grotesk, sans-serif';
                    ctx.textAlign = 'right';
                    ctx.fillText(user.name, 520, 35);
                    ctx.fillStyle = '#FFF7E9';
                    ctx.font = '14px Space Grotesk, sans-serif';
                    ctx.fillText('@' + user.handle, 520, 52);
                    
                    // Avatar
                    const avatarColor = user.tier === 'Gold' ? '#facc15' : user.tier === 'Diamond' ? '#22d3ee' : user.tier === 'Platinum' ? '#94a3b8' : '#9ca3af';
                    ctx.fillStyle = avatarColor;
                    roundRect(532, 18, 48, 48, 10);
                    ctx.fill();
                    ctx.strokeStyle = '#232324';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    ctx.font = '24px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillStyle = '#000';
                    ctx.fillText(user.avatar, 556, 50);
                    
                    // Earnings card
                    ctx.fillStyle = 'white';
                    roundRect(20, 75, W-40, 170, 12);
                    ctx.fill();
                    ctx.strokeStyle = '#232324';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    
                    ctx.fillStyle = '#2D7FF9';
                    ctx.font = 'bold 12px Space Grotesk, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('üí∞ MY TOTAL EARNINGS', W/2, 115);
                    ctx.font = 'bold 52px Space Grotesk, sans-serif';
                    ctx.fillText('$' + (user.totalEarned || 0).toLocaleString(), W/2, 180);
                    ctx.fillStyle = '#666666';
                    ctx.font = '14px Space Grotesk, sans-serif';
                    ctx.fillText('earned in the Creatorverse Arena', W/2, 215);
                    
                    // Rank box
                    ctx.fillStyle = 'white';
                    roundRect(20, 265, 110, 60, 10);
                    ctx.fill();
                    ctx.strokeStyle = '#232324';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    ctx.fillStyle = '#2D7FF9';
                    ctx.font = 'bold 10px Space Grotesk, sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText('üèÜ MY RANK', 32, 288);
                    const rankColor = user.tier === 'Gold' ? '#eab308' : user.tier === 'Diamond' ? '#06b6d4' : user.tier === 'Platinum' ? '#64748b' : '#9ca3af';
                    ctx.fillStyle = rankColor;
                    ctx.font = 'bold 22px Space Grotesk, sans-serif';
                    ctx.fillText(user.tier, 32, 315);
                    
                    // Posts
                    ctx.fillStyle = '#5a9bfc';
                    roundRect(200, 265, 80, 60, 8);
                    ctx.fill();
                    ctx.fillStyle = '#d4e5fc';
                    ctx.font = 'bold 10px Space Grotesk, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('POSTS', 240, 288);
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 24px Space Grotesk, sans-serif';
                    ctx.fillText(String(mySubs.length), 240, 315);
                    
                    // Campaigns
                    ctx.fillStyle = '#5a9bfc';
                    roundRect(295, 265, 105, 60, 8);
                    ctx.fill();
                    ctx.fillStyle = '#d4e5fc';
                    ctx.font = 'bold 10px Space Grotesk, sans-serif';
                    ctx.fillText('CAMPAIGNS', 347, 288);
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 24px Space Grotesk, sans-serif';
                    ctx.fillText(String(activeCamps.length + pastCamps.length), 347, 315);
                    
                    // Join box
                    ctx.fillStyle = '#FFF7E9';
                    roundRect(470, 265, 110, 60, 10);
                    ctx.fill();
                    ctx.strokeStyle = '#232324';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    ctx.fillStyle = '#232324';
                    ctx.font = 'bold 10px Space Grotesk, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('JOIN US AT', 525, 288);
                    ctx.fillStyle = '#2D7FF9';
                    ctx.font = 'bold 16px Space Grotesk, sans-serif';
                    ctx.fillText('scal3.xyz', 525, 315);
                    
                    const link = document.createElement('a');
                    link.download = 'scal3-' + user.handle + '-sharecard.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    };
                    logoImg.src = SCAL3_LOGO;
                  }} className="flex-1 bg-[#2D7FF9] text-white py-3 rounded-xl font-bold border-3 border-[#232324] shadow-brutal-sm hover-brutal">
                    üì• Download
                  </button>
                  <button onClick={() => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const W = 600, H = 380;
                    canvas.width = W * 2;
                    canvas.height = H * 2;
                    ctx.scale(2, 2);
                    
                    const roundRect = (x, y, w, h, r) => {
                      ctx.beginPath();
                      ctx.moveTo(x + r, y);
                      ctx.lineTo(x + w - r, y);
                      ctx.quadraticCurveTo(x + w, y, x + w, y + r);
                      ctx.lineTo(x + w, y + h - r);
                      ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                      ctx.lineTo(x + r, y + h);
                      ctx.quadraticCurveTo(x, y + h, x, y + h - r);
                      ctx.lineTo(x, y + r);
                      ctx.quadraticCurveTo(x, y, x + r, y);
                      ctx.closePath();
                    };
                    
                    // Load logo first
                    const logoImg = new Image();
                    logoImg.onload = () => {
                    
                    ctx.fillStyle = '#2D7FF9';
                    roundRect(0, 0, W, H, 16);
                    ctx.fill();
                    ctx.strokeStyle = '#232324';
                    ctx.lineWidth = 4;
                    roundRect(2, 2, W-4, H-4, 14);
                    ctx.stroke();
                    
                    // Draw logo
                    ctx.drawImage(logoImg, 20, 15, 40, 40);
                    
                    // SCAL3 text next to logo
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 20px Space Grotesk, sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText('SCAL3', 68, 38);
                    ctx.fillStyle = '#b3d4fc';
                    ctx.font = '600 9px Space Grotesk, sans-serif';
                    ctx.fillText('CREATORVERSE', 68, 52);
                    
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 16px Space Grotesk, sans-serif';
                    ctx.textAlign = 'right';
                    ctx.fillText(user.name, 520, 35);
                    ctx.fillStyle = '#FFF7E9';
                    ctx.font = '14px Space Grotesk, sans-serif';
                    ctx.fillText('@' + user.handle, 520, 52);
                    
                    const avatarColor = user.tier === 'Gold' ? '#facc15' : user.tier === 'Diamond' ? '#22d3ee' : user.tier === 'Platinum' ? '#94a3b8' : '#9ca3af';
                    ctx.fillStyle = avatarColor;
                    roundRect(532, 18, 48, 48, 10);
                    ctx.fill();
                    ctx.strokeStyle = '#232324';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    ctx.font = '24px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillStyle = '#000';
                    ctx.fillText(user.avatar, 556, 50);
                    
                    ctx.fillStyle = 'white';
                    roundRect(20, 75, W-40, 170, 12);
                    ctx.fill();
                    ctx.strokeStyle = '#232324';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    
                    ctx.fillStyle = '#2D7FF9';
                    ctx.font = 'bold 12px Space Grotesk, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('üí∞ MY TOTAL EARNINGS', W/2, 115);
                    ctx.font = 'bold 52px Space Grotesk, sans-serif';
                    ctx.fillText('$' + (user.totalEarned || 0).toLocaleString(), W/2, 180);
                    ctx.fillStyle = '#666666';
                    ctx.font = '14px Space Grotesk, sans-serif';
                    ctx.fillText('earned in the Creatorverse Arena', W/2, 215);
                    
                    ctx.fillStyle = 'white';
                    roundRect(20, 265, 110, 60, 10);
                    ctx.fill();
                    ctx.strokeStyle = '#232324';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    ctx.fillStyle = '#2D7FF9';
                    ctx.font = 'bold 10px Space Grotesk, sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText('üèÜ MY RANK', 32, 288);
                    const rankColor = user.tier === 'Gold' ? '#eab308' : user.tier === 'Diamond' ? '#06b6d4' : user.tier === 'Platinum' ? '#64748b' : '#9ca3af';
                    ctx.fillStyle = rankColor;
                    ctx.font = 'bold 22px Space Grotesk, sans-serif';
                    ctx.fillText(user.tier, 32, 315);
                    
                    ctx.fillStyle = '#5a9bfc';
                    roundRect(200, 265, 80, 60, 8);
                    ctx.fill();
                    ctx.fillStyle = '#d4e5fc';
                    ctx.font = 'bold 10px Space Grotesk, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('POSTS', 240, 288);
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 24px Space Grotesk, sans-serif';
                    ctx.fillText(String(mySubs.length), 240, 315);
                    
                    ctx.fillStyle = '#5a9bfc';
                    roundRect(295, 265, 105, 60, 8);
                    ctx.fill();
                    ctx.fillStyle = '#d4e5fc';
                    ctx.font = 'bold 10px Space Grotesk, sans-serif';
                    ctx.fillText('CAMPAIGNS', 347, 288);
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 24px Space Grotesk, sans-serif';
                    ctx.fillText(String(activeCamps.length + pastCamps.length), 347, 315);
                    
                    ctx.fillStyle = '#FFF7E9';
                    roundRect(470, 265, 110, 60, 10);
                    ctx.fill();
                    ctx.strokeStyle = '#232324';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    ctx.fillStyle = '#232324';
                    ctx.font = 'bold 10px Space Grotesk, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('JOIN US AT', 525, 288);
                    ctx.fillStyle = '#2D7FF9';
                    ctx.font = 'bold 16px Space Grotesk, sans-serif';
                    ctx.fillText('scal3.xyz', 525, 315);
                    
                    canvas.toBlob(blob => {
                      navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]).then(() => {
                        alert('‚úÖ Copied to clipboard!');
                      }).catch(() => {
                        const link = document.createElement('a');
                        link.download = 'scal3-' + user.handle + '-sharecard.png';
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                      });
                    });
                    };
                    logoImg.src = SCAL3_LOGO;
                  }} className="flex-1 bg-white text-[#232324] py-3 rounded-xl font-bold border-3 border-[#232324] shadow-brutal-sm hover-brutal">
                    üìã Copy
                  </button>
                </div>
                <p className="text-center text-[#232324]/50 text-xs mt-3">Share on Twitter to flex your Creatorverse stats! üöÄ</p>
              </div>
            </div>
          )}
        </div>
      );
    };

    // Admin Dashboard
    const AdminDash = ({ creators, campaigns, subs, setView, landingStats, setLandingStats, hasPermission, supabaseData }) => {
      const [showStatsEdit, setShowStatsEdit] = useState(false);
      const [editStats, setEditStats] = useState(landingStats);
      const [showEmailSettings, setShowEmailSettings] = useState(false);
      const [emailSettings, setEmailSettings] = useState({
        new_campaign: true,
        submission_approved: true,
        submission_rejected: true,
        payment_sent: true,
        campaign_ending: false,
        campaign_ended: false
      });
      const [emailSettingsLoading, setEmailSettingsLoading] = useState(false);
      
      // Email Blast state
      const [showEmailBlast, setShowEmailBlast] = useState(false);
      const [blastSubject, setBlastSubject] = useState('');
      const [blastMessage, setBlastMessage] = useState('');
      const [blastSending, setBlastSending] = useState(false);
      const [blastSent, setBlastSent] = useState(false);
      const [blastError, setBlastError] = useState('');
      const [blastRecipients, setBlastRecipients] = useState('all'); // 'all', 'active', 'tier'
      const [blastTier, setBlastTier] = useState('All');
      
      const emailNotifTypes = [
        { key: 'new_campaign', label: 'New Campaign Launch', desc: 'Email all creators when a campaign goes live', icon: 'üéâ' },
        { key: 'submission_approved', label: 'Submission Approved', desc: 'Email creator when their post is verified', icon: '‚úÖ' },
        { key: 'submission_rejected', label: 'Submission Rejected', desc: 'Email creator when their post needs changes', icon: '‚ùå' },
        { key: 'payment_sent', label: 'Payment Sent', desc: 'Email creator when payment is processed', icon: 'üí∞' },
        { key: 'campaign_ending', label: 'Campaign Ending Soon', desc: '24-hour reminder emails (high volume)', icon: '‚è∞' },
        { key: 'campaign_ended', label: 'Campaign Ended', desc: 'Email participants when campaign closes', icon: 'üèÅ' },
      ];
      
      // Load admin email settings on mount
      useEffect(() => {
        const loadEmailSettings = async () => {
          if (supabaseData?.getAdminSettings) {
            const settings = await supabaseData.getAdminSettings('notification_email_settings');
            if (settings) setEmailSettings(settings);
          }
        };
        loadEmailSettings();
      }, [supabaseData]);
      
      const toggleEmailSetting = (key) => {
        setEmailSettings(prev => ({ ...prev, [key]: !prev[key] }));
      };
      
      const saveEmailSettings = async () => {
        setEmailSettingsLoading(true);
        if (supabaseData?.updateAdminSettings) {
          await supabaseData.updateAdminSettings('notification_email_settings', emailSettings);
        }
        setEmailSettingsLoading(false);
        setShowEmailSettings(false);
      };
      
      // Get recipients for email blast based on filter
      const getBlastRecipients = () => {
        let recipients = creators.filter(c => c.email && c.email_notifications !== false);
        if (blastRecipients === 'active') {
          recipients = recipients.filter(c => (c.status || 'Active') === 'Active');
        }
        if (blastTier !== 'All') {
          recipients = recipients.filter(c => c.tier === blastTier);
        }
        return recipients;
      };
      
      const sendEmailBlast = async () => {
        if (!blastSubject.trim() || !blastMessage.trim()) {
          setBlastError('Please enter both subject and message');
          return;
        }
        
        const recipients = getBlastRecipients();
        if (recipients.length === 0) {
          setBlastError('No recipients match the selected criteria');
          return;
        }
        
        setBlastSending(true);
        setBlastError('');
        
        let successCount = 0;
        let failCount = 0;
        
        for (const creator of recipients) {
          try {
            const response = await fetch('/api/send-email', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                type: 'notification',
                to: creator.email,
                data: { 
                  title: blastSubject,
                  message: blastMessage.replace('{name}', creator.name).replace('{handle}', creator.handle).replace('{tier}', creator.tier)
                }
              })
            });
            if (response.ok) successCount++;
            else failCount++;
          } catch (err) {
            failCount++;
            console.error('Failed to send blast email to:', creator.email);
          }
        }
        
        setBlastSending(false);
        
        if (failCount === 0) {
          setBlastSent(true);
          setTimeout(() => {
            setShowEmailBlast(false);
            setBlastSubject('');
            setBlastMessage('');
            setBlastSent(false);
            setBlastRecipients('all');
            setBlastTier('All');
          }, 2500);
        } else {
          setBlastError(`Sent ${successCount} emails, ${failCount} failed`);
        }
      };
      
      const active = campaigns.filter(c => c.status === 'Active');
      const upcoming = campaigns.filter(c => c.status === 'Upcoming');
      const ended = campaigns.filter(c => c.status === 'Ended');
      const pending = subs.filter(s => s.status === 'Pending').length;
      const verified = subs.filter(s => s.status === 'Verified');
      const views = verified.reduce((a, s) => a + (s.views || 0), 0);
      const likes = verified.reduce((a, s) => a + (s.likes || 0), 0);
      const totalBudget = campaigns.reduce((a, c) => a + c.budget, 0);
      const totalEarned = creators.reduce((a, c) => a + (c.totalEarned || 0), 0);
      const tierCounts = ['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze'].map(t => ({ tier: t, count: creators.filter(c => c.tier === t).length }));
      const saveStats = () => { setLandingStats(editStats); setShowStatsEdit(false); };
      return (
        <div className="space-y-6">
          <h1 className="text-2xl font-bold text-[#232324]">Admin Dashboard</h1>
          
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            {[{ i: 'üèÜ', v: active.length, l: 'Active Campaigns', c: 'bg-green-50', click: () => setView('admin-campaigns') }, { i: 'üë•', v: creators.length, l: 'Total Creators', c: 'bg-blue-50', click: () => setView('admin-creators') }, { i: '‚è≥', v: pending, l: 'Pending Review', c: pending > 0 ? 'bg-yellow-100' : 'bg-white', click: () => setView('admin-submissions') }, { i: 'üìù', v: verified.length, l: 'Verified Posts', c: 'bg-purple-50' }].map((s, i) => (
              <div key={i} onClick={s.click} className={`${s.c} rounded-xl border-4 border-[#232324] shadow-brutal p-5 ${s.click ? 'cursor-pointer hover:border-[#2D7FF9] transition-all' : ''}`}>
                <div className="flex items-center justify-between"><span className="text-3xl">{s.i}</span><span className="text-3xl font-bold text-[#232324]">{s.v}</span></div>
                <p className="text-xs font-semibold text-[#232324]/60 uppercase mt-2">{s.l}</p>
              </div>
            ))}
          </div>

          {pending > 0 && (<div className="bg-yellow-100 border-4 border-yellow-400 rounded-xl p-4 cursor-pointer hover:bg-yellow-200" onClick={() => setView('admin-submissions')}><h3 className="font-bold text-yellow-800">‚ö†Ô∏è {pending} Submissions Pending Review</h3><p className="text-yellow-700 text-sm">Click to review ‚Üí</p></div>)}

          <div className="grid lg:grid-cols-2 gap-6">
            <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-6">
              <h2 className="text-lg font-bold text-[#232324] mb-4">üìä Network Overview</h2>
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-[#FFF7E9] rounded-lg p-4"><p className="text-2xl font-bold text-[#2D7FF9]">{(views/1000).toFixed(1)}K</p><p className="text-xs text-[#232324]/60">Total Impressions</p></div>
                <div className="bg-[#FFF7E9] rounded-lg p-4"><p className="text-2xl font-bold text-[#2D7FF9]">{(likes/1000).toFixed(1)}K</p><p className="text-xs text-[#232324]/60">Total Likes</p></div>
                <div className="bg-[#FFF7E9] rounded-lg p-4"><p className="text-2xl font-bold text-[#2D7FF9]">${(totalBudget/1000).toFixed(0)}K</p><p className="text-xs text-[#232324]/60">Total Budget</p></div>
                <div className="bg-[#FFF7E9] rounded-lg p-4"><p className="text-2xl font-bold text-[#2D7FF9]">${(totalEarned/1000).toFixed(1)}K</p><p className="text-xs text-[#232324]/60">Total Paid Out</p></div>
              </div>
            </div>

            <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-6">
              <h2 className="text-lg font-bold text-[#232324] mb-4">üë• Creator Distribution</h2>
              <div className="space-y-3">
                {tierCounts.map(({ tier, count }) => (
                  <div key={tier} className="flex items-center gap-3">
                    <span className={`w-20 text-sm font-semibold ${ts(tier).split(' ')[1]}`}>{tier}</span>
                    <div className="flex-1 bg-gray-100 rounded-full h-4">
                      <div className={`h-full rounded-full bg-gradient-to-r ${tg(tier)}`} style={{ width: `${(count/creators.length)*100}%` }}></div>
                    </div>
                    <span className="w-8 text-right font-bold">{count}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-6">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-lg font-bold text-[#232324]">üèÜ Campaigns Summary</h2>
              <button onClick={() => setView('admin-campaigns')} className="text-[#2D7FF9] font-semibold text-sm hover:underline">Manage All ‚Üí</button>
            </div>
            <div className="grid md:grid-cols-4 gap-4">
              <div className="bg-gray-100 rounded-lg p-4 border-2 border-gray-300 cursor-pointer hover:border-gray-400" onClick={() => setView('admin-campaigns')}>
                <p className="text-3xl font-bold text-gray-500">{campaigns.filter(c => c.status === 'Draft').length}</p>
                <p className="text-sm text-gray-500">Drafts</p>
              </div>
              <div className="bg-green-50 rounded-lg p-4 border-2 border-green-200 cursor-pointer hover:border-green-400" onClick={() => setView('admin-campaigns')}>
                <p className="text-3xl font-bold text-green-700">{active.length}</p>
                <p className="text-sm text-green-600">Active</p>
              </div>
              <div className="bg-blue-50 rounded-lg p-4 border-2 border-blue-200 cursor-pointer hover:border-blue-400" onClick={() => setView('admin-campaigns')}>
                <p className="text-3xl font-bold text-blue-700">{upcoming.length}</p>
                <p className="text-sm text-blue-600">Upcoming</p>
              </div>
              <div className="bg-gray-50 rounded-lg p-4 border-2 border-gray-200 cursor-pointer hover:border-gray-400" onClick={() => setView('admin-campaigns')}>
                <p className="text-3xl font-bold text-gray-700">{ended.length}</p>
                <p className="text-sm text-gray-600">Ended</p>
              </div>
            </div>
          </div>

          {/* Advanced Analytics */}
          <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl border-4 border-[#232324] shadow-brutal p-6 text-white">
            <h2 className="text-lg font-bold mb-4">üìà Performance Analytics</h2>
            <div className="grid md:grid-cols-4 gap-4">
              <div className="bg-white/20 backdrop-blur rounded-lg p-4">
                <p className="text-3xl font-bold">{verified.length > 0 ? ((likes + verified.reduce((a,s) => a + (s.retweets||0), 0) + verified.reduce((a,s) => a + (s.replies||0), 0)) / views * 100).toFixed(2) : 0}%</p>
                <p className="text-sm opacity-80">Avg Engagement Rate</p>
              </div>
              <div className="bg-white/20 backdrop-blur rounded-lg p-4">
                <p className="text-3xl font-bold">{creators.filter(c => (c.status || 'Active') === 'Active').length}</p>
                <p className="text-sm opacity-80">Active Creators</p>
              </div>
              <div className="bg-white/20 backdrop-blur rounded-lg p-4">
                <p className="text-3xl font-bold">{verified.length > 0 ? Math.round(views / verified.length).toLocaleString() : 0}</p>
                <p className="text-sm opacity-80">Avg Views/Post</p>
              </div>
              <div className="bg-white/20 backdrop-blur rounded-lg p-4">
                <p className="text-3xl font-bold">${totalBudget > 0 ? (views / totalBudget).toFixed(0) : 0}</p>
                <p className="text-sm opacity-80">Views per $1 Spent</p>
              </div>
            </div>
          </div>

          {/* Top Performers */}
          <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-6">
            <h2 className="text-lg font-bold text-[#232324] mb-4">üåü Top Performers</h2>
            <div className="grid md:grid-cols-2 gap-6">
              <div>
                <h3 className="font-semibold text-sm text-[#232324]/60 mb-3">Top Earners</h3>
                <div className="space-y-2">
                  {[...creators].sort((a,b) => (b.totalEarned||0) - (a.totalEarned||0)).slice(0, 5).map((c, i) => (
                    <div key={c.id} className="flex items-center gap-3 p-2 bg-[#FFF7E9] rounded-lg">
                      <span className="w-6 h-6 rounded-full bg-[#2D7FF9] text-white text-xs font-bold flex items-center justify-center">{i+1}</span>
                      <span className="text-lg">{c.avatar || 'üë§'}</span>
                      <div className="flex-1">
                        <p className="font-semibold text-sm">@{c.handle}</p>
                        <span className={`text-xs font-bold px-2 py-0.5 rounded-full ${ts(c.tier)}`}>{c.tier}</span>
                      </div>
                      <p className="font-bold text-[#18B369]">${(c.totalEarned||0).toLocaleString()}</p>
                    </div>
                  ))}
                </div>
              </div>
              <div>
                <h3 className="font-semibold text-sm text-[#232324]/60 mb-3">Most Active (by posts)</h3>
                <div className="space-y-2">
                  {Object.entries(subs.reduce((acc, s) => { acc[s.creatorId] = (acc[s.creatorId] || 0) + 1; return acc; }, {}))
                    .sort((a,b) => b[1] - a[1])
                    .slice(0, 5)
                    .map(([creatorId, count], i) => {
                      const c = creators.find(cr => cr.id === +creatorId || cr.id === creatorId);
                      if (!c) return null;
                      return (
                        <div key={creatorId} className="flex items-center gap-3 p-2 bg-[#FFF7E9] rounded-lg">
                          <span className="w-6 h-6 rounded-full bg-purple-500 text-white text-xs font-bold flex items-center justify-center">{i+1}</span>
                          <span className="text-lg">{c.avatar || 'üë§'}</span>
                          <div className="flex-1">
                            <p className="font-semibold text-sm">@{c.handle}</p>
                            <span className={`text-xs font-bold px-2 py-0.5 rounded-full ${ts(c.tier)}`}>{c.tier}</span>
                          </div>
                          <p className="font-bold text-purple-600">{count} posts</p>
                        </div>
                      );
                    })}
                </div>
              </div>
            </div>
          </div>

          {/* Landing Page Stats Editor */}
          <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-6">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-lg font-bold text-[#232324]">üè† Landing Page Stats</h2>
              <button onClick={() => { setEditStats(landingStats); setShowStatsEdit(true); }} className="bg-[#2D7FF9] text-white px-4 py-2 rounded-lg font-semibold text-sm border-2 border-[#232324]">‚úèÔ∏è Edit Stats</button>
            </div>
            <p className="text-sm text-[#232324]/60 mb-4">These numbers appear on the login page to showcase platform growth.</p>
            <div className="grid grid-cols-3 gap-4">
              <div className="bg-[#FFF7E9] rounded-lg p-4 text-center"><p className="text-2xl font-bold text-[#2D7FF9]">{landingStats.creators}</p><p className="text-xs text-[#232324]/60">Creators</p></div>
              <div className="bg-[#FFF7E9] rounded-lg p-4 text-center"><p className="text-2xl font-bold text-[#2D7FF9]">{landingStats.paidOut}</p><p className="text-xs text-[#232324]/60">Paid Out</p></div>
              <div className="bg-[#FFF7E9] rounded-lg p-4 text-center"><p className="text-2xl font-bold text-[#2D7FF9]">{landingStats.campaigns}</p><p className="text-xs text-[#232324]/60">Campaigns</p></div>
            </div>
          </div>

          {/* Email Notification Settings */}
          <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-6">
            <div className="flex items-center justify-between mb-4">
              <div>
                <h2 className="text-lg font-bold text-[#232324]">üìß Email Notifications</h2>
                <p className="text-sm text-[#232324]/60">Control which notifications send emails to creators</p>
              </div>
              <button onClick={() => setShowEmailSettings(true)} className="bg-[#2D7FF9] text-white px-4 py-2 rounded-lg font-semibold text-sm border-2 border-[#232324]">‚öôÔ∏è Settings</button>
            </div>
            <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-3">
              <p className="text-sm text-yellow-800"><strong>üìä Resend Free Tier:</strong> 100 emails/day, 3,000/month</p>
              <p className="text-xs text-yellow-700 mt-1">Currently enabled: {Object.entries(emailSettings).filter(([_, v]) => v).map(([k]) => emailNotifTypes.find(t => t.key === k)?.icon).join(' ')}</p>
            </div>
          </div>

          {/* Email Blast */}
          <div className="bg-gradient-to-r from-purple-500 to-indigo-600 rounded-xl border-4 border-[#232324] shadow-brutal p-6">
            <div className="flex items-center justify-between">
              <div>
                <h2 className="text-lg font-bold text-white">üì£ Email Blast</h2>
                <p className="text-sm text-white/80">Send a custom announcement to all creators</p>
              </div>
              <button onClick={() => setShowEmailBlast(true)} className="bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold text-sm border-2 border-[#232324] hover:bg-purple-50">‚úâÔ∏è Compose</button>
            </div>
          </div>

          {showStatsEdit && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setShowStatsEdit(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-md w-full" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold text-[#232324] mb-4">Edit Landing Page Stats</h3>
                <p className="text-sm text-[#232324]/60 mb-4">Update the statistics shown on the login page.</p>
                <div className="space-y-4">
                  <div><label className="block text-sm font-bold mb-1">Creators (e.g. "250+")</label><input value={editStats.creators} onChange={e => setEditStats({...editStats, creators: e.target.value})} className="w-full px-4 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                  <div><label className="block text-sm font-bold mb-1">Paid Out (e.g. "$500K+")</label><input value={editStats.paidOut} onChange={e => setEditStats({...editStats, paidOut: e.target.value})} className="w-full px-4 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                  <div><label className="block text-sm font-bold mb-1">Campaigns (e.g. "50+")</label><input value={editStats.campaigns} onChange={e => setEditStats({...editStats, campaigns: e.target.value})} className="w-full px-4 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                </div>
                <div className="flex gap-3 mt-6"><button onClick={() => setShowStatsEdit(false)} className="flex-1 py-2 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button><button onClick={saveStats} className="flex-1 py-2 rounded-lg font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324]">Save Changes</button></div>
              </div>
            </div>
          )}

          {/* Email Settings Modal */}
          {showEmailSettings && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setShowEmailSettings(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-lg w-full" onClick={e => e.stopPropagation()}>
                <div className="flex justify-between items-center mb-2">
                  <h3 className="text-xl font-bold text-[#232324]">üìß Email Notification Settings</h3>
                  <button onClick={() => setShowEmailSettings(false)} className="text-2xl text-[#232324]/60 hover:text-[#232324]">√ó</button>
                </div>
                <p className="text-sm text-[#232324]/60 mb-4">Choose which notifications send emails to creators. Individual creators can also opt out of specific types.</p>
                
                <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-3 mb-4">
                  <p className="text-sm text-yellow-800 font-semibold">‚ö†Ô∏è Be mindful of email limits</p>
                  <p className="text-xs text-yellow-700">Free tier: 100/day, 3,000/month. High-volume notifications like "Campaign Ending" can use many emails.</p>
                </div>
                
                <div className="space-y-2 mb-6 max-h-80 overflow-y-auto">
                  {emailNotifTypes.map(({ key, label, desc, icon }) => (
                    <label key={key} className="flex items-center justify-between p-3 rounded-lg border-2 border-[#232324]/20 hover:border-[#2D7FF9]/50 cursor-pointer transition-colors">
                      <div className="flex items-center gap-3">
                        <span className="text-xl">{icon}</span>
                        <div>
                          <p className="font-semibold text-[#232324] text-sm">{label}</p>
                          <p className="text-xs text-[#232324]/50">{desc}</p>
                        </div>
                      </div>
                      <button 
                        onClick={() => toggleEmailSetting(key)}
                        className={`relative w-12 h-7 rounded-full border-2 border-[#232324] transition-colors ${emailSettings[key] ? 'bg-[#18B369]' : 'bg-gray-300'}`}
                      >
                        <div className={`absolute top-0.5 w-5 h-5 bg-white rounded-full border border-[#232324] transition-transform ${emailSettings[key] ? 'translate-x-5' : 'translate-x-0.5'}`} />
                      </button>
                    </label>
                  ))}
                </div>
                
                <div className="flex gap-3">
                  <button onClick={() => setShowEmailSettings(false)} className="flex-1 py-2.5 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button>
                  <button onClick={saveEmailSettings} disabled={emailSettingsLoading} className="flex-1 py-2.5 rounded-lg font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324] disabled:opacity-50">
                    {emailSettingsLoading ? 'Saving...' : 'Save Settings'}
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Email Blast Modal */}
          {showEmailBlast && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => !blastSending && setShowEmailBlast(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-lg w-full" onClick={e => e.stopPropagation()}>
                {blastSent ? (
                  <div className="text-center py-8">
                    <div className="text-6xl mb-4">‚úÖ</div>
                    <h3 className="text-2xl font-bold text-[#232324] mb-2">Emails Sent!</h3>
                    <p className="text-[#232324]/60">Your message has been delivered to {getBlastRecipients().length} creators.</p>
                  </div>
                ) : (
                  <>
                    <div className="flex justify-between items-center mb-4">
                      <h3 className="text-xl font-bold text-[#232324]">üì£ Send Email Blast</h3>
                      <button onClick={() => setShowEmailBlast(false)} disabled={blastSending} className="text-2xl text-[#232324]/60 hover:text-[#232324]">√ó</button>
                    </div>
                    
                    {blastError && (
                      <div className="bg-red-50 border-2 border-red-300 text-red-700 px-4 py-2 rounded-lg text-sm mb-4">
                        {blastError}
                      </div>
                    )}
                    
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-bold mb-1">Recipients</label>
                        <div className="flex gap-2 flex-wrap">
                          <button onClick={() => setBlastRecipients('all')} className={`px-3 py-1.5 rounded-lg text-sm font-semibold border-2 ${blastRecipients === 'all' ? 'bg-[#2D7FF9] text-white border-[#232324]' : 'border-[#232324]/30'}`}>All Creators</button>
                          <button onClick={() => setBlastRecipients('active')} className={`px-3 py-1.5 rounded-lg text-sm font-semibold border-2 ${blastRecipients === 'active' ? 'bg-[#2D7FF9] text-white border-[#232324]' : 'border-[#232324]/30'}`}>Active Only</button>
                          <select value={blastTier} onChange={e => setBlastTier(e.target.value)} className="px-3 py-1.5 rounded-lg text-sm font-semibold border-2 border-[#232324]/30 bg-white">
                            <option value="All">All Tiers</option>
                            <option value="Diamond">Diamond</option>
                            <option value="Platinum">Platinum</option>
                            <option value="Gold">Gold</option>
                            <option value="Silver">Silver</option>
                            <option value="Bronze">Bronze</option>
                          </select>
                        </div>
                        <p className="text-xs text-[#232324]/50 mt-1">üì® Will send to {getBlastRecipients().length} creators (who have emails enabled)</p>
                      </div>
                      
                      <div>
                        <label className="block text-sm font-bold mb-1">Subject</label>
                        <input 
                          value={blastSubject} 
                          onChange={e => setBlastSubject(e.target.value)} 
                          placeholder="e.g., üéâ Exciting News from SCAL3 Arena!"
                          className="w-full px-4 py-2.5 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" 
                          disabled={blastSending}
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-bold mb-1">Message</label>
                        <textarea 
                          value={blastMessage} 
                          onChange={e => setBlastMessage(e.target.value)} 
                          placeholder="Write your announcement here... You can use {name}, {handle}, and {tier} as placeholders."
                          rows={5}
                          className="w-full px-4 py-2.5 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] resize-none" 
                          disabled={blastSending}
                        />
                        <p className="text-xs text-[#232324]/50 mt-1">üí° Tip: Use {'{name}'}, {'{handle}'}, {'{tier}'} to personalize</p>
                      </div>
                    </div>
                    
                    <div className="flex gap-3 mt-6">
                      <button onClick={() => setShowEmailBlast(false)} disabled={blastSending} className="flex-1 py-2.5 rounded-lg font-semibold border-3 border-[#232324] disabled:opacity-50">Cancel</button>
                      <button onClick={sendEmailBlast} disabled={blastSending || !blastSubject.trim() || !blastMessage.trim()} className="flex-1 py-2.5 rounded-lg font-semibold bg-purple-600 text-white border-3 border-[#232324] disabled:opacity-50 flex items-center justify-center gap-2">
                        {blastSending ? (
                          <>
                            <svg className="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Sending...
                          </>
                        ) : (
                          <>üì§ Send to {getBlastRecipients().length} Creators</>
                        )}
                      </button>
                    </div>
                  </>
                )}
              </div>
            </div>
          )}
        </div>
      );
    };

    // Admin Campaigns
    const AdminCamps = ({ campaigns, setCampaigns, subs, setView, setAdminCamp, hasPermission, supabaseData }) => {
      const [showCreate, setShowCreate] = useState(false);
      const [errors, setErrors] = useState({});
      const canManageCampaigns = hasPermission?.('manage_campaigns') ?? true;
      const defaultBonusPool = [{ startRank: 1, endRank: 1, amount: 2500 }, { startRank: 2, endRank: 2, amount: 1500 }, { startRank: 3, endRank: 3, amount: 1000 }, { startRank: 4, endRank: 10, amount: 200 }, { startRank: 11, endRank: 25, amount: 100 }];
      const [newCamp, setNewCamp] = useState({ 
        name: '', brand: '', brandLogo: '', status: 'Upcoming', budget: 25000, startDate: '', endDate: '', 
        description: '', about: '', requirements: [''], 
        // Reward structure toggles
        enableBasePayout: true,
        enableTierChampions: true, 
        enableLeaderboard: true,
        basePayout: { Diamond: 100, Platinum: 60, Gold: 35, Silver: 15, Bronze: 10 }, 
        tierChampions: { Diamond: 1500, Platinum: 1250, Gold: 1000, Silver: 750, Bronze: 500 }, 
        bonusPool: defaultBonusPool, 
        minPosts: 3, maxPosts: 0, 
        links: { website: '', twitter: '', docs: '' } 
      });
      const handleImageUpload = (e) => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (ev) => setNewCamp({...newCamp, brandLogo: ev.target.result}); reader.readAsDataURL(file); } };
      const addBonusRange = () => setNewCamp({...newCamp, bonusPool: [...newCamp.bonusPool, { startRank: 1, endRank: 1, amount: 0 }]});
      const updateBonus = (i, field, val) => { const bp = [...newCamp.bonusPool]; bp[i][field] = +val; setNewCamp({...newCamp, bonusPool: bp}); };
      const removeBonus = (i) => setNewCamp({...newCamp, bonusPool: newCamp.bonusPool.filter((_, idx) => idx !== i)});
      const addRequirement = () => setNewCamp({...newCamp, requirements: [...newCamp.requirements, '']});
      const removeRequirement = (i) => setNewCamp({...newCamp, requirements: newCamp.requirements.filter((_, idx) => idx !== i)});
      const updateRequirement = (i, val) => { const reqs = [...newCamp.requirements]; reqs[i] = val; setNewCamp({...newCamp, requirements: reqs}); };
      
      const validateCampaign = (isDraft = false) => {
        if (isDraft) return true; // Drafts don't need validation
        const errs = {};
        if (!newCamp.name.trim()) errs.name = 'Campaign name is required';
        if (!newCamp.brand.trim()) errs.brand = 'Brand name is required';
        if (!newCamp.startDate) errs.startDate = 'Start date is required';
        if (!newCamp.endDate) errs.endDate = 'End date is required';
        if (newCamp.budget <= 0) errs.budget = 'Budget must be greater than 0';
        if (!newCamp.description.trim()) errs.description = 'Description is required';
        setErrors(errs);
        return Object.keys(errs).length === 0;
      };
      
      const saveCampaign = async (isDraft = false) => {
        if (!validateCampaign(isDraft)) return;
        const bonusPoolFormatted = newCamp.bonusPool.map(b => ({ place: b.startRank === b.endRank ? `#${b.startRank}` : `#${b.startRank}-${b.endRank}`, amount: b.amount }));
        
        // Use user's selected status, but if it's a draft, force Draft status
        // Status will auto-update on page load based on dates anyway
        const finalStatus = isDraft ? 'Draft' : newCamp.status;
        
        const camp = { 
          ...newCamp, 
          status: finalStatus,
          requirements: newCamp.requirements.filter(r => r.trim()), 
          bonusPool: bonusPoolFormatted 
        };
        
        // Save to Supabase if available
        if (supabaseData?.createCampaign) {
          try {
            await supabaseData.createCampaign(camp);
            // Refresh data from database to get the new ID
            if (supabaseData.fetchData) {
              await supabaseData.fetchData();
            }
          } catch (err) {
            console.error('Failed to save campaign to database:', err);
            alert('Failed to save campaign. Please try again.');
            return;
          }
        } else {
          // Fallback to local state only (mock mode)
          camp.id = campaigns.length + 1;
          setCampaigns([...campaigns, camp]);
        }
        
        setShowCreate(false); 
        setErrors({});
        
        // Notify all creators about new campaign (if Active, not Draft)
        const isActive = getCampaignStatus({ status: 'Active', startDate: newCamp.startDate, endDate: newCamp.endDate }) === 'Active';
        if (!isDraft && isActive && supabaseData?.notifyAllCreators) {
          try {
            await supabaseData.notifyAllCreators({
              type: 'new_campaign',
              title: 'üéâ New Campaign!',
              message: `${camp.name} is now live! ${camp.brand} is offering $${camp.budget?.toLocaleString()} in rewards.`,
              data: { campaignId: camp.id, campaignName: camp.name, brand: camp.brand, budget: camp.budget }
            });
          } catch (err) {
            console.error('Failed to notify creators:', err);
          }
        }
        
        resetForm();
      };
      
      const resetForm = () => {
        setNewCamp({ 
          name: '', brand: '', brandLogo: '', status: 'Upcoming', budget: 25000, startDate: '', endDate: '', 
          description: '', about: '', requirements: [''], 
          enableBasePayout: true, enableTierChampions: true, enableLeaderboard: true,
          basePayout: { Diamond: 100, Platinum: 60, Gold: 35, Silver: 15, Bronze: 10 }, 
          tierChampions: { Diamond: 1500, Platinum: 1250, Gold: 1000, Silver: 750, Bronze: 500 }, 
          bonusPool: defaultBonusPool, minPosts: 3, maxPosts: 0, links: { website: '', twitter: '', docs: '' } 
        });
      };
      const inputClass = (field) => `w-full px-3 py-2 rounded-lg border-3 ${errors[field] ? 'border-red-500 bg-red-50' : 'border-[#232324] bg-[#FFF7E9]'}`;
      return (
        <div className="space-y-6">
          <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3"><h1 className="text-2xl font-bold text-[#232324]">Campaigns</h1>{canManageCampaigns && <button onClick={() => setShowCreate(true)} className="bg-[#2D7FF9] text-white px-4 py-2 rounded-lg font-semibold border-3 border-[#232324] shadow-brutal-sm hover-brutal">+ New Campaign</button>}</div>
          <div className="space-y-4">
            {campaigns.map(c => { const v = subs.filter(s => s.campaignId === c.id && s.status === 'Verified'); const views = v.reduce((a, s) => a + (s.views || 0), 0); const participants = getParticipants(subs, c.id); return (
                <div key={c.id} onClick={() => { setAdminCamp(c); setView('admin-campaign-detail'); }} className={`bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6 cursor-pointer hover:border-[#2D7FF9] ${c.status === 'Draft' ? 'opacity-70' : ''}`}>
                  <div className="flex flex-col sm:flex-row items-start sm:items-center gap-4 sm:gap-6">
                    <img src={c.brandLogo} alt="" className="w-14 h-14 sm:w-16 sm:h-16 rounded-xl border-3 border-[#232324] bg-white object-contain p-2" onError={e => e.target.style.display='none'} />
                    <div className="flex-1 min-w-0">
                      <div className="flex flex-wrap items-center gap-2 mb-1">{c.status === 'Draft' && <span className="text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full font-semibold">üìù Draft</span>}{c.status === 'Active' && <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-semibold">‚óè Active</span>}{c.status === 'Upcoming' && <span className="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full font-semibold">Upcoming</span>}{c.status === 'Ended' && <span className="text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full font-semibold">Ended</span>}</div>
                      <h3 className="text-lg sm:text-xl font-bold text-[#232324] truncate">{c.name || 'Untitled Campaign'}</h3>
                      <p className="text-[#232324]/60 text-sm">{c.brand || 'No brand'} ‚Ä¢ {c.startDate ? fmtDate(c.startDate) : 'No date'} - {c.endDate ? fmtDate(c.endDate) : 'No date'}</p>
                    </div>
                    <div className="grid grid-cols-4 gap-3 sm:gap-6 text-center w-full sm:w-auto">
                      <div><p className="text-lg sm:text-2xl font-bold">{participants}</p><p className="text-[10px] sm:text-xs text-[#232324]/60">Participants</p></div>
                      <div><p className="text-lg sm:text-2xl font-bold">{v.length}</p><p className="text-[10px] sm:text-xs text-[#232324]/60">Posts</p></div>
                      <div><p className="text-lg sm:text-2xl font-bold">{(views/1000).toFixed(1)}K</p><p className="text-[10px] sm:text-xs text-[#232324]/60">Views</p></div>
                      <div><p className="text-lg sm:text-2xl font-bold text-[#2D7FF9]">${(c.budget/1000).toFixed(0)}K</p><p className="text-[10px] sm:text-xs text-[#232324]/60">Budget</p></div>
                    </div>
                    <span className="hidden sm:block text-[#2D7FF9] text-xl">‚Üí</span>
                  </div>
                </div>
              ); })}
          </div>
          {showCreate && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-2 sm:p-4 z-50 overflow-y-auto" onClick={() => { setShowCreate(false); setErrors({}); }}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6 max-w-4xl w-full my-4 max-h-[95vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl sm:text-2xl font-bold text-[#232324] mb-4 sm:mb-6">Create New Campaign</h3>
                {Object.keys(errors).length > 0 && <div className="bg-red-50 border-2 border-red-400 rounded-lg p-3 mb-4"><p className="text-red-700 font-semibold text-sm">‚ö†Ô∏è Please fix the highlighted fields below</p></div>}
                <div className="space-y-5">
                  <div><h4 className="font-bold text-[#232324] mb-3">Basic Info <span className="text-red-500">*</span></h4>
                    <div className="grid sm:grid-cols-2 gap-3 sm:gap-4">
                      <div><label className="block text-sm font-bold mb-1">Campaign Name <span className="text-red-500">*</span></label><input value={newCamp.name} onChange={e => setNewCamp({...newCamp, name: e.target.value})} className={inputClass('name')} />{errors.name && <p className="text-red-500 text-xs mt-1">{errors.name}</p>}</div>
                      <div><label className="block text-sm font-bold mb-1">Brand <span className="text-red-500">*</span></label><input value={newCamp.brand} onChange={e => setNewCamp({...newCamp, brand: e.target.value})} className={inputClass('brand')} />{errors.brand && <p className="text-red-500 text-xs mt-1">{errors.brand}</p>}</div>
                      <div className="sm:col-span-2"><label className="block text-sm font-bold mb-1">Project Logo</label><div className="flex flex-col sm:flex-row gap-3"><input type="file" accept="image/*" onChange={handleImageUpload} className="flex-1 px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] text-sm" />{newCamp.brandLogo && <img src={newCamp.brandLogo} className="w-16 h-16 rounded-lg border-2 border-[#232324] object-contain bg-white" />}<input value={newCamp.brandLogo} onChange={e => setNewCamp({...newCamp, brandLogo: e.target.value})} placeholder="Or paste URL" className="flex-1 px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] text-sm" /></div></div>
                      <div><label className="block text-sm font-bold mb-1">Status</label><select value={newCamp.status} onChange={e => setNewCamp({...newCamp, status: e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]"><option value="Upcoming">Upcoming</option><option value="Active">Active</option></select>{newCamp.startDate && newCamp.endDate && <p className="text-xs mt-1"><span className={`font-semibold ${getCampaignStatus({status: 'Active', startDate: newCamp.startDate, endDate: newCamp.endDate}) === 'Active' ? 'text-green-600' : getCampaignStatus({status: 'Active', startDate: newCamp.startDate, endDate: newCamp.endDate}) === 'Upcoming' ? 'text-blue-600' : 'text-red-600'}`}>Auto: {getCampaignStatus({status: 'Active', startDate: newCamp.startDate, endDate: newCamp.endDate})}</span> <span className="text-[#232324]/50">(based on dates)</span></p>}</div>
                      <div><label className="block text-sm font-bold mb-1">Total Budget ($) <span className="text-red-500">*</span></label><input type="number" value={newCamp.budget} onChange={e => setNewCamp({...newCamp, budget: +e.target.value})} className={inputClass('budget')} />{errors.budget && <p className="text-red-500 text-xs mt-1">{errors.budget}</p>}</div>
                      <div><label className="block text-sm font-bold mb-1">Start Date & Time (EST) <span className="text-red-500">*</span></label><input type="datetime-local" value={newCamp.startDate} onChange={e => setNewCamp({...newCamp, startDate: e.target.value})} className={inputClass('startDate')} />{errors.startDate && <p className="text-red-500 text-xs mt-1">{errors.startDate}</p>}</div>
                      <div><label className="block text-sm font-bold mb-1">End Date & Time (EST) <span className="text-red-500">*</span></label><input type="datetime-local" value={newCamp.endDate} onChange={e => setNewCamp({...newCamp, endDate: e.target.value})} className={inputClass('endDate')} />{errors.endDate && <p className="text-red-500 text-xs mt-1">{errors.endDate}</p>}</div>
                      <div><label className="block text-sm font-bold mb-1">Min Posts</label><input type="number" value={newCamp.minPosts} onChange={e => setNewCamp({...newCamp, minPosts: +e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                      <div><label className="block text-sm font-bold mb-1">Max Posts (0=‚àû)</label><input type="number" value={newCamp.maxPosts} onChange={e => setNewCamp({...newCamp, maxPosts: +e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                      <div><label className="block text-sm font-bold mb-1">Website</label><input value={newCamp.links.website} onChange={e => setNewCamp({...newCamp, links: {...newCamp.links, website: e.target.value}})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                      <div><label className="block text-sm font-bold mb-1">Twitter/X</label><input value={newCamp.links.twitter || ''} onChange={e => setNewCamp({...newCamp, links: {...newCamp.links, twitter: e.target.value}})} placeholder="https://x.com/..." className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                      <div className="sm:col-span-2"><label className="block text-sm font-bold mb-1">Docs Link</label><input value={newCamp.links.docs || ''} onChange={e => setNewCamp({...newCamp, links: {...newCamp.links, docs: e.target.value}})} placeholder="https://docs.example.com" className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                      <div className="sm:col-span-2"><label className="block text-sm font-bold mb-1">Short Description <span className="text-red-500">*</span></label><input value={newCamp.description} onChange={e => setNewCamp({...newCamp, description: e.target.value})} className={inputClass('description')} />{errors.description && <p className="text-red-500 text-xs mt-1">{errors.description}</p>}</div>
                      <div className="sm:col-span-2"><label className="block text-sm font-bold mb-1">About / Details</label><textarea value={newCamp.about} onChange={e => setNewCamp({...newCamp, about: e.target.value})} rows="4" className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] resize-y" placeholder="Detailed campaign information..." /></div>
                    </div>
                  </div>
                  
                  {/* Reward Structure Toggles */}
                  <div className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl border-3 border-[#232324] p-4">
                    <h4 className="font-bold text-[#232324] mb-3">üíé Reward Structure</h4>
                    <p className="text-sm text-[#232324]/60 mb-4">Enable/disable different reward types for this campaign</p>
                    <div className="grid sm:grid-cols-3 gap-3">
                      <label className={`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${newCamp.enableBasePayout ? 'bg-green-100 border-green-400' : 'bg-white border-[#232324]/20'}`}>
                        <input type="checkbox" checked={newCamp.enableBasePayout} onChange={e => setNewCamp({...newCamp, enableBasePayout: e.target.checked})} className="w-5 h-5 accent-green-500" />
                        <div><p className="font-semibold text-sm">üí∞ Base Payout</p><p className="text-xs text-[#232324]/60">Per-post rewards by tier</p></div>
                      </label>
                      <label className={`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${newCamp.enableTierChampions ? 'bg-green-100 border-green-400' : 'bg-white border-[#232324]/20'}`}>
                        <input type="checkbox" checked={newCamp.enableTierChampions} onChange={e => setNewCamp({...newCamp, enableTierChampions: e.target.checked})} className="w-5 h-5 accent-green-500" />
                        <div><p className="font-semibold text-sm">‚≠ê Tier Champion</p><p className="text-xs text-[#232324]/60">Top performer per tier</p></div>
                      </label>
                      <label className={`flex items-center gap-3 p-3 rounded-lg border-2 cursor-pointer transition-all ${newCamp.enableLeaderboard ? 'bg-green-100 border-green-400' : 'bg-white border-[#232324]/20'}`}>
                        <input type="checkbox" checked={newCamp.enableLeaderboard} onChange={e => setNewCamp({...newCamp, enableLeaderboard: e.target.checked})} className="w-5 h-5 accent-green-500" />
                        <div><p className="font-semibold text-sm">üèÜ Leaderboard</p><p className="text-xs text-[#232324]/60">Rank-based prizes</p></div>
                      </label>
                    </div>
                  </div>
                  
                  {newCamp.enableLeaderboard && (
                  <div><h4 className="font-bold text-[#232324] mb-3">üèÜ Leaderboard Rewards</h4><p className="text-sm text-[#232324]/60 mb-3">Set rank ranges and prizes for top performers</p>
                    <div className="space-y-2">
                      {newCamp.bonusPool.map((b, i) => (<div key={i} className="flex flex-wrap gap-2 items-center bg-[#FFF7E9] p-3 rounded-lg"><span className="text-sm font-semibold">Rank</span><input type="number" min="1" value={b.startRank} onChange={e => updateBonus(i, 'startRank', e.target.value)} className="w-16 px-2 py-2 rounded-lg border-2 border-[#232324] bg-white text-sm text-center" /><span className="text-sm">to</span><input type="number" min="1" value={b.endRank} onChange={e => updateBonus(i, 'endRank', e.target.value)} className="w-16 px-2 py-2 rounded-lg border-2 border-[#232324] bg-white text-sm text-center" /><span className="text-sm font-bold ml-2">$</span><input type="number" value={b.amount} onChange={e => updateBonus(i, 'amount', e.target.value)} className="w-24 px-3 py-2 rounded-lg border-2 border-[#232324] bg-white text-sm" /><button onClick={() => removeBonus(i)} className="text-red-500 hover:text-red-700 px-2 text-lg">‚úï</button></div>))}
                      <button onClick={addBonusRange} className="text-[#2D7FF9] font-semibold text-sm hover:underline">+ Add Reward Range</button>
                    </div>
                  </div>
                  )}
                  
                  {newCamp.enableBasePayout && (
                  <div><h4 className="font-bold text-[#232324] mb-3">üí∞ Base Payouts by Tier</h4><div className="grid grid-cols-5 gap-2">{['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze'].map(t => (<div key={t}><label className="block text-[10px] sm:text-xs font-bold mb-1 text-center">{t}</label><input type="number" value={newCamp.basePayout[t]} onChange={e => setNewCamp({...newCamp, basePayout: {...newCamp.basePayout, [t]: +e.target.value}})} className="w-full px-1 sm:px-2 py-2 rounded-lg border-2 border-[#232324] bg-[#FFF7E9] text-center text-sm" /></div>))}</div></div>
                  )}
                  
                  {newCamp.enableTierChampions && (
                  <div><h4 className="font-bold text-[#232324] mb-3">‚≠ê Tier Champion Bonus</h4><div className="grid grid-cols-5 gap-2">{['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze'].map(t => (<div key={t}><label className="block text-[10px] sm:text-xs font-bold mb-1 text-center">{t}</label><input type="number" value={newCamp.tierChampions[t]} onChange={e => setNewCamp({...newCamp, tierChampions: {...newCamp.tierChampions, [t]: +e.target.value}})} className="w-full px-1 sm:px-2 py-2 rounded-lg border-2 border-[#232324] bg-[#FFF7E9] text-center text-sm" /></div>))}</div></div>
                  )}
                  
                  <div><h4 className="font-bold text-[#232324] mb-3">üìã Requirements</h4><div className="space-y-2">{newCamp.requirements.map((r, i) => (<div key={i} className="flex gap-2"><input value={r} onChange={e => updateRequirement(i, e.target.value)} className="flex-1 px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] text-sm" placeholder={`Requirement ${i+1}`} /><button onClick={() => removeRequirement(i)} className="text-red-500 hover:text-red-700 px-2 text-lg">‚úï</button></div>))}</div><button onClick={addRequirement} className="text-[#2D7FF9] font-semibold text-sm mt-2">+ Add Requirement</button></div>
                </div>
                <div className="flex gap-3 mt-6">
                  <button onClick={() => { setShowCreate(false); setErrors({}); resetForm(); }} className="py-3 px-4 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button>
                  <button onClick={() => saveCampaign(true)} className="py-3 px-4 rounded-lg font-semibold border-3 border-gray-400 bg-gray-100 text-gray-700">üìù Save Draft</button>
                  <button onClick={() => saveCampaign(false)} className="flex-1 py-3 rounded-lg font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324]">Create Campaign</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    const AdminCampDetail = ({ camp, setCampaigns, campaigns, subs, creators, setCreators, paymentHistory, setPaymentHistory, setView, hasPermission, supabaseData }) => {
      const [editing, setEditing] = useState(false);
      const [showPayoutModal, setShowPayoutModal] = useState(false);
      const [payoutPreview, setPayoutPreview] = useState(null);
      // Parse existing bonus pool to extract numbers if in "4th-10th" format
      const parseBonusPool = (pool) => pool.map(b => {
        if (b.startRank !== undefined) return b;
        const match = b.place?.match(/#?(\d+)(?:-(\d+))?/);
        return { startRank: match ? +match[1] : 1, endRank: match ? +(match[2] || match[1]) : 1, amount: b.amount };
      });
      const [editCamp, setEditCamp] = useState({...camp, bonusPool: parseBonusPool(camp.bonusPool || [])});
      const verified = subs.filter(s => s.campaignId === camp.id && s.status === 'Verified');
      const pending = subs.filter(s => s.campaignId === camp.id && s.status === 'Pending');
      const views = verified.reduce((a, s) => a + (s.views || 0), 0);
      const participants = getParticipants(subs, camp.id);
      const lb = Object.values(verified.reduce((a, s) => { if (!a[s.creatorId]) { const cr = creators.find(c => c.id === s.creatorId); a[s.creatorId] = { id: s.creatorId, handle: s.handle, tier: s.tier, avatar: cr?.avatar, score: 0, posts: 0 }; } a[s.creatorId].score += calcScore(s.views, s.likes, s.retweets, s.replies, s.quality, s.tier); a[s.creatorId].posts++; return a; }, {})).sort((a, b) => b.score - a.score);
      const handleImageUpload = (e) => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (ev) => setEditCamp({...editCamp, brandLogo: ev.target.result}); reader.readAsDataURL(file); } };
      const addBonusRange = () => setEditCamp({...editCamp, bonusPool: [...editCamp.bonusPool, { startRank: 1, endRank: 1, amount: 0 }]});
      const updateBonus = (i, field, val) => { const bp = [...editCamp.bonusPool]; bp[i][field] = +val; setEditCamp({...editCamp, bonusPool: bp}); };
      const removeBonus = (i) => setEditCamp({...editCamp, bonusPool: editCamp.bonusPool.filter((_, idx) => idx !== i)});
      const saveCamp = () => { 
        const bonusPoolFormatted = editCamp.bonusPool.map(b => ({ place: b.startRank === b.endRank ? `#${b.startRank}` : `#${b.startRank}-${b.endRank}`, amount: b.amount }));
        setCampaigns(campaigns.map(c => c.id === camp.id ? {...editCamp, bonusPool: bonusPoolFormatted} : c)); 
        setView('admin-campaigns'); 
      };
      
      // Calculate payouts for all participants
      const calculatePayouts = () => {
        const payouts = [];
        const tierChampions = {}; // Track top scorer in each tier
        
        // Group verified submissions by creator and calculate their earnings
        lb.forEach((entry, rank) => {
          const creator = creators.find(c => c.id === entry.id);
          if (!creator) return;
          
          // Get all verified submissions for this creator in this campaign
          const creatorSubs = verified.filter(s => s.creatorId === entry.id);
          
          // 1. Base payout per post (with quality multiplier)
          let basePay = 0;
          creatorSubs.forEach(sub => {
            const baseRate = camp.basePayout?.[entry.tier] || 0;
            const qualityMult = { Poor: 0.5, Okay: 0.8, Good: 1, Great: 1.25, Amazing: 1.5 }[sub.quality] || 1;
            basePay += baseRate * qualityMult;
          });
          
          // 2. Leaderboard bonus based on rank
          let leaderboardBonus = 0;
          const bonusPool = parseBonusPool(camp.bonusPool || []);
          bonusPool.forEach(b => {
            const actualRank = rank + 1;
            if (actualRank >= b.startRank && actualRank <= b.endRank) {
              leaderboardBonus = b.amount;
            }
          });
          
          // 3. Track tier champion (top scorer in their tier)
          if (!tierChampions[entry.tier] || entry.score > tierChampions[entry.tier].score) {
            tierChampions[entry.tier] = { id: entry.id, score: entry.score };
          }
          
          payouts.push({
            creatorId: entry.id,
            handle: entry.handle,
            tier: entry.tier,
            avatar: entry.avatar,
            rank: rank + 1,
            posts: entry.posts,
            score: entry.score,
            basePay: Math.round(basePay * 100) / 100,
            leaderboardBonus,
            tierChampionBonus: 0, // Will be set after loop
            total: 0 // Will be calculated after
          });
        });
        
        // Add tier champion bonuses
        payouts.forEach(p => {
          if (tierChampions[p.tier]?.id === p.creatorId) {
            p.tierChampionBonus = camp.tierChampions?.[p.tier] || 0;
          }
          p.total = Math.round((p.basePay + p.leaderboardBonus + p.tierChampionBonus) * 100) / 100;
        });
        
        return payouts;
      };
      
      const previewPayouts = () => {
        const payouts = calculatePayouts();
        setPayoutPreview(payouts);
        setShowPayoutModal(true);
      };
      
      const confirmPayouts = async () => {
        const payouts = payoutPreview || calculatePayouts();
        const now = new Date().toISOString();
        
        // Update creator earnings
        const updatedCreators = creators.map(c => {
          const payout = payouts.find(p => p.creatorId === c.id);
          if (payout) {
            return { ...c, totalEarned: (c.totalEarned || 0) + payout.total };
          }
          return c;
        });
        setCreators(updatedCreators);
        
        // Add to payment history
        const newPayments = payouts.map(p => ({
          id: Date.now() + p.creatorId,
          campaignId: camp.id,
          campaignName: camp.name,
          creatorId: p.creatorId,
          handle: p.handle,
          amount: p.total,
          breakdown: { basePay: p.basePay, leaderboardBonus: p.leaderboardBonus, tierChampionBonus: p.tierChampionBonus },
          paidAt: now
        }));
        setPaymentHistory([...paymentHistory, ...newPayments]);
        
        // Send payment notifications to each creator
        if (supabaseData?.createNotification) {
          const adminSettings = await supabaseData.getAdminSettings?.('notification_email_settings');
          
          for (const payout of payouts) {
            if (payout.total > 0) {
              const creator = creators.find(c => c.id === payout.creatorId);
              
              // Create in-app notification
              await supabaseData.createNotification({
                userId: payout.creatorId,
                type: 'payment_sent',
                title: 'üí∞ Payment Sent!',
                message: `You earned $${payout.total.toLocaleString()} from ${camp.name}! Base: $${payout.basePay}${payout.leaderboardBonus ? ` + $${payout.leaderboardBonus} leaderboard bonus` : ''}${payout.tierChampionBonus ? ` + $${payout.tierChampionBonus} tier champion bonus` : ''}`,
                data: { 
                  campaignId: camp.id, 
                  campaignName: camp.name, 
                  amount: payout.total,
                  breakdown: { basePay: payout.basePay, leaderboardBonus: payout.leaderboardBonus, tierChampionBonus: payout.tierChampionBonus }
                }
              });
              
              // Send email if enabled
              if (creator && adminSettings?.payment_sent && creator.email_notifications !== false) {
                const prefs = creator.notification_preferences || {};
                if (prefs.payment_sent !== false) {
                  try {
                    await fetch('/api/send-email', {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify({
                        type: 'notification',
                        to: creator.email,
                        data: { 
                          title: 'üí∞ Payment Sent!', 
                          message: `You earned $${payout.total.toLocaleString()} from ${camp.name}!`,
                          campaignName: camp.name,
                          amount: payout.total
                        }
                      })
                    });
                  } catch (err) { console.error('Failed to send payment email:', err); }
                }
              }
            }
          }
        }
        
        // Update campaign status to "Ended - Paid"
        setCampaigns(campaigns.map(c => c.id === camp.id ? {...c, status: 'Ended - Paid', paidAt: now} : c));
        
        setShowPayoutModal(false);
        setPayoutPreview(null);
      };
      
      const isPaid = camp.status === 'Ended - Paid';
      const canPay = (camp.status === 'Ended' || camp.status === 'Ended - Calculating') && lb.length > 0 && pending.length === 0;
      return (
        <div className="space-y-6">
          <button onClick={() => setView('admin-campaigns')} className="text-[#232324] font-semibold hover:text-[#2D7FF9]">‚Üê Back to Campaigns</button>
          <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6">
            <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-4">
              <div className="flex items-center gap-4"><img src={camp.brandLogo} alt="" className="w-14 h-14 sm:w-16 sm:h-16 rounded-xl border-3 border-[#232324] bg-white object-contain p-2" onError={e => e.target.style.display='none'} /><div><div className="flex flex-wrap items-center gap-2"><span className="text-base sm:text-lg font-bold text-[#2D7FF9] uppercase">{camp.brand}</span>{camp.status === 'Active' && <span className="text-xs sm:text-sm bg-green-100 text-green-700 px-2 sm:px-3 py-1 rounded-full font-semibold">‚óè Active</span>}{camp.status === 'Upcoming' && <span className="text-xs sm:text-sm bg-blue-100 text-blue-700 px-2 sm:px-3 py-1 rounded-full font-semibold">Upcoming</span>}{camp.status === 'Ended' && <span className="text-xs sm:text-sm bg-orange-100 text-orange-700 px-2 sm:px-3 py-1 rounded-full font-semibold">Ended</span>}{camp.status === 'Ended - Calculating' && <span className="text-xs sm:text-sm bg-yellow-100 text-yellow-700 px-2 sm:px-3 py-1 rounded-full font-semibold">‚è≥ Calculating</span>}{camp.status === 'Ended - Paid' && <span className="text-xs sm:text-sm bg-emerald-100 text-emerald-700 px-2 sm:px-3 py-1 rounded-full font-semibold">‚úì Paid</span>}</div><h1 className="text-xl sm:text-3xl font-bold text-[#232324]">{camp.name}</h1><p className="text-[#232324]/60 text-sm">{fmtDate(camp.startDate)} - {fmtDate(camp.endDate)}</p></div></div>
              <div className="flex gap-2">
                {canPay && <button onClick={previewPayouts} className="bg-emerald-500 text-white px-4 py-2 rounded-lg font-semibold border-3 border-[#232324] whitespace-nowrap hover:bg-emerald-600">üí∞ Calculate & Pay</button>}
                {isPaid && <span className="bg-emerald-100 text-emerald-700 px-4 py-2 rounded-lg font-semibold border-3 border-emerald-300">‚úì Payouts Complete</span>}
                <button onClick={() => setEditing(true)} className="bg-[#2D7FF9] text-white px-4 py-2 rounded-lg font-semibold border-3 border-[#232324] whitespace-nowrap">‚úèÔ∏è Edit</button>
              </div>
            </div>
            {pending.length > 0 && <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-3 mb-4"><p className="text-yellow-800 text-sm font-semibold">‚ö†Ô∏è {pending.length} submissions still pending review. Review all before processing payouts.</p></div>}
            <div className="grid grid-cols-3 sm:grid-cols-5 gap-2 sm:gap-4 mb-4">{[{ l: 'Participants', v: participants }, { l: 'Posts', v: verified.length }, { l: 'Pending', v: pending.length }, { l: 'Views', v: (views/1000).toFixed(1) + 'K' }, { l: 'Budget', v: '$' + camp.budget.toLocaleString() }].map((s, i) => (<div key={i} className="bg-[#FFF7E9] rounded-lg p-3 sm:p-4 text-center"><p className="text-lg sm:text-2xl font-bold text-[#2D7FF9]">{s.v}</p><p className="text-[10px] sm:text-xs text-[#232324]/60">{s.l}</p></div>))}</div>
            {/* Campaign Quick Info */}
            <div className="bg-[#232324]/5 rounded-xl p-4 grid sm:grid-cols-2 lg:grid-cols-4 gap-3">
              <div><p className="text-xs text-[#232324]/60 font-semibold">Post Requirements</p><p className="font-bold">Min: {camp.minPosts || 3} ‚Ä¢ Max: {camp.maxPosts ? camp.maxPosts : '‚àû'}</p></div>
              <div><p className="text-xs text-[#232324]/60 font-semibold">Description</p><p className="text-sm truncate">{camp.description || 'No description'}</p></div>
              <div><p className="text-xs text-[#232324]/60 font-semibold">Website</p><p className="text-sm truncate">{camp.links?.website ? <a href={camp.links.website} target="_blank" className="text-[#2D7FF9] hover:underline">{camp.links.website}</a> : '‚Äî'}</p></div>
              <div><p className="text-xs text-[#232324]/60 font-semibold">Links</p><div className="flex gap-2">{camp.links?.twitter && <a href={camp.links.twitter} target="_blank" className="text-[#2D7FF9] text-sm hover:underline">Twitter</a>}{camp.links?.docs && <a href={camp.links.docs} target="_blank" className="text-[#2D7FF9] text-sm hover:underline">Docs</a>}{!camp.links?.twitter && !camp.links?.docs && <span className="text-sm">‚Äî</span>}</div></div>
            </div>
          </div>
          <div className="grid lg:grid-cols-3 gap-6">
            <div className="lg:col-span-2 bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6"><h2 className="text-lg sm:text-xl font-bold text-[#232324] mb-4">üìä Leaderboard</h2>{lb.length === 0 ? <p className="text-[#232324]/60">No submissions yet</p> : (<div className="overflow-x-auto"><table className="w-full"><thead><tr className="border-b-2"><th className="text-left py-2 px-2 text-sm">#</th><th className="text-left py-2 text-sm">Creator</th><th className="text-center py-2 text-sm hidden sm:table-cell">Tier</th><th className="text-center py-2 text-sm">Posts</th><th className="text-right py-2 px-2 text-sm">Score</th></tr></thead><tbody>{lb.map((e, i) => (<tr key={e.id} className="border-b border-[#232324]/10"><td className="py-2 px-2"><span className={`w-6 h-6 sm:w-7 sm:h-7 rounded-lg inline-flex items-center justify-center font-bold text-xs sm:text-sm ${i===0?'bg-yellow-400':i===1?'bg-gray-300':i===2?'bg-amber-500 text-white':'bg-[#FFF7E9]'}`}>{i+1}</span></td><td className="py-2"><div className="flex items-center gap-2"><div className={`w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gradient-to-br ${tg(e.tier)} border-2 border-[#232324] flex items-center justify-center text-xs sm:text-sm`}>{e.avatar}</div><span className="font-semibold text-sm">@{e.handle}</span></div></td><td className="py-2 text-center hidden sm:table-cell"><span className={`text-xs font-bold px-2 py-1 rounded-full ${ts(e.tier)}`}>{e.tier}</span></td><td className="py-2 text-center text-sm">{e.posts}</td><td className="py-2 px-2 text-right font-bold text-[#2D7FF9] text-sm">{e.score.toLocaleString()}</td></tr>))}</tbody></table></div>)}</div>
            <div className="space-y-4">
              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-5"><h3 className="font-bold text-[#232324] mb-3">üèÜ Leaderboard Rewards</h3><div className="space-y-2">{(camp.bonusPool || []).length > 0 ? (camp.bonusPool || []).map((b, i) => (<div key={i} className="flex justify-between items-center p-2 rounded-lg bg-[#FFF7E9]"><span className="text-sm font-semibold">{b.place}</span><span className="font-bold text-[#2D7FF9]">${b.amount}</span></div>)) : <p className="text-sm text-[#232324]/60">No bonuses set</p>}</div></div>
              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-5"><h3 className="font-bold text-[#232324] mb-3">‚≠ê Tier Champion Bonus</h3><div className="space-y-2">{['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze'].map(t => (<div key={t} className="flex justify-between items-center"><span className={`text-sm font-semibold ${ts(t).split(' ')[1]}`}>{t}</span><span className="font-bold">${camp.tierChampions?.[t] || 0}</span></div>))}</div></div>
              <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-4 sm:p-5"><h3 className="font-bold text-[#232324] mb-3">üí∞ Base Payouts</h3><div className="space-y-2">{['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze'].map(t => (<div key={t} className="flex justify-between items-center"><span className={`text-sm font-semibold ${ts(t).split(' ')[1]}`}>{t}</span><span className="font-bold">${camp.basePayout?.[t] || 0}</span></div>))}</div></div>
            </div>
          </div>
          {editing && (<div className="fixed inset-0 bg-black/50 flex items-center justify-center p-2 sm:p-4 z-50 overflow-y-auto" onClick={() => setEditing(false)}><div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6 max-w-4xl w-full my-4 max-h-[95vh] overflow-y-auto" onClick={e => e.stopPropagation()}><h3 className="text-xl sm:text-2xl font-bold mb-4 sm:mb-6">Edit Campaign</h3>
            <div className="space-y-5">
              <div className="grid sm:grid-cols-2 gap-3 sm:gap-4">
                <div><label className="block text-sm font-bold mb-1">Name</label><input value={editCamp.name} onChange={e => setEditCamp({...editCamp, name: e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                <div><label className="block text-sm font-bold mb-1">Brand</label><input value={editCamp.brand} onChange={e => setEditCamp({...editCamp, brand: e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                <div className="sm:col-span-2"><label className="block text-sm font-bold mb-1">Logo</label><div className="flex flex-col sm:flex-row gap-3"><input type="file" accept="image/*" onChange={handleImageUpload} className="flex-1 px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] text-sm" />{editCamp.brandLogo && <img src={editCamp.brandLogo} className="w-16 h-16 rounded-lg border-2 border-[#232324] object-contain bg-white" />}<input value={editCamp.brandLogo} onChange={e => setEditCamp({...editCamp, brandLogo: e.target.value})} placeholder="Or paste URL" className="flex-1 px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] text-sm" /></div></div>
                <div><label className="block text-sm font-bold mb-1">Status</label><select value={editCamp.status} onChange={e => setEditCamp({...editCamp, status: e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]"><option value="Active">Active</option><option value="Upcoming">Upcoming</option><option value="Ended">Ended</option><option value="Ended - Calculating">Ended - Calculating</option><option value="Ended - Paid">Ended - Paid</option><option value="Draft">Draft</option></select>{editCamp.startDate && editCamp.endDate && <p className="text-xs mt-1"><span className={`font-semibold ${getCampaignStatus({status: 'Active', startDate: editCamp.startDate, endDate: editCamp.endDate}) === 'Active' ? 'text-green-600' : getCampaignStatus({status: 'Active', startDate: editCamp.startDate, endDate: editCamp.endDate}) === 'Upcoming' ? 'text-blue-600' : 'text-red-600'}`}>Auto: {getCampaignStatus({status: 'Active', startDate: editCamp.startDate, endDate: editCamp.endDate})}</span></p>}</div>
                <div><label className="block text-sm font-bold mb-1">Budget</label><input type="number" value={editCamp.budget} onChange={e => setEditCamp({...editCamp, budget: +e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                <div><label className="block text-sm font-bold mb-1">Start (EST)</label><input type="datetime-local" value={editCamp.startDate} onChange={e => setEditCamp({...editCamp, startDate: e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                <div><label className="block text-sm font-bold mb-1">End (EST)</label><input type="datetime-local" value={editCamp.endDate} onChange={e => setEditCamp({...editCamp, endDate: e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                <div><label className="block text-sm font-bold mb-1">Min Posts</label><input type="number" value={editCamp.minPosts} onChange={e => setEditCamp({...editCamp, minPosts: +e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                <div><label className="block text-sm font-bold mb-1">Max Posts (0=‚àû)</label><input type="number" value={editCamp.maxPosts || 0} onChange={e => setEditCamp({...editCamp, maxPosts: +e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                <div><label className="block text-sm font-bold mb-1">Website</label><input value={editCamp.links?.website || ''} onChange={e => setEditCamp({...editCamp, links: {...editCamp.links, website: e.target.value}})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                <div><label className="block text-sm font-bold mb-1">Twitter/X</label><input value={editCamp.links?.twitter || ''} onChange={e => setEditCamp({...editCamp, links: {...editCamp.links, twitter: e.target.value}})} placeholder="https://x.com/..." className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                <div className="sm:col-span-2"><label className="block text-sm font-bold mb-1">Docs Link</label><input value={editCamp.links?.docs || ''} onChange={e => setEditCamp({...editCamp, links: {...editCamp.links, docs: e.target.value}})} placeholder="https://docs.example.com" className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" /></div>
                <div className="sm:col-span-2"><label className="block text-sm font-bold mb-1">Description</label><textarea value={editCamp.description} onChange={e => setEditCamp({...editCamp, description: e.target.value})} rows="3" className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] resize-y" /></div>
                <div className="sm:col-span-2"><label className="block text-sm font-bold mb-1">About / Details</label><textarea value={editCamp.about} onChange={e => setEditCamp({...editCamp, about: e.target.value})} rows="4" className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] resize-y" /></div>
              </div>
              <div><h4 className="font-bold text-[#232324] mb-3">üèÜ Leaderboard Rewards</h4><div className="space-y-2">{editCamp.bonusPool.map((b, i) => (<div key={i} className="flex flex-wrap gap-2 items-center bg-[#FFF7E9] p-3 rounded-lg"><span className="text-sm font-semibold">Rank</span><input type="number" min="1" value={b.startRank} onChange={e => updateBonus(i, 'startRank', e.target.value)} className="w-16 px-2 py-2 rounded-lg border-2 border-[#232324] bg-white text-sm text-center" /><span className="text-sm">to</span><input type="number" min="1" value={b.endRank} onChange={e => updateBonus(i, 'endRank', e.target.value)} className="w-16 px-2 py-2 rounded-lg border-2 border-[#232324] bg-white text-sm text-center" /><span className="text-sm font-bold ml-2">$</span><input type="number" value={b.amount} onChange={e => updateBonus(i, 'amount', e.target.value)} className="w-24 px-3 py-2 rounded-lg border-2 border-[#232324] bg-white text-sm" /><button onClick={() => removeBonus(i)} className="text-red-500 hover:text-red-700 px-2 text-lg">‚úï</button></div>))}<button onClick={addBonusRange} className="text-[#2D7FF9] font-semibold text-sm">+ Add Range</button></div></div>
              <div><h4 className="font-bold text-[#232324] mb-3">üí∞ Base Payouts</h4><div className="grid grid-cols-5 gap-2">{['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze'].map(t => (<div key={t}><label className="block text-[10px] sm:text-xs font-bold mb-1 text-center">{t}</label><input type="number" value={editCamp.basePayout?.[t] || 0} onChange={e => setEditCamp({...editCamp, basePayout: {...editCamp.basePayout, [t]: +e.target.value}})} className="w-full px-1 py-2 rounded-lg border-2 border-[#232324] bg-[#FFF7E9] text-center text-sm" /></div>))}</div></div>
              <div><h4 className="font-bold text-[#232324] mb-3">‚≠ê Tier Bonus</h4><div className="grid grid-cols-5 gap-2">{['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze'].map(t => (<div key={t}><label className="block text-[10px] sm:text-xs font-bold mb-1 text-center">{t}</label><input type="number" value={editCamp.tierChampions?.[t] || 0} onChange={e => setEditCamp({...editCamp, tierChampions: {...editCamp.tierChampions, [t]: +e.target.value}})} className="w-full px-1 py-2 rounded-lg border-2 border-[#232324] bg-[#FFF7E9] text-center text-sm" /></div>))}</div></div>
            </div>
            <div className="flex gap-3 mt-6"><button onClick={() => setEditing(false)} className="flex-1 py-3 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button><button onClick={saveCamp} className="flex-1 py-3 rounded-lg font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324]">Save Changes</button></div>
          </div></div>)}
          
          {/* Payout Preview Modal */}
          {showPayoutModal && payoutPreview && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-2 sm:p-4 z-50 overflow-y-auto" onClick={() => setShowPayoutModal(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-4 sm:p-6 max-w-4xl w-full my-4 max-h-[95vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl sm:text-2xl font-bold mb-2">üí∞ Payout Preview</h3>
                <p className="text-[#232324]/60 mb-4">Review all payouts before confirming. This action cannot be undone.</p>
                
                <div className="bg-emerald-50 border-2 border-emerald-200 rounded-xl p-4 mb-4">
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-emerald-800">Total Payout</span>
                    <span className="text-2xl font-bold text-emerald-600">${payoutPreview.reduce((a, p) => a + p.total, 0).toLocaleString()}</span>
                  </div>
                  <p className="text-sm text-emerald-700 mt-1">{payoutPreview.length} creators will receive payments</p>
                </div>
                
                <div className="overflow-x-auto mb-4">
                  <table className="w-full text-sm">
                    <thead>
                      <tr className="border-b-2 border-[#232324]">
                        <th className="text-left py-2 px-2">#</th>
                        <th className="text-left py-2">Creator</th>
                        <th className="text-center py-2">Tier</th>
                        <th className="text-right py-2">Base</th>
                        <th className="text-right py-2">LB Bonus</th>
                        <th className="text-right py-2">Tier Champ</th>
                        <th className="text-right py-2 px-2 font-bold">Total</th>
                      </tr>
                    </thead>
                    <tbody>
                      {payoutPreview.map((p, i) => (
                        <tr key={p.creatorId} className="border-b border-[#232324]/10">
                          <td className="py-2 px-2">{p.rank}</td>
                          <td className="py-2">
                            <div className="flex items-center gap-2">
                              <div className={`w-7 h-7 rounded-full bg-gradient-to-br ${tg(p.tier)} border-2 border-[#232324] flex items-center justify-center text-xs`}>{p.avatar}</div>
                              <span className="font-semibold">@{p.handle}</span>
                            </div>
                          </td>
                          <td className="py-2 text-center"><span className={`text-xs font-bold px-2 py-1 rounded-full ${ts(p.tier)}`}>{p.tier}</span></td>
                          <td className="py-2 text-right">${p.basePay.toFixed(2)}</td>
                          <td className="py-2 text-right">{p.leaderboardBonus > 0 ? `$${p.leaderboardBonus}` : '‚Äî'}</td>
                          <td className="py-2 text-right">{p.tierChampionBonus > 0 ? <span className="text-amber-600 font-semibold">üëë ${p.tierChampionBonus}</span> : '‚Äî'}</td>
                          <td className="py-2 px-2 text-right font-bold text-emerald-600">${p.total.toFixed(2)}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
                
                <div className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-3 mb-4">
                  <p className="text-yellow-800 text-sm"><strong>‚ö†Ô∏è Warning:</strong> Confirming will add these amounts to each creator's total earnings and mark this campaign as paid. This cannot be reversed.</p>
                </div>
                
                <div className="flex gap-3">
                  <button onClick={() => setShowPayoutModal(false)} className="flex-1 py-3 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button>
                  <button onClick={confirmPayouts} className="flex-1 py-3 rounded-lg font-semibold bg-emerald-500 text-white border-3 border-[#232324] hover:bg-emerald-600">‚úì Confirm & Process Payouts</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // How It Works Page
    const HowItWorks = ({ setView }) => {
      const steps = [
        { icon: 'üéØ', title: 'Get Invited', desc: 'Join the Creatorverse and get ranked based on your social presence, engagement, and content quality.' },
        { icon: 'üèÜ', title: 'Join Campaigns', desc: 'Browse active campaigns and join ones that match your style. Each campaign has unique requirements and rewards.' },
        { icon: 'üìù', title: 'Create Content', desc: 'Post high-quality content on X (Twitter) that meets the campaign requirements. Be creative and authentic!' },
        { icon: 'üìä', title: 'Submit Posts', desc: 'Submit your tweet URLs through the platform. Posts are reviewed 48 hours after submission to capture full reach.' },
        { icon: '‚è≥', title: 'Review Period', desc: 'Our team evaluates your submission after 48 hours, checking metrics and content quality. You\'ll be notified once reviewed!' },
        { icon: 'üí∞', title: 'Get Paid', desc: 'Earn base payouts, tier bonuses, and leaderboard prizes. Payments are processed within 30 days after campaign ends.' },
      ];
      const rewards = [
        { title: 'Base Payout', desc: 'Earn guaranteed rewards just by hitting the minimum post requirement. Higher tiers = higher base pay.', icon: 'üíµ' },
        { title: 'Tier Champion', desc: 'Be the top performer in your tier and win an additional bonus on top of everything else!', icon: 'üëë' },
        { title: 'Leaderboard Bonus', desc: 'Finish in the top ranks overall to win massive prizes. 1st place can earn $2,500+!', icon: 'ü•á' },
      ];
      const tiers = [
        { name: 'Diamond', color: 'from-cyan-400 to-blue-500', desc: 'Elite creators with massive reach' },
        { name: 'Platinum', color: 'from-purple-400 to-purple-600', desc: 'Top-tier influencers' },
        { name: 'Gold', color: 'from-yellow-400 to-amber-500', desc: 'Established voices in the space' },
        { name: 'Silver', color: 'from-gray-300 to-gray-400', desc: 'Rising stars with strong potential' },
        { name: 'Bronze', color: 'from-orange-400 to-orange-600', desc: 'Emerging creators building presence' },
      ];
      return (
        <div className="space-y-8 sm:space-y-12">
          {/* Hero */}
          <div className="bg-gradient-to-br from-[#2D7FF9] to-[#1a5fd4] rounded-2xl border-4 border-[#232324] shadow-brutal p-6 sm:p-10 text-center text-white">
            <h1 className="text-3xl sm:text-5xl font-bold mb-4">üöÄ How Arena Works</h1>
            <p className="text-lg sm:text-xl opacity-90 max-w-2xl mx-auto">Turn your social influence into real earnings. Create content, compete with creators, and get paid.</p>
          </div>
          
          {/* Steps */}
          <div>
            <h2 className="text-2xl sm:text-3xl font-bold text-[#232324] mb-6 text-center">Your Journey to Earnings</h2>
            <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
              {steps.map((s, i) => (
                <div key={i} className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal p-5 hover:border-[#2D7FF9] transition-all">
                  <div className="flex items-center gap-3 mb-3">
                    <span className="text-3xl">{s.icon}</span>
                    <span className="bg-[#2D7FF9] text-white w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm">{i+1}</span>
                  </div>
                  <h3 className="text-lg font-bold text-[#232324] mb-2">{s.title}</h3>
                  <p className="text-sm text-[#232324]/70">{s.desc}</p>
                </div>
              ))}
            </div>
          </div>
          
          {/* Rewards */}
          <div className="bg-[#FFF7E9] rounded-2xl border-4 border-[#232324] p-6 sm:p-8">
            <h2 className="text-2xl sm:text-3xl font-bold text-[#232324] mb-6 text-center">üíé Multiple Ways to Earn</h2>
            <div className="grid sm:grid-cols-3 gap-4">
              {rewards.map((r, i) => (
                <div key={i} className="bg-white rounded-xl border-3 border-[#232324] p-5 text-center">
                  <span className="text-4xl mb-3 block">{r.icon}</span>
                  <h3 className="text-lg font-bold text-[#232324] mb-2">{r.title}</h3>
                  <p className="text-sm text-[#232324]/70">{r.desc}</p>
                </div>
              ))}
            </div>
            <div className="mt-6 bg-[#232324] rounded-xl p-5 text-white text-center">
              <p className="text-lg font-bold">üí° Pro Tip: You can stack ALL rewards!</p>
              <p className="text-sm opacity-80 mt-1">Base Payout + Tier Champion + Leaderboard Bonus = Maximum Earnings</p>
            </div>
          </div>
          
          {/* Tiers */}
          <div>
            <h2 className="text-2xl sm:text-3xl font-bold text-[#232324] mb-6 text-center">üèÖ Creator Tiers</h2>
            <div className="grid grid-cols-2 sm:grid-cols-5 gap-3">
              {tiers.map((t, i) => (
                <div key={i} className={`bg-gradient-to-br ${t.color} rounded-xl border-3 border-[#232324] p-4 text-white text-center`}>
                  <p className="text-xl font-bold">{t.name}</p>
                  <p className="text-xs opacity-80 mt-1">{t.desc}</p>
                </div>
              ))}
            </div>
            <p className="text-center text-sm text-[#232324]/60 mt-4">Your tier is determined by followers, engagement rate, content quality, and influence in the crypto space.</p>
          </div>
          
          {/* Scoring */}
          <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 sm:p-8">
            <h2 className="text-2xl sm:text-3xl font-bold text-[#232324] mb-2 text-center">üìä Our Scoring System</h2>
            <p className="text-center text-[#232324]/60 mb-8">Our proprietary algorithm evaluates multiple signals to rank content fairly</p>
            
            {/* Visual Post Comparison */}
            <div className="grid sm:grid-cols-2 gap-6 mb-8">
              {/* High Value Post */}
              <div className="relative">
                <div className="absolute -top-3 left-4 bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold">SCORES WELL</div>
                <div className="bg-gradient-to-br from-green-50 to-green-100 border-3 border-green-400 rounded-xl p-5">
                  <div className="flex items-start gap-3 mb-4">
                    <div className="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white text-lg">‚úì</div>
                    <div className="flex-1 bg-white rounded-lg p-3 border border-green-300">
                      <div className="h-2 bg-green-300 rounded w-3/4 mb-2"></div>
                      <div className="h-2 bg-green-200 rounded w-full mb-2"></div>
                      <div className="h-2 bg-green-200 rounded w-2/3"></div>
                    </div>
                  </div>
                  <div className="space-y-2">
                    <div className="flex items-center gap-2 text-green-700 text-sm"><span>‚ú®</span><span>Original, creative content</span></div>
                    <div className="flex items-center gap-2 text-green-700 text-sm"><span>üí¨</span><span>Genuine engagement & replies</span></div>
                    <div className="flex items-center gap-2 text-green-700 text-sm"><span>üìà</span><span>Organic reach & impressions</span></div>
                    <div className="flex items-center gap-2 text-green-700 text-sm"><span>üéØ</span><span>On-brand messaging</span></div>
                  </div>
                  {/* Score Meter */}
                  <div className="mt-4 bg-white rounded-lg p-3 border border-green-300">
                    <div className="flex items-center justify-between mb-1">
                      <span className="text-xs text-green-700 font-semibold">Score Impact</span>
                      <span className="text-xs text-green-600">Higher ‚Üë</span>
                    </div>
                    <div className="h-3 bg-gray-200 rounded-full overflow-hidden">
                      <div className="h-full bg-gradient-to-r from-green-400 to-green-600 rounded-full" style={{width: '85%'}}></div>
                    </div>
                  </div>
                </div>
              </div>
              
              {/* Low Value Post */}
              <div className="relative">
                <div className="absolute -top-3 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold">SCORES POORLY</div>
                <div className="bg-gradient-to-br from-red-50 to-red-100 border-3 border-red-300 rounded-xl p-5">
                  <div className="flex items-start gap-3 mb-4">
                    <div className="w-10 h-10 rounded-full bg-red-400 flex items-center justify-center text-white text-lg">‚úó</div>
                    <div className="flex-1 bg-white rounded-lg p-3 border border-red-200">
                      <div className="h-2 bg-red-200 rounded w-1/3 mb-2"></div>
                      <div className="h-2 bg-red-100 rounded w-1/2"></div>
                    </div>
                  </div>
                  <div className="space-y-2">
                    <div className="flex items-center gap-2 text-red-600 text-sm"><span>üö´</span><span>Low effort / copy-paste</span></div>
                    <div className="flex items-center gap-2 text-red-600 text-sm"><span>ü§ñ</span><span>Bot-like engagement</span></div>
                    <div className="flex items-center gap-2 text-red-600 text-sm"><span>üìâ</span><span>Artificial inflation</span></div>
                    <div className="flex items-center gap-2 text-red-600 text-sm"><span>‚ùå</span><span>Off-topic content</span></div>
                  </div>
                  {/* Score Meter */}
                  <div className="mt-4 bg-white rounded-lg p-3 border border-red-200">
                    <div className="flex items-center justify-between mb-1">
                      <span className="text-xs text-red-600 font-semibold">Score Impact</span>
                      <span className="text-xs text-red-500">Lower ‚Üì</span>
                    </div>
                    <div className="h-3 bg-gray-200 rounded-full overflow-hidden">
                      <div className="h-full bg-gradient-to-r from-red-300 to-red-400 rounded-full" style={{width: '15%'}}></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            {/* Bottom Features */}
            <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
              {[
                { icon: 'üîí', title: 'Anti-Gaming', desc: 'Smart detection' },
                { icon: '‚ö°', title: 'Real-Time', desc: 'Live updates' },
                { icon: 'üéØ', title: 'Quality First', desc: 'Content matters' },
                { icon: 'ü§ù', title: 'Fair Play', desc: 'Equal opportunity' },
              ].map((f, i) => (
                <div key={i} className="bg-[#FFF7E9] rounded-lg p-3 text-center border-2 border-[#232324]/10">
                  <span className="text-2xl">{f.icon}</span>
                  <p className="font-bold text-sm text-[#232324] mt-1">{f.title}</p>
                  <p className="text-xs text-[#232324]/60">{f.desc}</p>
                </div>
              ))}
            </div>
          </div>
          
          {/* CTA */}
          <div className="bg-[#2D7FF9] rounded-2xl border-4 border-[#232324] shadow-brutal p-6 sm:p-10 text-center text-white">
            <h2 className="text-2xl sm:text-3xl font-bold mb-4">Ready to Start Earning?</h2>
            <p className="text-lg opacity-90 mb-6">Browse active campaigns and make your first submission today!</p>
            <div className="flex justify-center gap-4">
              <button onClick={() => setView('campaigns')} className="bg-white text-[#2D7FF9] px-6 py-3 rounded-xl font-bold border-3 border-[#232324] hover:bg-[#FFF7E9] transition-all cursor-pointer">üèÜ View Campaigns</button>
            </div>
          </div>
        </div>
      );
    };

    // Admin Team Management
    const AdminTeam = ({ teamMembers, setTeamMembers, isOwner, supabaseData, hasPermission }) => {
      const [showInvite, setShowInvite] = useState(false);
      const [inviteEmail, setInviteEmail] = useState('');
      const [inviteSent, setInviteSent] = useState(false);
      const [inviteLoading, setInviteLoading] = useState(false);
      const [inviteError, setInviteError] = useState('');
      const [editingMember, setEditingMember] = useState(null);
      const [savingPermissions, setSavingPermissions] = useState(false);
      const canManageTeam = hasPermission?.('manage_team') ?? isOwner;

      const permissionLabels = {
        manage_campaigns: { label: 'Manage Campaigns', desc: 'Create, edit, launch campaigns' },
        manage_submissions: { label: 'Manage Submissions', desc: 'Approve/reject creator submissions' },
        manage_creators: { label: 'Manage Creators', desc: 'Edit profiles, wallets, tiers, status' },
        manage_payments: { label: 'Manage Payments', desc: 'Send payments, edit payment info' },
        manage_team: { label: 'Manage Team', desc: 'Invite/remove team members' },
        view_analytics: { label: 'View Analytics', desc: 'View dashboard stats & analytics' }
      };

      const sendInvite = async () => {
        if (!inviteEmail.includes('@')) {
          setInviteError('Please enter a valid email address');
          return;
        }
        
        if (teamMembers.find(m => m.email.toLowerCase() === inviteEmail.toLowerCase())) {
          setInviteError('This person is already a team member');
          return;
        }
        
        setInviteLoading(true);
        setInviteError('');
        
        const inviteToken = Math.random().toString(36).slice(2) + Math.random().toString(36).slice(2) + Date.now().toString(36);
        const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString();
        
        try {
          if (supabaseData?.addTeamMember) {
            await supabaseData.addTeamMember({
              email: inviteEmail,
              name: inviteEmail.split('@')[0],
              role: 'Team Member',
              status: 'Pending',
              invite_token: inviteToken,
              invite_token_expires: expiresAt
            });
          } else {
            setTeamMembers([...teamMembers, { 
              id: Date.now(), 
              email: inviteEmail, 
              name: inviteEmail.split('@')[0], 
              role: 'Team Member', 
              status: 'Pending', 
              joinedAt: new Date().toISOString().slice(0, 10),
              permissions: { manage_campaigns: false, manage_submissions: true, manage_creators: false, manage_payments: false, manage_team: false, view_analytics: true }
            }]);
          }
          
          try {
            await fetch('/api/send-email', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                type: 'team-invite',
                to: inviteEmail,
                data: { invitedBy: 'the team owner', inviteToken }
              })
            });
          } catch (emailErr) {
            console.error('Failed to send invite email:', emailErr);
          }
          
          setInviteSent(true);
          setTimeout(() => { setInviteSent(false); setShowInvite(false); setInviteEmail(''); }, 2000);
        } catch (err) {
          setInviteError('Failed to add team member: ' + err.message);
        }
        setInviteLoading(false);
      };

      const handleRemoveTeamMember = async (id) => {
        if (!confirm('Are you sure you want to remove this team member?')) return;
        try {
          if (supabaseData?.removeTeamMember) {
            await supabaseData.removeTeamMember(id);
          } else {
            setTeamMembers(teamMembers.filter(m => m.id !== id));
          }
        } catch (err) {
          console.error('Failed to remove team member:', err);
          alert('Failed to remove team member');
        }
      };

      const handleTogglePermission = (permKey) => {
        if (!editingMember) return;
        setEditingMember({
          ...editingMember,
          permissions: {
            ...editingMember.permissions,
            [permKey]: !editingMember.permissions?.[permKey]
          }
        });
      };

      const handleSavePermissions = async () => {
        if (!editingMember) return;
        setSavingPermissions(true);
        try {
          if (supabaseData?.updateTeamMember) {
            await supabaseData.updateTeamMember(editingMember.id, {
              permissions: editingMember.permissions
            });
          }
          setTeamMembers(teamMembers.map(m => 
            m.id === editingMember.id ? { ...m, permissions: editingMember.permissions } : m
          ));
          setEditingMember(null);
        } catch (err) {
          console.error('Failed to save permissions:', err);
          alert('Failed to save permissions');
        }
        setSavingPermissions(false);
      };

      return (
        <div className="space-y-6">
          <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
            <div>
              <h1 className="text-2xl font-bold text-[#232324]">Team Management</h1>
              <p className="text-[#232324]/60 text-sm">Manage who has access to the admin dashboard</p>
            </div>
            {canManageTeam && <button onClick={() => setShowInvite(true)} className="bg-[#2D7FF9] text-white px-4 py-2 rounded-lg font-semibold border-3 border-[#232324] shadow-brutal-sm">+ Invite Team Member</button>}
          </div>
          
          <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal overflow-hidden">
            <table className="w-full">
              <thead>
                <tr className="bg-[#FFF7E9] border-b-3 border-[#232324]">
                  <th className="text-left py-3 px-4 font-bold text-sm">Member</th>
                  <th className="text-left py-3 px-4 font-bold text-sm">Role</th>
                  <th className="text-left py-3 px-4 font-bold text-sm hidden sm:table-cell">Status</th>
                  <th className="text-left py-3 px-4 font-bold text-sm hidden md:table-cell">Permissions</th>
                  {canManageTeam && <th className="py-3 px-4 text-right font-bold text-sm">Actions</th>}
                </tr>
              </thead>
              <tbody>
                {teamMembers.map(m => (
                  <tr key={m.id} className="border-b border-[#232324]/10 hover:bg-[#FFF7E9]/50">
                    <td className="py-3 px-4">
                      <div>
                        <p className="font-semibold">{m.name}</p>
                        <p className="text-sm text-[#232324]/60">{m.email}</p>
                      </div>
                    </td>
                    <td className="py-3 px-4">
                      <span className={`text-xs font-bold px-3 py-1 rounded-full ${m.role === 'Owner' ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'}`}>
                        {m.role}
                      </span>
                    </td>
                    <td className="py-3 px-4 hidden sm:table-cell">
                      <span className={`text-xs font-semibold ${m.status === 'Active' ? 'text-green-600' : 'text-yellow-600'}`}>
                        {m.status}
                      </span>
                    </td>
                    <td className="py-3 px-4 hidden md:table-cell">
                      {m.role === 'Owner' ? (
                        <span className="text-xs text-purple-600 font-semibold">Full Access</span>
                      ) : (
                        <div className="flex flex-wrap gap-1">
                          {Object.entries(m.permissions || {}).filter(([_, v]) => v).map(([key]) => (
                            <span key={key} className="text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded-full">
                              {permissionLabels[key]?.label?.replace('Manage ', '').replace('View ', '') || key}
                            </span>
                          ))}
                          {Object.values(m.permissions || {}).filter(v => v).length === 0 && (
                            <span className="text-xs text-[#232324]/40">No permissions</span>
                          )}
                        </div>
                      )}
                    </td>
                    {canManageTeam && (
                      <td className="py-3 px-4 text-right">
                        {m.role !== 'Owner' && (
                          <div className="flex items-center justify-end gap-2">
                            <button 
                              onClick={() => setEditingMember(m)} 
                              className="text-[#2D7FF9] hover:text-[#1a5fd4] text-sm font-semibold"
                            >
                              Permissions
                            </button>
                            <button 
                              onClick={() => handleRemoveTeamMember(m.id)} 
                              className="text-red-500 hover:text-red-700 text-sm font-semibold"
                            >
                              Remove
                            </button>
                          </div>
                        )}
                      </td>
                    )}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          
          {!canManageTeam && (
            <div className="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4">
              <p className="text-yellow-800 text-sm">‚ö†Ô∏è You don't have permission to manage team members. Contact the account owner if you need access.</p>
            </div>
          )}
          
          {/* Invite Modal */}
          {showInvite && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setShowInvite(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-md w-full" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold text-[#232324] mb-4">{inviteSent ? '‚úÖ Invite Sent!' : 'Invite Team Member'}</h3>
                {inviteSent ? (
                  <p className="text-[#232324]/70">An invite has been sent to {inviteEmail}. They can set up their account using the link in the email.</p>
                ) : (
                  <div className="space-y-4">
                    <p className="text-sm text-[#232324]/70">Enter the email address of the person you want to invite. You can configure their permissions after they join.</p>
                    {inviteError && <div className="bg-red-100 border-2 border-red-400 text-red-700 px-3 py-2 rounded-lg text-sm">{inviteError}</div>}
                    <div>
                      <label className="block text-sm font-bold mb-1">Email Address</label>
                      <input type="email" value={inviteEmail} onChange={e => setInviteEmail(e.target.value)} placeholder="teammate@company.com" className="w-full px-4 py-3 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" />
                    </div>
                    <div className="bg-[#FFF7E9] rounded-lg p-3 text-sm">
                      <p className="font-semibold text-[#232324] mb-2">Default permissions for new members:</p>
                      <ul className="text-[#232324]/70 space-y-1">
                        <li>‚úÖ View analytics & dashboard</li>
                        <li>‚úÖ Approve/reject submissions</li>
                        <li>‚ùå Create/edit campaigns</li>
                        <li>‚ùå Edit creator profiles</li>
                        <li>‚ùå Send payments</li>
                        <li>‚ùå Manage team</li>
                      </ul>
                      <p className="text-[#232324]/50 mt-2 text-xs">You can change these after they join.</p>
                    </div>
                    <div className="flex gap-3">
                      <button onClick={() => { setShowInvite(false); setInviteError(''); }} className="flex-1 py-2.5 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button>
                      <button onClick={sendInvite} disabled={inviteLoading} className="flex-1 py-2.5 rounded-lg font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324] disabled:opacity-50">{inviteLoading ? 'Sending...' : 'Send Invite'}</button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}
          
          {/* Edit Permissions Modal */}
          {editingMember && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setEditingMember(null)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-md w-full" onClick={e => e.stopPropagation()}>
                <h3 className="text-xl font-bold text-[#232324] mb-1">Edit Permissions</h3>
                <p className="text-sm text-[#232324]/60 mb-4">{editingMember.name} ({editingMember.email})</p>
                
                <div className="space-y-3 mb-6">
                  {Object.entries(permissionLabels).map(([key, { label, desc }]) => (
                    <label key={key} className="flex items-start gap-3 p-3 rounded-lg border-2 border-[#232324]/20 hover:border-[#2D7FF9]/50 cursor-pointer transition-colors">
                      <input
                        type="checkbox"
                        checked={editingMember.permissions?.[key] || false}
                        onChange={() => handleTogglePermission(key)}
                        className="mt-1 w-5 h-5 rounded border-2 border-[#232324] text-[#2D7FF9] focus:ring-[#2D7FF9]"
                      />
                      <div>
                        <p className="font-semibold text-[#232324]">{label}</p>
                        <p className="text-xs text-[#232324]/60">{desc}</p>
                      </div>
                    </label>
                  ))}
                </div>
                
                <div className="flex gap-3">
                  <button onClick={() => setEditingMember(null)} className="flex-1 py-2.5 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button>
                  <button onClick={handleSavePermissions} disabled={savingPermissions} className="flex-1 py-2.5 rounded-lg font-semibold bg-[#18B369] text-white border-3 border-[#232324] disabled:opacity-50">
                    {savingPermissions ? 'Saving...' : 'Save Permissions'}
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    const AdminSubs = ({ subs, setSubs, campaigns, creators, hasPermission, supabaseData }) => {
      const [fc, setFc] = useState('All');
      const [fs, setFs] = useState('All');
      const [fd, setFd] = useState('All');
      const [customStart, setCustomStart] = useState('');
      const [customEnd, setCustomEnd] = useState('');
      const [showCustomPicker, setShowCustomPicker] = useState(false);
      const [customLabel, setCustomLabel] = useState('Custom');
      const [local, setLocal] = useState(subs);
      const [changed, setChanged] = useState(false);
      const [chartModal, setChartModal] = useState(null);
      const [originalStatuses, setOriginalStatuses] = useState({});
      const canManageSubmissions = hasPermission?.('manage_submissions') ?? true;
      
      useEffect(() => { 
        setLocal(subs); 
        setChanged(false);
        // Store original statuses when subs change
        const statuses = {};
        subs.forEach(s => { statuses[s.id] = s.status; });
        setOriginalStatuses(statuses);
      }, [subs]);
      
      const dateOptions = [
        { key: 'All', label: 'All Time' },
        { key: '1D', label: '24h' },
        { key: '7D', label: '7D' },
        { key: '30D', label: '30D' },
        { key: '90D', label: '90D' },
        { key: '180D', label: '180D' },
        { key: '1Y', label: '1Y' },
      ];
      
      const applyCustomRange = () => {
        if (customStart && customEnd) {
          setFd('Custom');
          setCustomLabel(`${customStart.slice(5)} - ${customEnd.slice(5)}`);
          setShowCustomPicker(false);
        }
      };
      
      const getDateThreshold = (period) => {
        const now = new Date();
        const days = { '1D': 1, '7D': 7, '30D': 30, '90D': 90, '180D': 180, '1Y': 365 };
        return days[period] ? new Date(now - days[period] * 24 * 60 * 60 * 1000) : null;
      };
      
      const filterByDate = (s) => {
        if (fd === 'All') return true;
        if (fd === 'Custom') {
          if (!customStart || !customEnd) return true;
          const subDate = new Date(s.submittedAt);
          return subDate >= new Date(customStart) && subDate <= new Date(customEnd + 'T23:59:59');
        }
        const threshold = getDateThreshold(fd);
        return threshold ? new Date(s.submittedAt) >= threshold : true;
      };
      
      // Check if submission is ready for review (48+ hours old)
      const isReadyForReview = (s) => {
        if (s.status !== 'Pending') return false;
        const submittedDate = new Date(s.submittedAt);
        const hoursSinceSubmit = (Date.now() - submittedDate.getTime()) / (1000 * 60 * 60);
        return hoursSinceSubmit >= 48;
      };
      
      // Get display status (shows "Needs Review" for 48+ hour old Pending)
      const getDisplayStatus = (s) => {
        if (s.status === 'Pending' && isReadyForReview(s)) return 'Needs Review';
        return s.status;
      };
      
      // Get hours since submission
      const getHoursSinceSubmit = (s) => {
        const submittedDate = new Date(s.submittedAt);
        return Math.floor((Date.now() - submittedDate.getTime()) / (1000 * 60 * 60));
      };
      
      let filtered = local.filter(s => {
        const matchesCampaign = fc === 'All' || s.campaignId === +fc;
        const displayStatus = getDisplayStatus(s);
        const matchesStatus = fs === 'All' || 
          (fs === 'Needs Review' && displayStatus === 'Needs Review') ||
          (fs === 'Pending' && s.status === 'Pending' && !isReadyForReview(s)) ||
          (fs !== 'Needs Review' && fs !== 'Pending' && s.status === fs);
        return matchesCampaign && matchesStatus && filterByDate(s);
      });
      
      if (!changed) {
        // Sort: Needs Review first, then Pending, then by date
        filtered = [...filtered].sort((a, b) => { 
          const aReady = isReadyForReview(a);
          const bReady = isReadyForReview(b);
          if (aReady && !bReady) return -1;
          if (!aReady && bReady) return 1;
          if (a.status === 'Pending' && b.status !== 'Pending') return -1; 
          if (a.status !== 'Pending' && b.status === 'Pending') return 1; 
          return new Date(b.submittedAt) - new Date(a.submittedAt); 
        });
      }
      
      // Stats
      const needsReviewCount = local.filter(s => isReadyForReview(s)).length;
      const verifiedFiltered = filtered.filter(s => s.status === 'Verified');
      const totalPosts = filtered.length;
      const verifiedPosts = verifiedFiltered.length;
      const pendingPosts = filtered.filter(s => s.status === 'Pending' && !isReadyForReview(s)).length;
      const rejectedPosts = filtered.filter(s => s.status === 'Rejected').length;
      const totalViews = verifiedFiltered.reduce((a, s) => a + (s.views || 0), 0);
      const totalLikes = verifiedFiltered.reduce((a, s) => a + (s.likes || 0), 0);
      const totalRTs = verifiedFiltered.reduce((a, s) => a + (s.retweets || 0), 0);
      const totalReplies = verifiedFiltered.reduce((a, s) => a + (s.replies || 0), 0);
      const totalEngagement = totalLikes + totalRTs + totalReplies;
      const engagementRate = totalViews > 0 ? ((totalEngagement / totalViews) * 100).toFixed(2) : 0;
      const uniqueCreators = new Set(filtered.map(s => s.creatorId)).size;
      const avgScore = verifiedPosts > 0 ? Math.round(verifiedFiltered.reduce((a, s) => a + calcScore(s.views, s.likes, s.retweets, s.replies, s.quality, s.tier), 0) / verifiedPosts) : 0;
      
      // Chart data generation
      const getChartData = (type) => {
        const groups = {};
        verifiedFiltered.forEach(s => {
          const date = s.submittedAt?.slice(0, 10) || 'Unknown';
          if (!groups[date]) groups[date] = { views: 0, likes: 0, rts: 0, replies: 0, posts: 0 };
          groups[date].views += s.views || 0;
          groups[date].likes += s.likes || 0;
          groups[date].rts += s.retweets || 0;
          groups[date].replies += s.replies || 0;
          groups[date].posts++;
        });
        return Object.entries(groups).sort((a, b) => a[0].localeCompare(b[0])).slice(-14);
      };
      
      const update = (id, u) => { setLocal(local.map(s => s.id === id ? {...s,...u} : s)); setChanged(true); };
      
      const save = async () => { 
        // Check for status changes and send notifications
        if (supabaseData?.createNotification) {
          for (const sub of local) {
            const originalStatus = originalStatuses[sub.id];
            const newStatus = sub.status;
            
            // Only notify if status changed
            if (originalStatus !== newStatus) {
              const creator = creators.find(c => c.id === sub.creatorId);
              const campaign = campaigns.find(c => c.id === sub.campaignId);
              
              if (creator && campaign) {
                if (newStatus === 'Verified') {
                  // Submission approved
                  await supabaseData.createNotification({
                    userId: creator.id,
                    type: 'submission_approved',
                    title: '‚úÖ Post Approved!',
                    message: `Your submission for ${campaign.name} has been verified. Great work!`,
                    data: { campaignId: campaign.id, campaignName: campaign.name, submissionId: sub.id }
                  });
                  
                  // Send email if enabled
                  const adminSettings = await supabaseData.getAdminSettings?.('notification_email_settings');
                  if (adminSettings?.submission_approved && creator.email_notifications !== false) {
                    const prefs = creator.notification_preferences || {};
                    if (prefs.submission_approved !== false) {
                      try {
                        await fetch('/api/send-email', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({
                            type: 'notification',
                            to: creator.email,
                            data: { title: '‚úÖ Post Approved!', message: `Your submission for ${campaign.name} has been verified. Great work!`, campaignName: campaign.name }
                          })
                        });
                      } catch (err) { console.error('Failed to send approval email:', err); }
                    }
                  }
                } else if (newStatus === 'Rejected') {
                  // Submission rejected
                  await supabaseData.createNotification({
                    userId: creator.id,
                    type: 'submission_rejected',
                    title: '‚ùå Post Needs Changes',
                    message: `Your submission for ${campaign.name} was not approved. ${sub.rejectionReason ? 'Reason: ' + sub.rejectionReason : 'Please check the requirements and try again.'}`,
                    data: { campaignId: campaign.id, campaignName: campaign.name, submissionId: sub.id, reason: sub.rejectionReason }
                  });
                  
                  // Send email if enabled
                  const adminSettings = await supabaseData.getAdminSettings?.('notification_email_settings');
                  if (adminSettings?.submission_rejected && creator.email_notifications !== false) {
                    const prefs = creator.notification_preferences || {};
                    if (prefs.submission_rejected !== false) {
                      try {
                        await fetch('/api/send-email', {
                          method: 'POST',
                          headers: { 'Content-Type': 'application/json' },
                          body: JSON.stringify({
                            type: 'notification',
                            to: creator.email,
                            data: { title: '‚ùå Post Needs Changes', message: `Your submission for ${campaign.name} was not approved. ${sub.rejectionReason || 'Please check the requirements and try again.'}`, campaignName: campaign.name }
                          })
                        });
                      } catch (err) { console.error('Failed to send rejection email:', err); }
                    }
                  }
                }
              }
            }
          }
        }
        
        setSubs(local); 
        setChanged(false); 
      };
      
      const exportCSV = () => {
        let csv = 'handle,tier,tweet_url,views,likes,retweets,replies,quality,status,submitted_at,score\n';
        filtered.forEach(s => {
          const score = calcScore(s.views, s.likes, s.retweets, s.replies, s.quality, s.tier);
          csv += `@${s.handle},${s.tier},${s.tweetUrl},${s.views||0},${s.likes||0},${s.retweets||0},${s.replies||0},${s.quality||'Good'},${s.status},${s.submittedAt},${score}\n`;
        });
        const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([csv])); a.download = `submissions-export-${new Date().toISOString().slice(0,10)}.csv`; a.click();
      };
      
      const exportPayouts = () => {
        const camp = fc === 'All' ? campaigns[0] : campaigns.find(c => c.id === +fc);
        if (!camp) return;
        const scores = {};
        local.filter(s => s.campaignId === camp.id && s.status === 'Verified').forEach(s => {
          if (!scores[s.creatorId]) { const cr = creators.find(c => c.id === s.creatorId); scores[s.creatorId] = { handle: s.handle, tier: s.tier, wallet: cr?.wallet || '', score: 0, posts: 0 }; }
          scores[s.creatorId].score += calcScore(s.views, s.likes, s.retweets, s.replies, s.quality, s.tier);
          scores[s.creatorId].posts++;
        });
        const sorted = Object.values(scores).sort((a,b) => b.score - a.score);
        let csv = 'wallet,amount,handle,tier,score,posts\n';
        sorted.forEach((c, i) => {
          let pay = c.posts >= 3 ? (camp.basePayout[c.tier] || 0) : 0;
          if (i === 0) pay += camp.bonusPool[0]?.amount || 0;
          if (pay > 0 && c.wallet) csv += `${c.wallet},${pay},${c.handle},${c.tier},${c.score},${c.posts}\n`;
        });
        const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([csv])); a.download = 'payouts.csv'; a.click();
      };
      
      // Mini bar chart component
      const MiniChart = ({ data, color, maxVal }) => (
        <div className="flex items-end gap-0.5 h-8">
          {data.slice(-7).map((d, i) => (
            <div key={i} className={`w-2 ${color} rounded-t`} style={{ height: `${Math.max(4, (d / maxVal) * 100)}%` }}></div>
          ))}
        </div>
      );
      
      const chartData = getChartData();
      const viewsData = chartData.map(([_, d]) => d.views);
      const engData = chartData.map(([_, d]) => d.likes + d.rts + d.replies);
      const postsData = chartData.map(([_, d]) => d.posts);
      
      return (
        <div className="space-y-6">
          <div className="flex flex-wrap items-center justify-between gap-4">
            <h1 className="text-2xl font-bold text-[#232324]">Submissions</h1>
            <div className="flex gap-2">
              <button onClick={exportCSV} className="bg-white px-4 py-2 rounded-lg font-semibold border-3 border-[#232324] shadow-brutal-sm text-sm">üìÑ Export CSV</button>
              <button onClick={exportPayouts} className="bg-[#2D7FF9] text-white px-4 py-2 rounded-lg font-semibold border-3 border-[#232324] shadow-brutal-sm text-sm">üí∞ Export Payouts</button>
            </div>
          </div>
          
          {/* Date Range Selector - Button Style */}
          <div className="flex flex-wrap gap-2 items-center">
            {dateOptions.map(opt => (
              <button key={opt.key} onClick={() => { setFd(opt.key); setShowCustomPicker(false); }} className={`px-4 py-2 rounded-lg font-semibold text-sm border-3 transition-all ${fd === opt.key ? 'bg-[#2D7FF9] text-white border-[#232324]' : 'bg-white text-[#232324] border-[#232324]/30 hover:border-[#232324]'}`}>{opt.label}</button>
            ))}
            {/* Custom Date Button with Popup */}
            <div className="relative">
              <button 
                onClick={() => setShowCustomPicker(!showCustomPicker)} 
                className={`px-4 py-2 rounded-lg font-semibold text-sm border-3 transition-all ${fd === 'Custom' ? 'bg-[#2D7FF9] text-white border-[#232324]' : 'bg-white text-[#232324] border-[#232324]/30 hover:border-[#232324]'}`}
              >
                {fd === 'Custom' ? customLabel : 'Custom'}
              </button>
              {showCustomPicker && (
                <div className="absolute top-full left-0 mt-2 bg-white rounded-xl border-3 border-[#232324] shadow-brutal p-4 z-50 min-w-[280px]">
                  <p className="text-sm font-bold text-[#232324] mb-3">Select Date Range</p>
                  <div className="space-y-3">
                    <div>
                      <label className="block text-xs text-[#232324]/60 mb-1">From</label>
                      <input type="date" value={customStart} onChange={e => setCustomStart(e.target.value)} className="w-full px-3 py-2 rounded-lg border-2 border-[#232324]/30 text-sm" />
                    </div>
                    <div>
                      <label className="block text-xs text-[#232324]/60 mb-1">To</label>
                      <input type="date" value={customEnd} onChange={e => setCustomEnd(e.target.value)} className="w-full px-3 py-2 rounded-lg border-2 border-[#232324]/30 text-sm" />
                    </div>
                  </div>
                  <div className="flex gap-2 mt-4">
                    <button onClick={() => setShowCustomPicker(false)} className="flex-1 py-2 rounded-lg text-sm font-semibold border-2 border-[#232324]/30">Cancel</button>
                    <button onClick={applyCustomRange} className="flex-1 py-2 rounded-lg text-sm font-semibold bg-[#2D7FF9] text-white border-2 border-[#232324]">Apply</button>
                  </div>
                </div>
              )}
            </div>
          </div>
          
          {/* Stats Overview - Clickable Cards with Mini Charts */}
          <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <div onClick={() => setChartModal('posts')} className="bg-white rounded-xl border-3 border-[#232324] p-4 cursor-pointer hover:border-[#2D7FF9] transition-all group">
              <div className="flex items-start justify-between mb-2">
                <div>
                  <p className="text-3xl font-bold text-[#232324]">{totalPosts}</p>
                  <p className="text-sm text-[#232324]/60">Total Posts</p>
                </div>
                <div className="text-right">
                  <MiniChart data={postsData} color="bg-[#2D7FF9]" maxVal={Math.max(...postsData, 1)} />
                </div>
              </div>
              <div className="flex gap-2 mt-3">
                <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full">{verifiedPosts} verified</span>
                <span className="text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full">{pendingPosts} pending</span>
              </div>
              <p className="text-xs text-[#2D7FF9] mt-2 opacity-0 group-hover:opacity-100 transition-all">Click to view chart ‚Üí</p>
            </div>
            
            <div onClick={() => setChartModal('impressions')} className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl border-3 border-blue-300 p-4 cursor-pointer hover:border-[#2D7FF9] transition-all group">
              <div className="flex items-start justify-between mb-2">
                <div>
                  <p className="text-3xl font-bold text-blue-600">{totalViews >= 1000000 ? (totalViews/1000000).toFixed(1) + 'M' : (totalViews/1000).toFixed(1) + 'K'}</p>
                  <p className="text-sm text-blue-600/70">Impressions</p>
                </div>
                <div className="text-right">
                  <MiniChart data={viewsData} color="bg-blue-500" maxVal={Math.max(...viewsData, 1)} />
                </div>
              </div>
              <p className="text-xs text-blue-600/60 mt-3">{verifiedPosts > 0 ? Math.round(totalViews / verifiedPosts).toLocaleString() : 0} avg per post</p>
              <p className="text-xs text-[#2D7FF9] mt-2 opacity-0 group-hover:opacity-100 transition-all">Click to view chart ‚Üí</p>
            </div>
            
            <div onClick={() => setChartModal('engagement')} className="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl border-3 border-purple-300 p-4 cursor-pointer hover:border-[#2D7FF9] transition-all group">
              <div className="flex items-start justify-between mb-2">
                <div>
                  <p className="text-3xl font-bold text-purple-600">{totalEngagement >= 1000 ? (totalEngagement/1000).toFixed(1) + 'K' : totalEngagement}</p>
                  <p className="text-sm text-purple-600/70">Engagements</p>
                </div>
                <div className="text-right">
                  <MiniChart data={engData} color="bg-purple-500" maxVal={Math.max(...engData, 1)} />
                </div>
              </div>
              <div className="flex gap-2 mt-3 text-xs text-purple-600/70">
                <span>‚ù§Ô∏è {totalLikes.toLocaleString()}</span>
                <span>üîÑ {totalRTs.toLocaleString()}</span>
                <span>üí¨ {totalReplies.toLocaleString()}</span>
              </div>
              <p className="text-xs text-[#2D7FF9] mt-2 opacity-0 group-hover:opacity-100 transition-all">Click to view chart ‚Üí</p>
            </div>
            
            <div className="bg-gradient-to-br from-[#FFF7E9] to-orange-100 rounded-xl border-3 border-[#232324] p-4">
              <div className="flex items-start justify-between mb-2">
                <div>
                  <p className="text-3xl font-bold text-[#2D7FF9]">{engagementRate}%</p>
                  <p className="text-sm text-[#232324]/60">Engagement Rate</p>
                </div>
                <div className="w-12 h-12 rounded-full border-4 border-[#2D7FF9] flex items-center justify-center">
                  <span className="text-lg">üìä</span>
                </div>
              </div>
              <div className="flex gap-4 mt-3 text-xs text-[#232324]/60">
                <span>üë• {uniqueCreators} creators</span>
                <span>‚≠ê {avgScore.toLocaleString()} avg score</span>
              </div>
            </div>
          </div>
          
          {/* Filters Row */}
          <div className="flex flex-wrap gap-3 items-center">
            <select value={fc} onChange={e => setFc(e.target.value)} className="px-4 py-2 rounded-lg border-3 border-[#232324] bg-white font-semibold text-sm"><option value="All">All Campaigns</option>{campaigns.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}</select>
            <select value={fs} onChange={e => setFs(e.target.value)} className="px-4 py-2 rounded-lg border-3 border-[#232324] bg-white font-semibold text-sm"><option value="All">All Status</option><option value="Needs Review">Needs Review</option><option value="Pending">Pending (New)</option><option value="Verified">Verified</option><option value="Rejected">Rejected</option></select>
            {changed && <button onClick={save} className="bg-green-500 text-white px-6 py-2 rounded-lg font-bold border-3 border-[#232324] ml-auto">üíæ Save All</button>}
          </div>
          
          {/* Table with Date Column */}
          <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal overflow-x-auto">
            <table className="w-full">
              <thead><tr className="bg-[#FFF7E9] border-b-3 border-[#232324]"><th className="text-left py-3 px-3 font-bold text-sm">Creator</th><th className="text-left py-3 px-2 font-bold text-sm hidden sm:table-cell">Submitted</th><th className="text-left py-3 px-2 font-bold text-sm">Tweet</th><th className="text-center py-3 px-1 font-bold text-sm">Views</th><th className="text-center py-3 px-1 font-bold text-sm">Likes</th><th className="text-center py-3 px-1 font-bold text-sm">RTs</th><th className="text-center py-3 px-1 font-bold text-sm hidden md:table-cell">Replies</th><th className="text-center py-3 px-1 font-bold text-sm hidden lg:table-cell">Quality</th><th className="text-center py-3 px-1 font-bold text-sm">Score</th><th className="text-center py-3 px-1 font-bold text-sm">Status</th></tr></thead>
              <tbody>{filtered.map(s => {
                const hours = getHoursSinceSubmit(s);
                const ready = isReadyForReview(s);
                return (
                <tr key={s.id} className={`border-b border-[#232324]/10 hover:bg-[#FFF7E9]/50 ${ready ? 'bg-blue-50/50' : ''}`}>
                  <td className="py-2 px-3"><p className="font-semibold text-sm">@{s.handle}</p><span className={`text-xs font-bold px-2 py-0.5 rounded-full ${ts(s.tier)}`}>{s.tier}</span></td>
                  <td className="py-2 px-2 hidden sm:table-cell">
                    <div className="text-xs text-[#232324]/60">{s.submittedAt?.slice(0, 10) || '‚Äî'}</div>
                    {s.status === 'Pending' && (
                      <div className={`text-[10px] font-semibold ${ready ? 'text-blue-600' : 'text-orange-500'}`}>
                        {ready ? `‚úì ${hours}h ago` : `‚è≥ ${48 - hours}h left`}
                      </div>
                    )}
                  </td>
                  <td className="py-2 px-2"><a href={s.tweetUrl} target="_blank" className="text-[#2D7FF9] hover:underline text-sm">View ‚Üí</a></td>
                  <td className="py-2 px-1"><input type="number" value={s.views||''} onChange={e => update(s.id, {views: +e.target.value||0})} className="w-16 px-1 py-1 rounded border-2 border-[#232324]/30 text-center text-sm bg-[#FFF7E9]" /></td>
                  <td className="py-2 px-1"><input type="number" value={s.likes||''} onChange={e => update(s.id, {likes: +e.target.value||0})} className="w-14 px-1 py-1 rounded border-2 border-[#232324]/30 text-center text-sm bg-[#FFF7E9]" /></td>
                  <td className="py-2 px-1"><input type="number" value={s.retweets||''} onChange={e => update(s.id, {retweets: +e.target.value||0})} className="w-14 px-1 py-1 rounded border-2 border-[#232324]/30 text-center text-sm bg-[#FFF7E9]" /></td>
                  <td className="py-2 px-1 hidden md:table-cell"><input type="number" value={s.replies||''} onChange={e => update(s.id, {replies: +e.target.value||0})} className="w-14 px-1 py-1 rounded border-2 border-[#232324]/30 text-center text-sm bg-[#FFF7E9]" /></td>
                  <td className="py-2 px-1 hidden lg:table-cell"><select value={s.quality||'Good'} onChange={e => update(s.id, {quality: e.target.value})} className="px-1 py-1 rounded border-2 border-[#232324]/30 text-xs bg-[#FFF7E9]">{['Poor','Okay','Good','Great','Amazing'].map(q => <option key={q}>{q}</option>)}</select></td>
                  <td className="py-2 px-1 text-center font-bold text-[#2D7FF9] text-sm">{calcScore(s.views,s.likes,s.retweets,s.replies,s.quality,s.tier).toLocaleString()}</td>
                  <td className="py-2 px-1">
                    {ready && s.status === 'Pending' ? (
                      <div className="space-y-1">
                        <span className="block text-[10px] font-bold text-blue-600 bg-blue-100 px-1.5 py-0.5 rounded text-center">REVIEW</span>
                        <select value={s.status} onChange={e => update(s.id, {status: e.target.value})} className="w-full px-1 py-1 rounded font-semibold text-xs border-2 bg-blue-100 text-blue-700 border-blue-300"><option>Pending</option><option>Verified</option><option>Rejected</option></select>
                      </div>
                    ) : (
                      <select value={s.status} onChange={e => update(s.id, {status: e.target.value})} className={`px-2 py-1 rounded font-semibold text-xs border-2 ${s.status === 'Verified' ? 'bg-green-100 text-green-700 border-green-300' : s.status === 'Rejected' ? 'bg-red-100 text-red-700 border-red-300' : 'bg-yellow-100 text-yellow-700 border-yellow-300'}`}><option>Pending</option><option>Verified</option><option>Rejected</option></select>
                    )}
                  </td>
                </tr>
              )})}</tbody>
            </table>
          </div>
          
          {/* Chart Modal */}
          {chartModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setChartModal(null)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-2xl w-full" onClick={e => e.stopPropagation()}>
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-xl font-bold text-[#232324]">
                    {chartModal === 'posts' ? 'üìä Posts Over Time' : chartModal === 'impressions' ? 'üëÅÔ∏è Impressions Over Time' : 'üí¨ Engagement Over Time'}
                  </h3>
                  <button onClick={() => setChartModal(null)} className="text-2xl text-[#232324]/60 hover:text-[#232324]">√ó</button>
                </div>
                <div className="bg-[#FFF7E9] rounded-xl p-4 border-2 border-[#232324]/20">
                  <div className="flex items-end gap-2" style={{ height: '200px' }}>
                    {chartData.length > 0 ? chartData.map(([date, data], i) => {
                      const val = chartModal === 'posts' ? data.posts : chartModal === 'impressions' ? data.views : (data.likes + data.rts + data.replies);
                      const maxVal = Math.max(...chartData.map(([_, d]) => chartModal === 'posts' ? d.posts : chartModal === 'impressions' ? d.views : (d.likes + d.rts + d.replies)), 1);
                      const heightPx = Math.max(8, (val / maxVal) * 160);
                      return (
                        <div key={i} className="flex-1 flex flex-col items-center justify-end h-full">
                          <span className="text-xs font-bold text-[#232324] mb-1">{val >= 1000 ? (val/1000).toFixed(1) + 'K' : val}</span>
                          <div 
                            className={`w-full max-w-12 rounded-t ${chartModal === 'posts' ? 'bg-[#2D7FF9]' : chartModal === 'impressions' ? 'bg-blue-500' : 'bg-purple-500'}`} 
                            style={{ height: `${heightPx}px` }}
                          ></div>
                          <span className="text-[10px] text-[#232324]/60 mt-2 whitespace-nowrap">{date.slice(5)}</span>
                        </div>
                      );
                    }) : (
                      <div className="flex-1 flex items-center justify-center text-[#232324]/40">
                        <p>No data available for selected period</p>
                      </div>
                    )}
                  </div>
                </div>
                <div className="mt-4 flex gap-4 text-sm text-[#232324]/60">
                  <span>üìÖ {chartData.length} data points</span>
                  <span>üìà {fd === 'All' ? 'All time' : fd === 'Custom' ? 'Custom range' : `Last ${fd}`}</span>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // Admin Creators
    const AdminCreators = ({ creators, setCreators, subs, isOwner, supabaseData, hasPermission }) => {
      const [search, setSearch] = useState('');
      const [filterTier, setFilterTier] = useState('All');
      const [filterStatus, setFilterStatus] = useState('All');
      const [sort, setSort] = useState('az');
      const [edit, setEdit] = useState(null);
      const [chartModal, setChartModal] = useState(null);
      const [deleteConfirm, setDeleteConfirm] = useState(null);
      const [showAddUser, setShowAddUser] = useState(false);
      const [newUser, setNewUser] = useState({ name: '', email: '', handle: '', tier: 'Bronze', wallet: '', solanaWallet: '', avatar: 'üë§', password: '' });
      const [addUserError, setAddUserError] = useState('');
      const [addUserLoading, setAddUserLoading] = useState(false);
      const canManageCreators = hasPermission?.('manage_creators') ?? isOwner;
      
      let filtered = creators.filter(c => c.name.toLowerCase().includes(search.toLowerCase()) || c.handle.toLowerCase().includes(search.toLowerCase()) || (c.wallet && c.wallet.toLowerCase().includes(search.toLowerCase())));
      if (filterTier !== 'All') filtered = filtered.filter(c => c.tier === filterTier);
      if (filterStatus !== 'All') filtered = filtered.filter(c => (c.status || 'Active') === filterStatus);
      if (sort === 'az') filtered.sort((a,b) => a.name.localeCompare(b.name));
      if (sort === 'za') filtered.sort((a,b) => b.name.localeCompare(a.name));
      if (sort === 'earned-high') filtered.sort((a,b) => (b.totalEarned||0) - (a.totalEarned||0));
      if (sort === 'earned-low') filtered.sort((a,b) => (a.totalEarned||0) - (b.totalEarned||0));
      
      // Network stats
      const tierCounts = { Diamond: 0, Platinum: 0, Gold: 0, Silver: 0, Bronze: 0 };
      const tierColors = { Diamond: ['bg-cyan-500', 'text-cyan-600', 'from-cyan-50 to-cyan-100', 'border-cyan-300'], Platinum: ['bg-purple-500', 'text-purple-600', 'from-purple-50 to-purple-100', 'border-purple-300'], Gold: ['bg-yellow-500', 'text-yellow-600', 'from-yellow-50 to-yellow-100', 'border-yellow-300'], Silver: ['bg-gray-400', 'text-gray-600', 'from-gray-100 to-gray-200', 'border-gray-300'], Bronze: ['bg-orange-500', 'text-orange-600', 'from-orange-50 to-orange-100', 'border-orange-300'] };
      creators.forEach(c => tierCounts[c.tier]++);
      const activeCount = creators.filter(c => (c.status || 'Active') === 'Active').length;
      const pausedCount = creators.length - activeCount;
      const totalEarned = creators.reduce((a, c) => a + (c.totalEarned || 0), 0);
      const totalPosts = subs?.filter(s => s.status === 'Verified').length || 0;
      const totalViews = subs?.filter(s => s.status === 'Verified').reduce((a, s) => a + (s.views || 0), 0) || 0;
      const avgEarned = creators.length > 0 ? Math.round(totalEarned / creators.length) : 0;
      
      // Get creator stats from submissions
      const getCreatorStats = (creatorId) => {
        const creatorSubs = subs?.filter(s => s.creatorId === creatorId) || [];
        const verified = creatorSubs.filter(s => s.status === 'Verified');
        return {
          totalPosts: creatorSubs.length,
          verifiedPosts: verified.length,
          totalViews: verified.reduce((a, s) => a + (s.views || 0), 0),
          totalLikes: verified.reduce((a, s) => a + (s.likes || 0), 0),
          avgScore: verified.length > 0 ? Math.round(verified.reduce((a, s) => a + calcScore(s.views, s.likes, s.retweets, s.replies, s.quality, s.tier), 0) / verified.length) : 0
        };
      };
      
      // Top performers
      const topEarners = [...creators].sort((a, b) => (b.totalEarned || 0) - (a.totalEarned || 0)).slice(0, 5);
      
      const toggleStatus = async (c) => {
        if (!isOwner) return alert('Only the owner can change creator status.');
        const newStatus = (c.status || 'Active') === 'Active' ? 'Paused' : 'Active';
        // Just update via setCreators - it handles Supabase sync automatically
        setCreators(creators.map(cr => cr.id === c.id ? {...cr, status: newStatus} : cr));
      };

      // Simple hash function for password
      const hashPassword = (password) => {
        let hash = 0;
        for (let i = 0; i < password.length; i++) {
          const char = password.charCodeAt(i);
          hash = ((hash << 5) - hash) + char;
          hash = hash & hash;
        }
        return 'hash_' + Math.abs(hash).toString(16);
      };

      const handleAddUser = async () => {
        setAddUserError('');
        
        if (!newUser.name || !newUser.email || !newUser.handle) {
          setAddUserError('Name, email, and handle are required');
          return;
        }
        
        if (creators.find(c => c.email.toLowerCase() === newUser.email.toLowerCase())) {
          setAddUserError('A creator with this email already exists');
          return;
        }
        
        if (creators.find(c => c.handle.toLowerCase() === newUser.handle.toLowerCase())) {
          setAddUserError('A creator with this handle already exists');
          return;
        }
        
        setAddUserLoading(true);
        
        try {
          const creatorData = {
            name: newUser.name,
            email: newUser.email,
            handle: newUser.handle.replace('@', ''),
            tier: newUser.tier,
            wallet: newUser.wallet || null,
            solana_wallet: newUser.solanaWallet || null,
            avatar: newUser.avatar || 'üë§',
            status: 'Active',
            total_earned: 0,
            is_admin: false,
            password_hash: newUser.password ? hashPassword(newUser.password) : null
          };
          
          if (supabaseData?.createCreator) {
            const created = await supabaseData.createCreator(creatorData);
            setCreators([...creators, {
              ...creatorData,
              id: created.id,
              totalEarned: 0,
              isAdmin: false
            }]);
          } else {
            // Mock mode
            setCreators([...creators, {
              ...creatorData,
              id: Date.now(),
              totalEarned: 0,
              isAdmin: false
            }]);
          }
          
          setShowAddUser(false);
          setNewUser({ name: '', email: '', handle: '', tier: 'Bronze', wallet: '', solanaWallet: '', avatar: 'üë§', password: '' });
        } catch (err) {
          setAddUserError('Failed to add creator: ' + err.message);
        }
        
        setAddUserLoading(false);
      };
      
      const handleDelete = (creator) => {
        if (!isOwner) return alert('Only the owner can delete creators.');
        setDeleteConfirm(creator);
      };
      
      const confirmDelete = () => {
        setCreators(creators.filter(c => c.id !== deleteConfirm.id));
        setDeleteConfirm(null);
        setEdit(null);
      };
      
      const exportWallets = () => {
        let csv = 'Name,Handle,Email,Tier,Wallet,Earned\n';
        creators.filter(c => c.wallet).forEach(c => {
          csv += `"${c.name}","${c.handle}","${c.email}","${c.tier}","${c.wallet}","${c.totalEarned || 0}"\n`;
        });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv' }));
        a.download = 'creator-wallets.csv';
        a.click();
      };
      
      return (
        <div className="space-y-4 sm:space-y-6">
          <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
            <h1 className="text-xl sm:text-2xl font-bold text-[#232324]">Creators</h1>
            <div className="flex gap-2 flex-wrap">
              {canManageCreators && <button onClick={() => setShowAddUser(true)} className="bg-[#2D7FF9] text-white px-4 py-2 rounded-lg font-semibold border-3 border-[#232324] shadow-brutal-sm text-sm hover:bg-[#1a5fd4]">‚ûï Add User</button>}
              <button onClick={exportWallets} className="bg-green-500 text-white px-4 py-2 rounded-lg font-semibold border-3 border-[#232324] shadow-brutal-sm text-sm hover:bg-green-600">üí≥ Export Wallets</button>
              <button onClick={() => { let csv = 'Name,Handle,Email,Tier,Wallet,Earned,Status\n'; filtered.forEach(c => csv += `"${c.name}","${c.handle}","${c.email}","${c.tier}","${c.wallet || ''}","${c.totalEarned || 0}","${c.status||'Active'}"\n`); const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([csv])); a.download = 'creators.csv'; a.click(); }} className="bg-white px-4 py-2 rounded-lg font-semibold border-3 border-[#232324] shadow-brutal-sm text-sm">üì§ Export All</button>
            </div>
          </div>
          
          {/* Network Stats - Visual Cards */}
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
            {/* Total & Status Card */}
            <div onClick={() => setChartModal('status')} className="bg-white rounded-xl border-3 border-[#232324] p-5 cursor-pointer hover:border-[#2D7FF9] transition-all group">
              <div className="flex items-center justify-between mb-4">
                <div>
                  <p className="text-4xl font-bold text-[#232324]">{creators.length}</p>
                  <p className="text-sm text-[#232324]/60">Total Creators</p>
                </div>
                <div className="w-20 h-20 relative">
                  <svg className="w-full h-full -rotate-90">
                    <circle cx="40" cy="40" r="32" fill="none" stroke="#e5e7eb" strokeWidth="8" />
                    <circle cx="40" cy="40" r="32" fill="none" stroke="#22c55e" strokeWidth="8" strokeDasharray={`${(activeCount/creators.length)*201} 201`} />
                  </svg>
                  <div className="absolute inset-0 flex items-center justify-center">
                    <span className="text-sm font-bold text-green-600">{Math.round((activeCount/creators.length)*100)}%</span>
                  </div>
                </div>
              </div>
              <div className="flex gap-3">
                <span className="text-xs bg-green-100 text-green-700 px-3 py-1 rounded-full font-semibold">‚óè {activeCount} Active</span>
                <span className="text-xs bg-red-100 text-red-700 px-3 py-1 rounded-full font-semibold">‚è∏ {pausedCount} Paused</span>
              </div>
              <p className="text-xs text-[#2D7FF9] mt-3 opacity-0 group-hover:opacity-100 transition-all">Click to view breakdown ‚Üí</p>
            </div>
            
            {/* Tier Distribution Card */}
            <div onClick={() => setChartModal('tiers')} className="bg-gradient-to-br from-[#FFF7E9] to-orange-50 rounded-xl border-3 border-[#232324] p-5 cursor-pointer hover:border-[#2D7FF9] transition-all group">
              <p className="text-sm font-bold text-[#232324] mb-3">Tier Distribution</p>
              <div className="space-y-2">
                {['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze'].map(tier => {
                  const pct = (tierCounts[tier] / creators.length) * 100;
                  return (
                    <div key={tier} className="flex items-center gap-2">
                      <span className="w-16 text-xs font-semibold text-[#232324]/70">{tier}</span>
                      <div className="flex-1 h-4 bg-white rounded-full overflow-hidden border border-[#232324]/20">
                        <div className={`h-full ${tierColors[tier][0]} rounded-full transition-all`} style={{ width: `${pct}%` }}></div>
                      </div>
                      <span className="w-8 text-xs font-bold text-right">{tierCounts[tier]}</span>
                    </div>
                  );
                })}
              </div>
              <p className="text-xs text-[#2D7FF9] mt-3 opacity-0 group-hover:opacity-100 transition-all">Click to view chart ‚Üí</p>
            </div>
            
            {/* Earnings & Performance Card */}
            <div onClick={() => setChartModal('earnings')} className="bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl border-3 border-green-300 p-5 cursor-pointer hover:border-[#2D7FF9] transition-all group">
              <div className="flex items-start justify-between mb-3">
                <div>
                  <p className="text-3xl font-bold text-green-600">${totalEarned >= 1000 ? (totalEarned/1000).toFixed(1) + 'K' : totalEarned}</p>
                  <p className="text-sm text-green-600/70">Total Paid Out</p>
                </div>
                <div className="text-3xl">üí∞</div>
              </div>
              <div className="grid grid-cols-2 gap-2 mt-4">
                <div className="bg-white/60 rounded-lg p-2 text-center">
                  <p className="text-lg font-bold text-[#232324]">${avgEarned}</p>
                  <p className="text-[10px] text-[#232324]/60">Avg per creator</p>
                </div>
                <div className="bg-white/60 rounded-lg p-2 text-center">
                  <p className="text-lg font-bold text-[#2D7FF9]">{totalPosts}</p>
                  <p className="text-[10px] text-[#232324]/60">Verified posts</p>
                </div>
              </div>
              <p className="text-xs text-[#2D7FF9] mt-3 opacity-0 group-hover:opacity-100 transition-all">Click to view top earners ‚Üí</p>
            </div>
          </div>
          
          <div className="flex flex-wrap gap-2 sm:gap-3">
            <input type="text" value={search} onChange={e => setSearch(e.target.value)} placeholder="Search name, handle, or wallet..." className="flex-1 min-w-[180px] px-3 sm:px-4 py-2 rounded-lg border-3 border-[#232324] bg-white text-sm" />
            <select value={filterTier} onChange={e => setFilterTier(e.target.value)} className="px-3 py-2 rounded-lg border-3 border-[#232324] bg-white font-semibold text-sm"><option value="All">All Tiers</option>{['Diamond','Platinum','Gold','Silver','Bronze'].map(t => <option key={t} value={t}>{t}</option>)}</select>
            <select value={filterStatus} onChange={e => setFilterStatus(e.target.value)} className="px-3 py-2 rounded-lg border-3 border-[#232324] bg-white font-semibold text-sm"><option value="All">All Status</option><option value="Active">Active</option><option value="Paused">Paused</option></select>
            <select value={sort} onChange={e => setSort(e.target.value)} className="px-3 py-2 rounded-lg border-3 border-[#232324] bg-white font-semibold text-sm"><option value="az">A-Z</option><option value="za">Z-A</option><option value="earned-high">Earned ‚Üì</option><option value="earned-low">Earned ‚Üë</option></select>
          </div>
          <div className="bg-white rounded-xl border-4 border-[#232324] shadow-brutal overflow-x-auto">
            <table className="w-full">
              <thead><tr className="bg-[#FFF7E9] border-b-3 border-[#232324]"><th className="text-left py-3 px-3 sm:px-4 font-bold text-xs sm:text-sm">Creator</th><th className="text-left py-3 px-3 sm:px-4 font-bold text-xs sm:text-sm hidden sm:table-cell">Tier</th><th className="text-left py-3 px-3 sm:px-4 font-bold text-xs sm:text-sm hidden md:table-cell">Wallets</th><th className="text-center py-3 px-2 font-bold text-xs sm:text-sm">Status</th><th className="text-right py-3 px-3 sm:px-4 font-bold text-xs sm:text-sm">Earned</th><th className="py-3 px-2 sm:px-4"></th></tr></thead>
              <tbody>{filtered.map(c => (
                <tr key={c.id} className={`border-b border-[#232324]/10 hover:bg-[#FFF7E9]/50 ${(c.status === 'Paused') ? 'bg-gray-50 opacity-60' : ''}`}>
                  <td className="py-3 px-3 sm:px-4"><div className="flex items-center gap-2 sm:gap-3"><Avatar user={c} /><div><p className="font-semibold text-sm">{c.name}</p><p className="text-xs sm:text-sm text-[#2D7FF9]">@{c.handle}</p><span className={`sm:hidden text-[10px] font-bold px-2 py-0.5 rounded-full ${ts(c.tier)}`}>{c.tier}</span></div></div></td>
                  <td className="py-3 px-3 sm:px-4 hidden sm:table-cell"><span className={`text-xs font-bold px-2 sm:px-3 py-1 rounded-full ${ts(c.tier)}`}>{c.tier}</span></td>
                  <td className="py-3 px-3 sm:px-4 hidden md:table-cell">
                    <div className="space-y-1">
                      <div className="flex items-center gap-1">
                        <span className="text-[10px] font-semibold text-[#232324]/50 w-10">EVM:</span>
                        <span className="font-mono text-xs text-[#232324]/70">{c.wallet ? c.wallet.slice(0,8)+'...' : '‚Äî'}</span>
                      </div>
                      <div className="flex items-center gap-1">
                        <span className="text-[10px] font-semibold text-purple-400 w-10">SOL:</span>
                        <span className="font-mono text-xs text-[#232324]/70">{c.solanaWallet ? c.solanaWallet.slice(0,8)+'...' : '‚Äî'}</span>
                      </div>
                    </div>
                  </td>
                  <td className="py-3 px-2 text-center">
                    {canManageCreators ? (
                      <button onClick={() => toggleStatus(c)} className={`text-[10px] sm:text-xs font-bold px-2 py-1 rounded-full ${(c.status || 'Active') === 'Active' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{(c.status || 'Active') === 'Active' ? '‚óè Active' : '‚è∏ Paused'}</button>
                    ) : (
                      <span className={`text-[10px] sm:text-xs font-bold px-2 py-1 rounded-full ${(c.status || 'Active') === 'Active' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{(c.status || 'Active') === 'Active' ? '‚óè Active' : '‚è∏ Paused'}</span>
                    )}
                  </td>
                  <td className="py-3 px-3 sm:px-4 text-right font-bold text-sm">${c.totalEarned || 0}</td>
                  <td className="py-3 px-2 sm:px-4 text-right">
                    {canManageCreators ? (
                      <button onClick={() => setEdit({...c, stats: getCreatorStats(c.id)})} className="text-[#2D7FF9] font-semibold text-sm hover:underline">Edit</button>
                    ) : (
                      <button onClick={() => setEdit({...c, stats: getCreatorStats(c.id)})} className="text-[#232324]/50 font-semibold text-sm">View</button>
                    )}
                  </td>
                </tr>
              ))}</tbody>
            </table>
          </div>
          
          {/* Chart Modal */}
          {chartModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setChartModal(null)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-lg w-full" onClick={e => e.stopPropagation()}>
                <div className="flex items-center justify-between mb-6">
                  <h3 className="text-xl font-bold text-[#232324]">
                    {chartModal === 'status' ? 'üë• Creator Status' : chartModal === 'tiers' ? 'üèÖ Tier Distribution' : 'üí∞ Top Earners'}
                  </h3>
                  <button onClick={() => setChartModal(null)} className="text-2xl text-[#232324]/60 hover:text-[#232324]">√ó</button>
                </div>
                
                {chartModal === 'status' && (
                  <div className="space-y-4">
                    <div className="flex items-center justify-center gap-8">
                      <div className="text-center">
                        <div className="w-24 h-24 rounded-full bg-green-100 border-4 border-green-500 flex items-center justify-center mb-2">
                          <span className="text-2xl font-bold text-green-600">{activeCount}</span>
                        </div>
                        <p className="text-sm font-semibold text-green-600">Active</p>
                      </div>
                      <div className="text-center">
                        <div className="w-24 h-24 rounded-full bg-red-100 border-4 border-red-400 flex items-center justify-center mb-2">
                          <span className="text-2xl font-bold text-red-500">{pausedCount}</span>
                        </div>
                        <p className="text-sm font-semibold text-red-500">Paused</p>
                      </div>
                    </div>
                    <p className="text-center text-sm text-[#232324]/60 mt-4">{Math.round((activeCount/creators.length)*100)}% of creators are currently active</p>
                  </div>
                )}
                
                {chartModal === 'tiers' && (
                  <div className="space-y-3">
                    {['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze'].map(tier => {
                      const pct = Math.round((tierCounts[tier] / creators.length) * 100);
                      return (
                        <div key={tier} className={`bg-gradient-to-r ${tierColors[tier][2]} rounded-xl border-2 ${tierColors[tier][3]} p-4 flex items-center justify-between`}>
                          <div className="flex items-center gap-3">
                            <div className={`w-10 h-10 rounded-full ${tierColors[tier][0]} flex items-center justify-center text-white font-bold`}>{tierCounts[tier]}</div>
                            <span className={`font-bold ${tierColors[tier][1]}`}>{tier}</span>
                          </div>
                          <span className="text-sm font-semibold text-[#232324]/60">{pct}%</span>
                        </div>
                      );
                    })}
                  </div>
                )}
                
                {chartModal === 'earnings' && (
                  <div className="space-y-3">
                    <p className="text-sm text-[#232324]/60 mb-4">Top 5 Earners</p>
                    {topEarners.map((c, i) => (
                      <div key={c.id} className="flex items-center gap-3 bg-[#FFF7E9] rounded-lg p-3 border-2 border-[#232324]/10">
                        <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-white ${i === 0 ? 'bg-yellow-500' : i === 1 ? 'bg-gray-400' : i === 2 ? 'bg-orange-500' : 'bg-[#232324]/30'}`}>{i + 1}</div>
                        <Avatar user={c} />
                        <div className="flex-1">
                          <p className="font-semibold text-sm">{c.name}</p>
                          <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full ${ts(c.tier)}`}>{c.tier}</span>
                        </div>
                        <p className="font-bold text-green-600">${c.totalEarned || 0}</p>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>
          )}
          
          {edit && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto" onClick={() => setEdit(null)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-lg w-full my-4" onClick={e => e.stopPropagation()}>
                {/* Profile Header */}
                <div className="flex items-center gap-4 mb-6 pb-4 border-b-2 border-[#232324]/10">
                  <div className="w-16 h-16 rounded-full border-3 border-[#232324] overflow-hidden bg-gradient-to-br from-[#2D7FF9] to-purple-500 flex items-center justify-center text-white text-2xl font-bold">
                    {edit.avatar ? <img src={edit.avatar} className="w-full h-full object-cover" /> : edit.name[0]}
                  </div>
                  <div>
                    <h3 className="text-xl font-bold text-[#232324]">{edit.name}</h3>
                    <p className="text-[#2D7FF9] font-semibold">@{edit.handle}</p>
                    <span className={`text-xs font-bold px-2 py-0.5 rounded-full ${ts(edit.tier)}`}>{edit.tier}</span>
                  </div>
                </div>
                
                {/* Stats Grid */}
                <div className="grid grid-cols-3 gap-3 mb-6">
                  <div className="bg-[#FFF7E9] rounded-lg p-3 text-center">
                    <p className="text-xl font-bold text-[#232324]">{edit.stats?.verifiedPosts || 0}</p>
                    <p className="text-xs text-[#232324]/60">Verified Posts</p>
                  </div>
                  <div className="bg-[#FFF7E9] rounded-lg p-3 text-center">
                    <p className="text-xl font-bold text-[#2D7FF9]">{((edit.stats?.totalViews || 0)/1000).toFixed(1)}K</p>
                    <p className="text-xs text-[#232324]/60">Impressions</p>
                  </div>
                  <div className="bg-[#FFF7E9] rounded-lg p-3 text-center">
                    <p className="text-xl font-bold text-green-600">${edit.totalEarned || 0}</p>
                    <p className="text-xs text-[#232324]/60">Total Earned</p>
                  </div>
                </div>
                
                {!isOwner && (
                  <div className="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-3 mb-4">
                    <p className="text-sm text-yellow-800">üîí <strong>View Only</strong> - Only the owner can edit creator details.</p>
                  </div>
                )}
                
                {/* Edit Fields */}
                <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold mb-1">Name {!isOwner && 'üîí'}</label>
                      <input value={edit.name || ''} onChange={e => isOwner && setEdit({...edit, name: e.target.value})} disabled={!isOwner} className={`w-full px-4 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] ${!isOwner ? 'opacity-60 cursor-not-allowed' : ''}`} />
                    </div>
                    <div>
                      <label className="block text-sm font-bold mb-1">Handle {!isOwner && 'üîí'}</label>
                      <input value={edit.handle || ''} onChange={e => isOwner && setEdit({...edit, handle: e.target.value})} disabled={!isOwner} className={`w-full px-4 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] ${!isOwner ? 'opacity-60 cursor-not-allowed' : ''}`} />
                    </div>
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold mb-1">Tier {!isOwner && 'üîí'}</label>
                      <select value={edit.tier} onChange={e => isOwner && setEdit({...edit, tier: e.target.value})} disabled={!isOwner} className={`w-full px-4 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] ${!isOwner ? 'opacity-60 cursor-not-allowed' : ''}`}>{['Diamond','Platinum','Gold','Silver','Bronze'].map(t => <option key={t}>{t}</option>)}</select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold mb-1">Status {!isOwner && 'üîí'}</label>
                      <select value={edit.status || 'Active'} onChange={e => isOwner && setEdit({...edit, status: e.target.value})} disabled={!isOwner} className={`w-full px-4 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] ${!isOwner ? 'opacity-60 cursor-not-allowed' : ''}`}><option value="Active">Active</option><option value="Paused">Paused</option></select>
                    </div>
                  </div>
                  <div>
                    <label className="block text-sm font-bold mb-1">EVM Wallet {!isOwner && 'üîí'}</label>
                    <input value={edit.wallet || ''} onChange={e => isOwner && setEdit({...edit, wallet: e.target.value})} disabled={!isOwner} className={`w-full px-4 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] font-mono text-sm ${!isOwner ? 'opacity-60 cursor-not-allowed' : ''}`} placeholder="0x..." />
                    <p className="text-xs text-[#232324]/50 mt-1">üí∞ USDC on Arbitrum</p>
                  </div>
                  <div>
                    <label className="block text-sm font-bold mb-1">Solana Wallet {!isOwner && 'üîí'}</label>
                    <input value={edit.solanaWallet || ''} onChange={e => isOwner && setEdit({...edit, solanaWallet: e.target.value})} disabled={!isOwner} className={`w-full px-4 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] font-mono text-sm ${!isOwner ? 'opacity-60 cursor-not-allowed' : ''}`} placeholder="Solana address..." />
                  </div>
                  <div>
                    <label className="block text-sm font-bold mb-1">Email {!isOwner && 'üîí'}</label>
                    <input value={edit.email || ''} onChange={e => isOwner && setEdit({...edit, email: e.target.value})} disabled={!isOwner} className={`w-full px-4 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] text-sm ${!isOwner ? 'opacity-60 cursor-not-allowed' : ''}`} />
                  </div>
                  <p className="text-xs text-[#232324]/60">‚ö†Ô∏è Paused creators cannot log in or participate in campaigns.</p>
                </div>
                
                <div className="flex gap-3 mt-6">
                  {isOwner && (
                    <button onClick={() => handleDelete(edit)} className="px-4 py-2 rounded-lg font-semibold border-3 border-red-500 text-red-500 hover:bg-red-50">üóëÔ∏è Delete</button>
                  )}
                  <button onClick={() => setEdit(null)} className="flex-1 py-2 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button>
                  {isOwner && (
                    <button onClick={() => { const {stats, ...editData} = edit; setCreators(creators.map(c => c.id === editData.id ? editData : c)); setEdit(null); }} className="flex-1 py-2 rounded-lg font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324]">Save</button>
                  )}
                </div>
              </div>
            </div>
          )}
          
          {/* Delete Confirmation Modal */}
          {deleteConfirm && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setDeleteConfirm(null)}>
              <div className="bg-white rounded-2xl border-4 border-red-500 shadow-brutal p-6 max-w-md w-full" onClick={e => e.stopPropagation()}>
                <div className="text-center mb-6">
                  <span className="text-5xl mb-4 block">‚ö†Ô∏è</span>
                  <h2 className="text-2xl font-bold text-[#232324] mb-2">Delete Creator?</h2>
                  <p className="text-[#232324]/60">Are you sure you want to remove <strong>@{deleteConfirm.handle}</strong> from the Arena? This cannot be undone.</p>
                </div>
                <div className="bg-red-50 border-2 border-red-200 rounded-lg p-3 mb-6">
                  <p className="text-sm text-red-700"><strong>This will:</strong></p>
                  <ul className="text-sm text-red-600 mt-1 list-disc list-inside">
                    <li>Remove creator from the platform</li>
                    <li>Delete their submissions</li>
                    <li>They won't be able to log in</li>
                  </ul>
                </div>
                <div className="flex gap-3">
                  <button onClick={() => setDeleteConfirm(null)} className="flex-1 py-3 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button>
                  <button onClick={confirmDelete} className="flex-1 py-3 rounded-lg font-semibold bg-red-500 text-white border-3 border-red-700 hover:bg-red-600">Delete Creator</button>
                </div>
              </div>
            </div>
          )}

          {/* Add User Modal */}
          {showAddUser && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={() => setShowAddUser(false)}>
              <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                <h2 className="text-2xl font-bold text-[#232324] mb-4">‚ûï Add New Creator</h2>
                <p className="text-[#232324]/60 mb-6">Manually add a creator to the Arena platform.</p>
                
                {addUserError && <div className="bg-red-100 border-2 border-red-400 text-red-700 px-4 py-2 rounded-lg mb-4 text-sm">{addUserError}</div>}
                
                <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div className="col-span-2 sm:col-span-1">
                      <label className="block text-sm font-bold text-[#232324] mb-1">Name *</label>
                      <input type="text" value={newUser.name} onChange={e => setNewUser({...newUser, name: e.target.value})} placeholder="John Doe" className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" />
                    </div>
                    <div className="col-span-2 sm:col-span-1">
                      <label className="block text-sm font-bold text-[#232324] mb-1">Handle *</label>
                      <input type="text" value={newUser.handle} onChange={e => setNewUser({...newUser, handle: e.target.value})} placeholder="johndoe" className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" />
                    </div>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-bold text-[#232324] mb-1">Email *</label>
                    <input type="email" value={newUser.email} onChange={e => setNewUser({...newUser, email: e.target.value})} placeholder="john@example.com" className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-bold text-[#232324] mb-1">Password (optional)</label>
                    <input type="password" value={newUser.password} onChange={e => setNewUser({...newUser, password: e.target.value})} placeholder="Leave blank to let them set it" className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]" />
                    <p className="text-xs text-[#232324]/50 mt-1">If empty, they'll set it when they sign up</p>
                  </div>
                  
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-bold text-[#232324] mb-1">Tier</label>
                      <select value={newUser.tier} onChange={e => setNewUser({...newUser, tier: e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]">
                        <option>Bronze</option>
                        <option>Silver</option>
                        <option>Gold</option>
                        <option>Platinum</option>
                        <option>Diamond</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-bold text-[#232324] mb-1">Avatar</label>
                      <select value={newUser.avatar} onChange={e => setNewUser({...newUser, avatar: e.target.value})} className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9]">
                        <option value="üë§">üë§ Default</option>
                        <option value="ü¶Å">ü¶Å Lion</option>
                        <option value="üêâ">üêâ Dragon</option>
                        <option value="ü¶ä">ü¶ä Fox</option>
                        <option value="ü¶ã">ü¶ã Butterfly</option>
                        <option value="üê∫">üê∫ Wolf</option>
                        <option value="üëë">üëë Crown</option>
                        <option value="üöÄ">üöÄ Rocket</option>
                        <option value="‚ö°">‚ö° Lightning</option>
                        <option value="üî•">üî• Fire</option>
                      </select>
                    </div>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-bold text-[#232324] mb-1">EVM Wallet (optional)</label>
                    <input type="text" value={newUser.wallet} onChange={e => setNewUser({...newUser, wallet: e.target.value})} placeholder="0x..." className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] font-mono text-sm" />
                    <p className="text-xs text-[#232324]/50 mt-1">üí∞ USDC on Arbitrum</p>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-bold text-[#232324] mb-1">Solana Wallet (optional)</label>
                    <input type="text" value={newUser.solanaWallet} onChange={e => setNewUser({...newUser, solanaWallet: e.target.value})} placeholder="Solana address..." className="w-full px-3 py-2 rounded-lg border-3 border-[#232324] bg-[#FFF7E9] font-mono text-sm" />
                  </div>
                </div>
                
                <div className="flex gap-3 mt-6">
                  <button onClick={() => { setShowAddUser(false); setAddUserError(''); setNewUser({ name: '', email: '', handle: '', tier: 'Bronze', wallet: '', solanaWallet: '', avatar: 'üë§', password: '' }); }} className="flex-1 py-3 rounded-lg font-semibold border-3 border-[#232324]">Cancel</button>
                  <button onClick={handleAddUser} disabled={addUserLoading} className="flex-1 py-3 rounded-lg font-semibold bg-[#2D7FF9] text-white border-3 border-[#232324] hover:bg-[#1a5fd4] disabled:opacity-50">
                    {addUserLoading ? 'Adding...' : 'Add Creator'}
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // Main App
    // App Wrapper that handles Supabase data loading
    function AppWrapper() {
      const supabaseData = useSupabaseData();
      
      if (supabaseData.loading) {
        return (
          <div className="min-h-screen bg-[#FFF7E9] flex items-center justify-center">
            <div className="text-center">
              <div className="w-16 h-16 border-4 border-[#2D7FF9] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
              <p className="text-[#232324] font-semibold">Loading SCAL3 Arena...</p>
            </div>
          </div>
        );
      }

      if (supabaseData.error) {
        console.warn('Supabase error, using mock data:', supabaseData.error);
        // Fall back to mock data
        return <App useMockData={true} />;
      }

      return <App supabaseData={supabaseData} useMockData={false} />;
    }

    function App({ supabaseData, useMockData = false }) {
      const [loggedIn, setLoggedIn] = useState(false);
      const [user, setUser] = useState(null);
      const [view, setView] = useState('dashboard');
      const [camp, setCamp] = useState(null);
      const [adminCamp, setAdminCamp] = useState(null);
      const [sessionLoading, setSessionLoading] = useState(true);
      
      // Use Supabase data or fallback to mock data
      const [creators, setCreators] = useState(useMockData ? DATA.creators : supabaseData?.creators || []);
      const [campaigns, setCampaigns] = useState(useMockData ? DATA.campaigns : supabaseData?.campaigns || []);
      const [subs, setSubs] = useState(useMockData ? DATA.submissions : supabaseData?.submissions || []);
      const [paymentHistory, setPaymentHistory] = useState(useMockData ? DATA.paymentHistory : supabaseData?.paymentHistory || []);
      const [landingStats, setLandingStats] = useState(useMockData ? { creators: '250+', paidOut: '$500K+', campaigns: '50+' } : supabaseData?.landingStats || { creators: '250+', paidOut: '$500K+', campaigns: '50+' });
      
      const [teamMembers, setTeamMembers] = useState([
        { id: 1, email: 'scal3xyz@gmail.com', name: 'Admin', role: 'Owner', status: 'Active', joinedAt: '2024-01-15' },
      ]);
      const [notifications, setNotifications] = useState([]);
      
      // Restore session from localStorage on mount
      useEffect(() => {
        const restoreSession = async () => {
          try {
            const savedSession = localStorage.getItem('arena_session');
            if (savedSession) {
              const sessionData = JSON.parse(savedSession);
              
              // Check if session is expired (24 hours)
              if (sessionData.timestamp && Date.now() - sessionData.timestamp < 24 * 60 * 60 * 1000) {
                // Verify user still exists in database
                if (sessionData.user.isAdmin) {
                  // Admin user - just restore
                  setUser(sessionData.user);
                  setLoggedIn(true);
                  setView(sessionData.view || 'admin-dashboard');
                } else if (!useMockData && supabaseData?.creators) {
                  // Creator - verify they still exist
                  const creator = supabaseData.creators.find(c => c.id === sessionData.user.id);
                  if (creator && creator.status !== 'Paused') {
                    setUser({ ...creator, ...sessionData.user });
                    setLoggedIn(true);
                    setView(sessionData.view || 'dashboard');
                  } else {
                    // User no longer valid, clear session
                    localStorage.removeItem('arena_session');
                  }
                } else if (sessionData.user.isTeamMember && !useMockData && supabaseData?.teamMembers) {
                  // Team member - verify they still exist
                  const teamMember = supabaseData.teamMembers.find(t => t.id === sessionData.user.id);
                  if (teamMember && teamMember.status === 'Active') {
                    setUser({ ...teamMember, ...sessionData.user });
                    setLoggedIn(true);
                    setView(sessionData.view || 'admin-dashboard');
                  } else {
                    localStorage.removeItem('arena_session');
                  }
                }
              } else {
                // Session expired, clear it
                localStorage.removeItem('arena_session');
              }
            }
          } catch (err) {
            console.error('Error restoring session:', err);
            localStorage.removeItem('arena_session');
          }
          setSessionLoading(false);
        };
        
        // Wait for supabase data to load before restoring session
        if (!supabaseData?.loading) {
          restoreSession();
        }
      }, [supabaseData?.loading, supabaseData?.creators, supabaseData?.teamMembers, useMockData]);
      
      // Save session to localStorage whenever user changes
      useEffect(() => {
        if (loggedIn && user) {
          const sessionData = {
            user: {
              id: user.id,
              email: user.email,
              name: user.name,
              handle: user.handle,
              isAdmin: user.isAdmin,
              isOwner: user.isOwner,
              isTeamMember: user.isTeamMember,
              role: user.role,
              permissions: user.permissions,
              tier: user.tier
            },
            view: view,
            timestamp: Date.now()
          };
          localStorage.setItem('arena_session', JSON.stringify(sessionData));
        }
      }, [loggedIn, user, view]);
      
      // Permission checks
      const isOwner = user?.email === 'scal3xyz@gmail.com' || user?.isOwner || (user?.role === 'Owner');
      const userPermissions = user?.permissions || {};
      
      // Helper to check if user has a specific permission
      const hasPermission = (perm) => {
        if (isOwner) return true; // Owner has all permissions
        return userPermissions[perm] === true;
      };

      // Load notifications when user logs in
      useEffect(() => {
        const loadNotifications = async () => {
          if (!useMockData && supabaseData?.getNotifications && user?.id && !user?.isAdmin) {
            try {
              const notifs = await supabaseData.getNotifications(user.id);
              setNotifications(notifs);
            } catch (err) {
              console.error('Failed to load notifications:', err);
            }
          }
        };
        
        if (loggedIn && user) {
          loadNotifications();
        }
      }, [loggedIn, user?.id, useMockData]);

      // Sync with Supabase data when it updates
      useEffect(() => {
        if (!useMockData && supabaseData) {
          // Always sync from Supabase data when available (even if arrays are empty)
          if (supabaseData.creators) setCreators(supabaseData.creators);
          // Recalculate campaign status based on current date
          if (supabaseData.campaigns) {
            const updatedCampaigns = supabaseData.campaigns.map(c => ({
              ...c,
              status: getCampaignStatus(c)
            }));
            setCampaigns(updatedCampaigns);
          }
          if (supabaseData.submissions) setSubs(supabaseData.submissions);
          if (supabaseData.paymentHistory) setPaymentHistory(supabaseData.paymentHistory);
          if (supabaseData.teamMembers) setTeamMembers(supabaseData.teamMembers);
          if (supabaseData.landingStats) setLandingStats(supabaseData.landingStats);
        }
      }, [useMockData, supabaseData?.creators, supabaseData?.campaigns, supabaseData?.submissions, supabaseData?.teamMembers, supabaseData?.paymentHistory, supabaseData?.landingStats]);

      // Refresh data when navigating to key views (to get latest campaigns, etc.)
      useEffect(() => {
        if (!useMockData && supabaseData?.fetchData && loggedIn) {
          // Refresh data when user navigates to dashboard or campaigns
          if (view === 'dashboard' || view === 'campaigns' || view === 'admin-dashboard' || view === 'admin-campaigns') {
            supabaseData.fetchData();
          }
        }
      }, [view, loggedIn]);

      // Custom handlers that sync with Supabase
      const handleSetCreators = async (newCreators) => {
        setCreators(newCreators);
        // If using Supabase and a single creator was updated, sync it
        if (!useMockData && supabaseData?.updateCreator) {
          // Find what changed and update
          for (const c of newCreators) {
            const old = creators.find(oc => oc.id === c.id);
            if (old && JSON.stringify(old) !== JSON.stringify(c)) {
              try {
                await supabaseData.updateCreator(c.id, c);
              } catch (err) {
                console.error('Failed to sync creator:', err);
              }
            }
          }
        }
      };

      const handleSetCampaigns = async (newCampaigns) => {
        setCampaigns(newCampaigns);
        if (!useMockData && supabaseData?.updateCampaign) {
          for (const c of newCampaigns) {
            const old = campaigns.find(oc => oc.id === c.id);
            if (old && JSON.stringify(old) !== JSON.stringify(c)) {
              try {
                await supabaseData.updateCampaign(c.id, c);
              } catch (err) {
                console.error('Failed to sync campaign:', err);
              }
            }
          }
        }
      };

      const handleSetSubs = async (newSubs) => {
        setSubs(newSubs);
        if (!useMockData && supabaseData?.updateSubmission) {
          for (const s of newSubs) {
            const old = subs.find(os => os.id === s.id);
            if (old && JSON.stringify(old) !== JSON.stringify(s)) {
              try {
                await supabaseData.updateSubmission(s.id, s);
              } catch (err) {
                console.error('Failed to sync submission:', err);
              }
            }
          }
        }
      };

      const [showPasswordSetup, setShowPasswordSetup] = useState(false);
      const [pendingUser, setPendingUser] = useState(null);
      const [newPassword, setNewPassword] = useState('');
      const [confirmNewPassword, setConfirmNewPassword] = useState('');
      const [passwordError, setPasswordError] = useState('');
      const [passwordLoading, setPasswordLoading] = useState(false);

      // Simple hash function for password
      const hashPassword = (password) => {
        let hash = 0;
        for (let i = 0; i < password.length; i++) {
          const char = password.charCodeAt(i);
          hash = ((hash << 5) - hash) + char;
          hash = hash & hash;
        }
        return 'hash_' + Math.abs(hash).toString(16);
      };

      const handleLogin = async (userData, needsPassword = false) => {
        if (needsPassword) {
          // Show password setup modal
          setPendingUser(userData);
          setShowPasswordSetup(true);
          return;
        }

        // User has already been validated by Login component's loginUser call
        // Just set the user and log them in
        setUser(userData);
        setLoggedIn(true);
        const v = userData.isAdmin ? 'admin-dashboard' : 'dashboard';
        setView(v);
        window.history.replaceState({ view: v }, '', `#${v}`);
        
        // Save session to localStorage
        const sessionData = {
          user: {
            id: userData.id,
            email: userData.email,
            name: userData.name,
            handle: userData.handle,
            isAdmin: userData.isAdmin,
            isOwner: userData.isOwner,
            isTeamMember: userData.isTeamMember,
            role: userData.role,
            permissions: userData.permissions,
            tier: userData.tier
          },
          view: v,
          timestamp: Date.now()
        };
        localStorage.setItem('arena_session', JSON.stringify(sessionData));
      };

      const handlePasswordSetup = async () => {
        setPasswordError('');
        
        if (newPassword.length < 6) {
          setPasswordError('Password must be at least 6 characters');
          return;
        }
        
        if (newPassword !== confirmNewPassword) {
          setPasswordError('Passwords do not match');
          return;
        }
        
        setPasswordLoading(true);
        
        try {
          const passwordHash = hashPassword(newPassword);
          
          if (supabaseData?.updateCreator) {
            await supabaseData.updateCreator(pendingUser.id, { password_hash: passwordHash });
          }
          
          // Store user data before clearing modal state
          const userToLogin = {...pendingUser};
          
          // Clear modal state
          setShowPasswordSetup(false);
          setNewPassword('');
          setConfirmNewPassword('');
          setPendingUser(null);
          
          // Log them in directly - no need to go back to login page!
          setUser(userToLogin);
          setLoggedIn(true);
          const v = 'dashboard';
          setView(v);
          window.history.replaceState({ view: v }, '', `#${v}`);
          
        } catch (error) {
          setPasswordError('Failed to save password. Please try again.');
          setPasswordLoading(false);
        }
      };

      // Browser history management for back/forward navigation
      const navigateTo = (newView, data = null) => {
        if (newView === view) return;
        const state = { view: newView, campId: data?.id || null };
        window.history.pushState(state, '', `#${newView}${data?.id ? '-' + data.id : ''}`);
        setView(newView);
        if (data && newView === 'campaign') setCamp(data);
        if (data && newView === 'admin-campaign-detail') setAdminCamp(data);
      };

      useEffect(() => {
        const handlePopState = (e) => {
          if (!loggedIn) return; // Don't navigate if not logged in
          if (e.state && e.state.view) {
            setView(e.state.view);
            if (e.state.campId) {
              const foundCamp = campaigns.find(c => c.id === e.state.campId);
              if (foundCamp) {
                if (e.state.view === 'campaign') setCamp(foundCamp);
                if (e.state.view === 'admin-campaign-detail') setAdminCamp(foundCamp);
              }
            }
          }
        };
        window.addEventListener('popstate', handlePopState);
        // Set initial state without triggering navigation
        if (loggedIn && !window.history.state) {
          const initialView = user?.isAdmin ? 'admin-dashboard' : 'dashboard';
          window.history.replaceState({ view: initialView }, '', `#${initialView}`);
        }
        return () => window.removeEventListener('popstate', handlePopState);
      }, [loggedIn, campaigns, user]);

      // Password Setup Modal (shown after signup with email only)
      if (showPasswordSetup && pendingUser) {
        return (
          <div className="min-h-screen bg-[#FFF7E9] flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl border-4 border-[#232324] shadow-brutal p-6 sm:p-8 max-w-md w-full">
              <div className="text-center mb-6">
                <div className="w-16 h-16 bg-[#18B369] rounded-full flex items-center justify-center mx-auto mb-4 border-4 border-[#232324]">
                  <span className="text-3xl">üéâ</span>
                </div>
                <h2 className="text-2xl font-bold text-[#232324]">Welcome, {pendingUser.name}!</h2>
                <p className="text-[#232324]/60 mt-2">Set a password to secure your account</p>
              </div>
              
              {passwordError && <div className="bg-red-100 border-2 border-red-400 text-red-700 px-4 py-2 rounded-lg mb-4 text-sm">{passwordError}</div>}
              
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-bold text-[#232324] mb-2">Password</label>
                  <input 
                    type="password" 
                    value={newPassword} 
                    onChange={e => setNewPassword(e.target.value)} 
                    placeholder="Min 6 characters" 
                    className="w-full px-4 py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9]" 
                  />
                </div>
                <div>
                  <label className="block text-sm font-bold text-[#232324] mb-2">Confirm Password</label>
                  <input 
                    type="password" 
                    value={confirmNewPassword} 
                    onChange={e => setConfirmNewPassword(e.target.value)} 
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                    className="w-full px-4 py-3 rounded-xl border-3 border-[#232324] bg-[#FFF7E9]" 
                  />
                </div>
                <button 
                  onClick={handlePasswordSetup}
                  disabled={passwordLoading}
                  className="w-full bg-[#18B369] text-white py-4 rounded-xl font-bold text-lg border-3 border-[#232324] shadow-brutal hover-brutal disabled:opacity-50"
                >
                  {passwordLoading ? 'Setting up...' : 'Complete Setup ‚Üí'}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Show loading while restoring session
      if (sessionLoading) {
        return (
          <div className="min-h-screen bg-[#FFF7E9] flex items-center justify-center">
            <div className="text-center">
              <div className="w-16 h-16 border-4 border-[#2D7FF9] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
              <p className="text-[#232324] font-semibold">Loading...</p>
            </div>
          </div>
        );
      }

      if (!loggedIn) return <Login onLogin={handleLogin} creators={creators} setCreators={handleSetCreators} landingStats={landingStats} supabaseData={!useMockData ? supabaseData : null} />;

      // Wrapper for setView that adds history
      const setViewWithHistory = (newView) => navigateTo(newView);
      const setCampWithHistory = (c) => { setCamp(c); navigateTo('campaign', c); };
      const setAdminCampWithHistory = (c) => { setAdminCamp(c); navigateTo('admin-campaign-detail', c); };

      return (
        <div className="min-h-screen bg-[#FFF7E9] flex flex-col">
          <Nav view={view} setView={setViewWithHistory} user={user} onLogout={() => { localStorage.removeItem('arena_session'); setLoggedIn(false); setUser(null); window.history.replaceState(null, '', window.location.pathname); }} notifications={notifications} setNotifications={setNotifications} supabaseData={!useMockData ? supabaseData : null} />
          <main className="flex-1 max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-8 w-full">
            {!user.isAdmin && view === 'dashboard' && <Dashboard user={user} campaigns={campaigns} subs={subs} setView={setViewWithHistory} setCamp={setCampWithHistory} onUpdateWallet={(wallet, solanaWallet) => { const updated = {...user, wallet, solanaWallet}; setUser(updated); handleSetCreators(creators.map(c => c.id === user.id ? {...c, wallet, solanaWallet} : c)); }} />}
            {!user.isAdmin && view === 'how-it-works' && <HowItWorks setView={setViewWithHistory} />}
            {!user.isAdmin && view === 'campaigns' && <Campaigns campaigns={campaigns} subs={subs} user={user} setView={setViewWithHistory} setCamp={setCampWithHistory} />}
            {!user.isAdmin && view === 'campaign' && <CampaignDetail camp={camp} user={user} subs={subs} setSubs={setSubs} setView={setViewWithHistory} creators={creators} supabaseData={!useMockData ? supabaseData : null} />}
            {!user.isAdmin && view === 'profile' && <Profile user={user} setUser={u => { setUser(u); handleSetCreators(creators.map(c => c.id === u.id ? u : c)); }} subs={subs} campaigns={campaigns} setView={setViewWithHistory} setCamp={setCampWithHistory} onLogout={() => { localStorage.removeItem('arena_session'); setLoggedIn(false); setUser(null); window.history.replaceState(null, '', window.location.pathname); }} setCreators={handleSetCreators} creators={creators} supabaseData={!useMockData ? supabaseData : null} />}
            {user.isAdmin && view === 'admin-dashboard' && <AdminDash creators={creators} campaigns={campaigns} subs={subs} setView={setViewWithHistory} landingStats={landingStats} setLandingStats={setLandingStats} hasPermission={hasPermission} supabaseData={!useMockData ? supabaseData : null} />}
            {user.isAdmin && view === 'admin-campaigns' && <AdminCamps campaigns={campaigns} setCampaigns={setCampaigns} subs={subs} setView={setViewWithHistory} setAdminCamp={setAdminCampWithHistory} hasPermission={hasPermission} supabaseData={!useMockData ? supabaseData : null} />}
            {user.isAdmin && view === 'admin-campaign-detail' && adminCamp && <AdminCampDetail camp={adminCamp} setCampaigns={setCampaigns} campaigns={campaigns} subs={subs} creators={creators} setCreators={setCreators} paymentHistory={paymentHistory} setPaymentHistory={setPaymentHistory} setView={setViewWithHistory} hasPermission={hasPermission} supabaseData={!useMockData ? supabaseData : null} />}
            {user.isAdmin && view === 'admin-submissions' && <AdminSubs subs={subs} setSubs={setSubs} campaigns={campaigns} creators={creators} hasPermission={hasPermission} supabaseData={!useMockData ? supabaseData : null} />}
            {user.isAdmin && view === 'admin-creators' && <AdminCreators creators={creators} setCreators={handleSetCreators} subs={subs} isOwner={isOwner} supabaseData={!useMockData ? supabaseData : null} hasPermission={hasPermission} />}
            {user.isAdmin && view === 'admin-team' && <AdminTeam teamMembers={teamMembers} setTeamMembers={setTeamMembers} isOwner={isOwner} supabaseData={!useMockData ? supabaseData : null} hasPermission={hasPermission} />}
          </main>
          <footer className="border-t-4 border-[#232324] bg-white mt-auto"><div className="max-w-7xl mx-auto px-4 py-6 flex items-center justify-between"><Logo /><div className="flex items-center gap-4"><div className="flex gap-2"><a href="https://x.com/scal3xyz" target="_blank" className="w-9 h-9 rounded-lg border-2 border-[#232324] bg-[#FFF7E9] flex items-center justify-center text-[#232324] hover:bg-[#2D7FF9] hover:text-white transition-all">ùïè</a><a href="https://www.scal3.xyz/" target="_blank" className="w-9 h-9 rounded-lg border-2 border-[#232324] bg-[#FFF7E9] flex items-center justify-center text-[#232324] hover:bg-[#2D7FF9] hover:text-white transition-all">üåê</a></div><p className="text-sm text-[#232324]/50">¬© 2026 SCAL3 ‚Ä¢ The Creatorverse</p></div></div></footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<AppWrapper />);
  </script>
</body>
</html>
